import{g as Hr}from"./index-6d5ddf8f.js";import{h as Yn,i as ue,a as L,w as zo,s as yi,$ as B,b as q,c as bi,d as T,e as le,l as Yp,W as Kp,f as Jp,m as qr,g as vi,j as Qp,p as Zp,v as eg}from"./vega.module-93f4078e.js";import"./timer-4c6100d9.js";/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var tg=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),ng=Object.prototype.hasOwnProperty;function so(e,t){return ng.call(e,t)}function oo(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var i=[];for(var r in e)so(e,r)&&i.push(r);return i}function ze(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ao(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function yn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function pu(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function co(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(co(e[t]))return!0}else if(typeof e=="object"){for(var i=oo(e),r=i.length,s=0;s<r;s++)if(co(e[i[s]]))return!0}}return!1}function wc(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r<"u"&&n.push(i+": "+r)}return n.join(`
`)}var gu=function(e){tg(t,e);function t(n,i,r,s,o){var a=this.constructor,c=e.call(this,wc(n,{name:i,index:r,operation:s,tree:o}))||this;return c.name=i,c.index=r,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=wc(n,{name:i,index:r,operation:s,tree:o}),c}return t}(Error),ae=gu,ig=ze,Kn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=Or(n,this.path);i&&(i=ze(i));var r=xn(n,{op:"remove",path:this.from}).removed;return xn(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=Or(n,this.from);return xn(n,{op:"add",path:this.path,value:ze(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Wi(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},rg={add:function(e,t,n){return ao(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:Kn.move,copy:Kn.copy,test:Kn.test,_get:Kn._get};function Or(e,t){if(t=="")return e;var n={op:"_get",path:t};return xn(e,n),n.value}function xn(e,t,n,i,r,s){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Cr(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Or(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Wi(e,t.value),o.test===!1)throw new ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ae("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{i||(e=ze(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,p=void 0,g=void 0;for(typeof n=="function"?g=n:g=Cr;;){if(p=c[u],p&&p.indexOf("~")!=-1&&(p=pu(p)),r&&(p=="__proto__"||p=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[p]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&g(t,0,e,d)),u++,Array.isArray(l)){if(p==="-")p=l.length;else{if(n&&!ao(p))throw new ae("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);ao(p)&&(p=~~p)}if(u>=f){if(n&&t.op==="add"&&p>l.length)throw new ae("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=rg[t.op].call(t,l,p,e);if(o.test===!1)throw new ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Kn[t.op].call(t,l,p,e);if(o.test===!1)throw new ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[p],n&&u<f&&(!l||typeof l!="object"))throw new ae("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Xr(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new ae("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=ze(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=xn(e,t[o],n,!0,r,o),e=s[o].newDocument;return s.newDocument=e,s}function sg(e,t,n){var i=xn(e,t);if(i.test===!1)throw new ae("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function Cr(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new ae("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Kn[e.op]){if(typeof e.path!="string")throw new ae("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ae('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ae("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ae("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&co(e.value))throw new ae("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new ae("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new ae("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=hu([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ae("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ae("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function hu(e,t,n){try{if(!Array.isArray(e))throw new ae("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Xr(ze(t),ze(e),n||!0);else{n=n||Cr;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof ae)return r;throw r}}function Wi(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,s,o;if(n&&i){if(s=e.length,s!=t.length)return!1;for(r=s;r--!==0;)if(!Wi(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(r=s;r--!==0;)if(!t.hasOwnProperty(a[r]))return!1;for(r=s;r--!==0;)if(o=a[r],!Wi(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}const og=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:ae,_areEquals:Wi,applyOperation:xn,applyPatch:Xr,applyReducer:sg,deepClone:ig,getValueByPointer:Or,validate:hu,validator:Cr},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Do=new WeakMap,ag=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),cg=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function lg(e){return Do.get(e)}function ug(e,t){return e.observers.get(t)}function fg(e,t){e.observers.delete(t.callback)}function dg(e,t){t.unobserve()}function pg(e,t){var n=[],i,r=lg(e);if(!r)r=new ag(e),Do.set(e,r);else{var s=ug(r,t);i=s&&s.observer}if(i)return i;if(i={},r.value=ze(e),t){i.callback=t,i.next=null;var o=function(){lo(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=n,i.object=e,i.unobserve=function(){lo(i),clearTimeout(i.next),fg(r,i),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(t,new cg(t,i)),i}function lo(e,t){t===void 0&&(t=!1);var n=Do.get(e.object);Mo(n.value,e.object,e.patches,"",t),e.patches.length&&Xr(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function Mo(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=oo(t),o=oo(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(so(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?Mo(u,f,n,i+"/"+yn(l),r):u!==f&&(r&&n.push({op:"test",path:i+"/"+yn(l),value:ze(u)}),n.push({op:"replace",path:i+"/"+yn(l),value:ze(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+yn(l),value:ze(u)}),n.push({op:"remove",path:i+"/"+yn(l)}),a=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!so(e,l)&&t[l]!==void 0&&n.push({op:"add",path:i+"/"+yn(l),value:ze(t[l])})}}}function gg(e,t,n){n===void 0&&(n=!1);var i=[];return Mo(e,t,i,"",n),i}const hg=Object.freeze(Object.defineProperty({__proto__:null,compare:gg,generate:lo,observe:pg,unobserve:dg},Symbol.toStringTag,{value:"Module"}));Object.assign({},og,hg,{JsonPatchError:gu,deepClone:ze,escapePathComponent:yn,unescapePathComponent:pu});var mg=/("(?:[^\\"]|\\.)*")|[:,]/g,yg=function(t,n){var i,r,s;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,c,l){var u,f,d,p,g,h,m,y,b,C,I,v;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),I=JSON.stringify(a,s),I===void 0)return I;if(m=r-c.length-l,I.length<=m&&(b=I.replace(mg,function(_,O){return O||_+" "}),b.length<=m))return b;if(s!=null&&(a=JSON.parse(I),s=void 0),typeof a=="object"&&a!==null){if(y=c+i,d=[],f=0,Array.isArray(a))for(C="[",u="]",m=a.length;f<m;f++)d.push(o(a[f],y,f===m-1?0:1)||"null");else for(C="{",u="}",h=Object.keys(a),m=h.length;f<m;f++)p=h[f],g=JSON.stringify(p)+": ",v=o(a[p],y,g.length+(f===m-1?0:1)),v!==void 0&&d.push(g+v);if(d.length>0)return[C,i+d.join(`,
`+y),u].join(`
`+c)}return I}(t,"",0)};const Ds=Hr(yg);function bg(e,t,n){let i;t.x2&&(t.x?(n&&e.x>e.x2&&(i=e.x,e.x=e.x2,e.x2=i),e.width=e.x2-e.x):e.x=e.x2-(e.width||0)),t.xc&&(e.x=e.xc-(e.width||0)/2),t.y2&&(t.y?(n&&e.y>e.y2&&(i=e.y,e.y=e.y2,e.y2=i),e.height=e.y2-e.y):e.y=e.y2-(e.height||0)),t.yc&&(e.y=e.yc-(e.height||0)/2)}var vg={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},xg={"*":(e,t)=>e*t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,">":(e,t)=>e>t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"&":(e,t)=>e&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t},Sg={"+":e=>+e,"-":e=>-e,"~":e=>~e,"!":e=>!e};const Eg=Array.prototype.slice,ln=(e,t,n)=>{const i=n?n(t[0]):t[0];return i[e].apply(i,Eg.call(t,1))},wg=(e,t,n,i,r,s,o)=>new Date(e,t||0,n??1,i||0,r||0,s||0,o||0);var $g={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(e,t,n)=>Math.max(t,Math.min(n,e)),now:Date.now,utc:Date.UTC,datetime:wg,date:e=>new Date(e).getDate(),day:e=>new Date(e).getDay(),year:e=>new Date(e).getFullYear(),month:e=>new Date(e).getMonth(),hours:e=>new Date(e).getHours(),minutes:e=>new Date(e).getMinutes(),seconds:e=>new Date(e).getSeconds(),milliseconds:e=>new Date(e).getMilliseconds(),time:e=>new Date(e).getTime(),timezoneoffset:e=>new Date(e).getTimezoneOffset(),utcdate:e=>new Date(e).getUTCDate(),utcday:e=>new Date(e).getUTCDay(),utcyear:e=>new Date(e).getUTCFullYear(),utcmonth:e=>new Date(e).getUTCMonth(),utchours:e=>new Date(e).getUTCHours(),utcminutes:e=>new Date(e).getUTCMinutes(),utcseconds:e=>new Date(e).getUTCSeconds(),utcmilliseconds:e=>new Date(e).getUTCMilliseconds(),length:e=>e.length,join:function(){return ln("join",arguments)},indexof:function(){return ln("indexOf",arguments)},lastindexof:function(){return ln("lastIndexOf",arguments)},slice:function(){return ln("slice",arguments)},reverse:e=>e.slice().reverse(),parseFloat,parseInt,upper:e=>String(e).toUpperCase(),lower:e=>String(e).toLowerCase(),substring:function(){return ln("substring",arguments,String)},split:function(){return ln("split",arguments,String)},replace:function(){return ln("replace",arguments,String)},trim:e=>String(e).trim(),regexp:RegExp,test:(e,t)=>RegExp(e).test(t)};const Og=["view","item","group","xy","x","y"],uo=new Set([Function,eval,setTimeout,setInterval]);typeof setImmediate=="function"&&uo.add(setImmediate);const Cg={Literal:(e,t)=>t.value,Identifier:(e,t)=>{const n=t.name;return e.memberDepth>0?n:n==="datum"?e.datum:n==="event"?e.event:n==="item"?e.item:vg[n]||e.params["$"+n]},MemberExpression:(e,t)=>{const n=!t.computed,i=e(t.object);n&&(e.memberDepth+=1);const r=e(t.property);if(n&&(e.memberDepth-=1),uo.has(i[r])){console.error(`Prevented interpretation of member "${r}" which could lead to insecure code execution`);return}return i[r]},CallExpression:(e,t)=>{const n=t.arguments;let i=t.callee.name;return i.startsWith("_")&&(i=i.slice(1)),i==="if"?e(n[0])?e(n[1]):e(n[2]):(e.fn[i]||$g[i]).apply(e.fn,n.map(e))},ArrayExpression:(e,t)=>t.elements.map(e),BinaryExpression:(e,t)=>xg[t.operator](e(t.left),e(t.right)),UnaryExpression:(e,t)=>Sg[t.operator](e(t.argument)),ConditionalExpression:(e,t)=>e(t.test)?e(t.consequent):e(t.alternate),LogicalExpression:(e,t)=>t.operator==="&&"?e(t.left)&&e(t.right):e(t.left)||e(t.right),ObjectExpression:(e,t)=>t.properties.reduce((n,i)=>{e.memberDepth+=1;const r=e(i.key);return e.memberDepth-=1,uo.has(e(i.value))?console.error(`Prevented interpretation of property "${r}" which could lead to insecure code execution`):n[r]=e(i.value),n},{})};function Ti(e,t,n,i,r,s){const o=a=>Cg[a.type](o,a);return o.memberDepth=0,o.fn=Object.create(t),o.params=n,o.datum=i,o.event=r,o.item=s,Og.forEach(a=>o.fn[a]=function(){return r.vega[a](...arguments)}),o(e)}var Ng={operator(e,t){const n=t.ast,i=e.functions;return r=>Ti(n,i,r)},parameter(e,t){const n=t.ast,i=e.functions;return(r,s)=>Ti(n,i,s,r)},event(e,t){const n=t.ast,i=e.functions;return r=>Ti(n,i,void 0,void 0,r)},handler(e,t){const n=t.ast,i=e.functions;return(r,s)=>{const o=s.item&&s.item.datum;return Ti(n,i,r,o,s)}},encode(e,t){const{marktype:n,channels:i}=t,r=e.functions,s=n==="group"||n==="image"||n==="rect";return(o,a)=>{const c=o.datum;let l=0,u;for(const f in i)u=Ti(i[f].ast,r,a,c,void 0,o),o[f]!==u&&(o[f]=u,l=1);return n!=="rule"&&bg(o,i,s),l}}};const _g="vega-lite",Tg='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',Ag="5.14.1",Fg=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],kg="https://vega.github.io/vega-lite/",Ig="Vega-Lite is a concise high-level language for interactive visualization.",Rg=["vega","chart","visualization"],Pg="build/vega-lite.js",Lg="build/vega-lite.min.js",zg="build/vega-lite.min.js",Dg="build/src/index",Mg="build/src/index.d.ts",jg={vl2pdf:"./bin/vl2pdf",vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},Ug=["bin","build","src","vega-lite*","tsconfig.json"],Bg={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.mjs","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/","watch:test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest --watch test-runtime/ --config test-runtime/jest-config.json",release:"release-it"},Wg={type:"git",url:"https://github.com/vega/vega-lite.git"},Gg="BSD-3-Clause",Hg={url:"https://github.com/vega/vega-lite/issues"},qg={"@babel/core":"^7.21.8","@babel/plugin-proposal-class-properties":"^7.18.6","@babel/preset-env":"^7.21.5","@babel/preset-typescript":"^7.21.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-alias":"^5.0.0","@rollup/plugin-babel":"^6.0.3","@rollup/plugin-commonjs":"^25.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-terser":"^0.4.1","@types/chai":"^4.3.5","@types/d3":"^7.4.0","@types/jest":"^27.4.1","@types/pako":"^2.0.0","@typescript-eslint/eslint-plugin":"^5.59.5","@typescript-eslint/parser":"^5.59.5",ajv:"^8.12.0","ajv-formats":"^2.1.1",chai:"^4.3.7",cheerio:"^1.0.0-rc.12","conventional-changelog-cli":"^3.0.0",d3:"^7.8.4","del-cli":"^5.0.0",eslint:"^8.40.0","eslint-config-prettier":"^8.8.0","eslint-plugin-jest":"^27.2.1","eslint-plugin-prettier":"^4.2.1","highlight.js":"^11.8.0",jest:"^27.5.1","jest-dev-server":"^6.1.1",mkdirp:"^3.0.1",pako:"^2.1.0",prettier:"^2.8.8",puppeteer:"^15.0.0","release-it":"^16.1.2",rollup:"^3.21.6","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3",serve:"^14.2.0",terser:"^5.17.3","ts-jest":"^29.1.0","ts-json-schema-generator":"^1.2.0",typescript:"~4.9.5","vega-cli":"^5.25.0","vega-datasets":"^2.7.0","vega-embed":"^6.22.1","vega-tooltip":"^0.32.0","yaml-front-matter":"^4.1.1"},Xg={"@types/clone":"~2.1.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.5.0","vega-event-selector":"~3.0.1","vega-expression":"~5.1.0","vega-util":"~1.17.2",yargs:"~17.7.2"},Vg={vega:"^5.24.0"},Yg={node:">=16"},Kg={name:_g,author:Tg,version:Ag,collaborators:Fg,homepage:kg,description:Ig,keywords:Rg,main:Pg,unpkg:Lg,jsdelivr:zg,module:Dg,types:Mg,bin:jg,files:Ug,scripts:Bg,repository:Wg,license:Gg,bugs:Hg,devDependencies:qg,dependencies:Xg,peerDependencies:Vg,engines:Yg};var mu={exports:{}};(function(e){var t=function(){function n(d,p){return p!=null&&d instanceof p}var i;try{i=Map}catch{i=function(){}}var r;try{r=Set}catch{r=function(){}}var s;try{s=Promise}catch{s=function(){}}function o(d,p,g,h,m){typeof p=="object"&&(g=p.depth,h=p.prototype,m=p.includeNonEnumerable,p=p.circular);var y=[],b=[],C=typeof Buffer<"u";typeof p>"u"&&(p=!0),typeof g>"u"&&(g=1/0);function I(v,_){if(v===null)return null;if(_===0)return v;var O,M;if(typeof v!="object")return v;if(n(v,i))O=new i;else if(n(v,r))O=new r;else if(n(v,s))O=new s(function(R,A){v.then(function(z){R(I(z,_-1))},function(z){A(I(z,_-1))})});else if(o.__isArray(v))O=[];else if(o.__isRegExp(v))O=new RegExp(v.source,f(v)),v.lastIndex&&(O.lastIndex=v.lastIndex);else if(o.__isDate(v))O=new Date(v.getTime());else{if(C&&Buffer.isBuffer(v))return Buffer.allocUnsafe?O=Buffer.allocUnsafe(v.length):O=new Buffer(v.length),v.copy(O),O;n(v,Error)?O=Object.create(v):typeof h>"u"?(M=Object.getPrototypeOf(v),O=Object.create(M)):(O=Object.create(h),M=h)}if(p){var V=y.indexOf(v);if(V!=-1)return b[V];y.push(v),b.push(O)}n(v,i)&&v.forEach(function(R,A){var z=I(A,_-1),H=I(R,_-1);O.set(z,H)}),n(v,r)&&v.forEach(function(R){var A=I(R,_-1);O.add(A)});for(var Q in v){var ve;M&&(ve=Object.getOwnPropertyDescriptor(M,Q)),!(ve&&ve.set==null)&&(O[Q]=I(v[Q],_-1))}if(Object.getOwnPropertySymbols)for(var ot=Object.getOwnPropertySymbols(v),Q=0;Q<ot.length;Q++){var N=ot[Q],w=Object.getOwnPropertyDescriptor(v,N);w&&!w.enumerable&&!m||(O[N]=I(v[N],_-1),w.enumerable||Object.defineProperty(O,N,{enumerable:!1}))}if(m)for(var P=Object.getOwnPropertyNames(v),Q=0;Q<P.length;Q++){var F=P[Q],w=Object.getOwnPropertyDescriptor(v,F);w&&w.enumerable||(O[F]=I(v[F],_-1),Object.defineProperty(O,F,{enumerable:!1}))}return O}return I(d,g)}o.clonePrototype=function(p){if(p===null)return null;var g=function(){};return g.prototype=p,new g};function a(d){return Object.prototype.toString.call(d)}o.__objToStr=a;function c(d){return typeof d=="object"&&a(d)==="[object Date]"}o.__isDate=c;function l(d){return typeof d=="object"&&a(d)==="[object Array]"}o.__isArray=l;function u(d){return typeof d=="object"&&a(d)==="[object RegExp]"}o.__isRegExp=u;function f(d){var p="";return d.global&&(p+="g"),d.ignoreCase&&(p+="i"),d.multiline&&(p+="m"),p}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)})(mu);var Jg=mu.exports;const Qg=Hr(Jg);var Zg=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(s=Object.keys(t),i=s.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;r--!==0;){var o=s[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n};const eh=Hr(Zg);var th=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(s){return function(o){return function(a,c){var l={key:a,value:o[a]},u={key:c,value:o[c]};return s(l,u)}}}(t.cmp),r=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(o)-1,u=Object.keys(o).sort(i&&i(o));for(c="",a=0;a<u.length;a++){var f=u[a],d=s(o[f]);d&&(c&&(c+=","),c+=JSON.stringify(f)+":"+d)}return r.splice(l,1),"{"+c+"}"}}(e)};const jo=Hr(th);function Uo(e){return!!e.or}function Bo(e){return!!e.and}function Wo(e){return!!e.not}function $r(e,t){if(Wo(e))$r(e.not,t);else if(Bo(e))for(const n of e.and)$r(n,t);else if(Uo(e))for(const n of e.or)$r(n,t);else t(e)}function Jn(e,t){return Wo(e)?{not:Jn(e.not,t)}:Bo(e)?{and:e.and.map(n=>Jn(n,t))}:Uo(e)?{or:e.or.map(n=>Jn(n,t))}:t(e)}const ft=eh,D=Qg;function yu(e){throw new Error(e)}function ii(e,t){const n={};for(const i of t)Yn(e,i)&&(n[i]=e[i]);return n}function Te(e,t){const n={...e};for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return`Set(${[...this].map(e=>jo(e)).join(",")})`};const te=jo;function W(e){if(ue(e))return e;const t=L(e)?e:jo(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function fo(e){return e===!1||e===null}function G(e,t){return e.includes(t)}function On(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Go(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function bu(e,...t){for(const n of t)nh(e,n??{});return e}function nh(e,t){for(const n of x(t))zo(e,n,t[n],!0)}function dt(e,t){const n=[],i={};let r;for(const s of e)r=t(s),!(r in i)&&(i[r]=1,n.push(s));return n}function ih(e,t){const n=x(e),i=x(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function vu(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Ho(e,t){for(const n of e)if(t.has(n))return!0;return!1}function po(e){const t=new Set;for(const n of e){const r=yi(n).map((o,a)=>a===0?o:`[${o}]`),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function qo(e,t){return e===void 0||t===void 0?!0:Ho(po(e),po(t))}function J(e){return x(e).length===0}const x=Object.keys,Se=Object.values,Xt=Object.entries;function Gi(e){return e===!0||e===!1}function se(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function Mi(e,t){return Wo(e)?`!(${Mi(e.not,t)})`:Bo(e)?`(${e.and.map(n=>Mi(n,t)).join(") && (")})`:Uo(e)?`(${e.or.map(n=>Mi(n,t)).join(") || (")})`:t(e)}function Nr(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&Nr(e[n],t)&&delete e[n],J(e)}function Zi(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Xo(e,t="datum"){const n=yi(e),i=[];for(let r=1;r<=n.length;r++){const s=`[${n.slice(0,r).map(B).join("][")}]`;i.push(`${t}${s}`)}return i.join(" && ")}function xu(e,t="datum"){return`${t}[${B(yi(e).join("."))}]`}function rh(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Ue(e){return`${yi(e).map(rh).join("\\.")}`}function Cn(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Vo(e){return`${yi(e).join(".")}`}function ri(e){return e?yi(e).length:0}function fe(...e){for(const t of e)if(t!==void 0)return t}let Su=42;function Eu(e){const t=++Su;return e?String(e)+t:t}function sh(){Su=42}function wu(e){return $u(e)?e:`__${e}`}function $u(e){return e.startsWith("__")}function Hi(e){if(e!==void 0)return(e%360+360)%360}function Vr(e){return ue(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const Tt="row",At="column",Yr="facet",oe="x",me="y",tt="x2",vt="y2",Zt="xOffset",xi="yOffset",nt="radius",Pt="radius2",We="theta",Lt="theta2",it="latitude",rt="longitude",st="latitude2",Be="longitude2",ke="color",xt="fill",St="stroke",Ie="shape",zt="size",Ln="angle",Dt="opacity",en="fillOpacity",tn="strokeOpacity",nn="strokeWidth",rn="strokeDash",er="text",si="order",tr="detail",Kr="key",Nn="tooltip",Jr="href",Qr="url",Zr="description",oh={x:1,y:1,x2:1,y2:1},Ou={theta:1,theta2:1,radius:1,radius2:1};function Cu(e){return e in Ou}const Yo={longitude:1,longitude2:1,latitude:1,latitude2:1};function Nu(e){switch(e){case it:return"y";case st:return"y2";case rt:return"x";case Be:return"x2"}}function _u(e){return e in Yo}const ah=x(Yo),Ko={...oh,...Ou,...Yo,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function Qn(e){return e===ke||e===xt||e===St}const Tu={row:1,column:1,facet:1},je=x(Tu),Jo={...Ko,...Tu},ch=x(Jo),{order:F0,detail:k0,tooltip:I0,...lh}=Jo,{row:R0,column:P0,facet:L0,...uh}=lh;function fh(e){return!!uh[e]}function Au(e){return!!Jo[e]}const dh=[tt,vt,st,Be,Lt,Pt];function Fu(e){return zn(e)!==e}function zn(e){switch(e){case tt:return oe;case vt:return me;case st:return it;case Be:return rt;case Lt:return We;case Pt:return nt}return e}function Vt(e){if(Cu(e))switch(e){case We:return"startAngle";case Lt:return"endAngle";case nt:return"outerRadius";case Pt:return"innerRadius"}return e}function Et(e){switch(e){case oe:return tt;case me:return vt;case it:return st;case rt:return Be;case We:return Lt;case nt:return Pt}}function Re(e){switch(e){case oe:case tt:return"width";case me:case vt:return"height"}}function ku(e){switch(e){case oe:return"xOffset";case me:return"yOffset";case tt:return"x2Offset";case vt:return"y2Offset";case We:return"thetaOffset";case nt:return"radiusOffset";case Lt:return"theta2Offset";case Pt:return"radius2Offset"}}function Qo(e){switch(e){case oe:return"xOffset";case me:return"yOffset"}}function Iu(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const ph=x(Ko),{x:z0,y:D0,x2:M0,y2:j0,xOffset:U0,yOffset:B0,latitude:W0,longitude:G0,latitude2:H0,longitude2:q0,theta:X0,theta2:V0,radius:Y0,radius2:K0,...Zo}=Ko,gh=x(Zo),ea={x:1,y:1},wt=x(ea);function ye(e){return e in ea}const ta={theta:1,radius:1},hh=x(ta);function es(e){return e==="width"?oe:me}const Ru={xOffset:1,yOffset:1};function Si(e){return e in Ru}const{text:J0,tooltip:Q0,href:Z0,url:eO,description:tO,detail:nO,key:iO,order:rO,...Pu}=Zo,mh=x(Pu);function yh(e){return!!Zo[e]}function bh(e){switch(e){case ke:case xt:case St:case zt:case Ie:case Dt:case nn:case rn:return!0;case en:case tn:case Ln:return!1}}const Lu={...ea,...ta,...Ru,...Pu},ts=x(Lu);function Mt(e){return!!Lu[e]}function vh(e,t){return Sh(e)[t]}const zu={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:sO,...xh}=zu;function Sh(e){switch(e){case ke:case xt:case St:case Zr:case tr:case Kr:case Nn:case Jr:case si:case Dt:case en:case tn:case nn:case Yr:case Tt:case At:return zu;case oe:case me:case Zt:case xi:case it:case rt:return xh;case tt:case vt:case st:case Be:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case zt:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case rn:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Ie:return{point:"always",geoshape:"always"};case er:return{text:"always"};case Ln:return{point:"always",square:"always",text:"always"};case Qr:return{image:"always"};case We:return{text:"always",arc:"always"};case nt:return{text:"always",arc:"always"};case Lt:case Pt:return{arc:"always"}}}function Ms(e){switch(e){case oe:case me:case We:case nt:case Zt:case xi:case zt:case Ln:case nn:case Dt:case en:case tn:case tt:case vt:case Lt:case Pt:return;case Yr:case Tt:case At:case Ie:case rn:case er:case Nn:case Jr:case Qr:case Zr:return"discrete";case ke:case xt:case St:return"flexible";case it:case rt:case st:case Be:case tr:case Kr:case si:return}}const Eh={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},wh={count:1,min:1,max:1};function It(e){return!!e&&!!e.argmin}function sn(e){return!!e&&!!e.argmax}function na(e){return L(e)&&!!Eh[e]}const $h=new Set(["count","valid","missing","distinct"]);function Du(e){return L(e)&&$h.has(e)}function Oh(e){return L(e)&&G(["min","max"],e)}const Ch=new Set(["count","sum","distinct","valid","missing"]),Nh=new Set(["mean","average","median","q1","q3","min","max"]);function Mu(e){return bi(e)&&(e=ps(e,void 0)),"bin"+x(e).map(t=>ns(e[t])?se(`_${t}_${Xt(e[t])}`):se(`_${t}_${e[t]}`)).join("")}function ne(e){return e===!0||Dn(e)&&!e.binned}function xe(e){return e==="binned"||Dn(e)&&e.binned===!0}function Dn(e){return q(e)}function ns(e){return e==null?void 0:e.param}function $c(e){switch(e){case Tt:case At:case zt:case ke:case xt:case St:case nn:case Dt:case en:case tn:case Ie:return 6;case rn:return 4;default:return 10}}function nr(e){return!!(e!=null&&e.expr)}function _e(e){const t=x(e||{}),n={};for(const i of t)n[i]=Le(e[i]);return n}function ju(e){const{anchor:t,frame:n,offset:i,orient:r,angle:s,limit:o,color:a,subtitleColor:c,subtitleFont:l,subtitleFontSize:u,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:p,subtitlePadding:g,...h}=e,m={...h,...a?{fill:a}:{}},y={...t?{anchor:t}:{},...n?{frame:n}:{},...i?{offset:i}:{},...r?{orient:r}:{},...s!==void 0?{angle:s}:{},...o!==void 0?{limit:o}:{}},b={...c?{subtitleColor:c}:{},...l?{subtitleFont:l}:{},...u?{subtitleFontSize:u}:{},...f?{subtitleFontStyle:f}:{},...d?{subtitleFontWeight:d}:{},...p?{subtitleLineHeight:p}:{},...g?{subtitlePadding:g}:{}},C=ii(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:C,nonMarkTitleProperties:y,subtitle:b}}function Wt(e){return L(e)||T(e)&&L(e[0])}function k(e){return!!(e!=null&&e.signal)}function on(e){return!!e.step}function _h(e){return T(e)?!1:"fields"in e&&!("data"in e)}function Th(e){return T(e)?!1:"fields"in e&&"data"in e}function _t(e){return T(e)?!1:"field"in e&&"data"in e}const Ah={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},Fh=x(Ah),kh={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},go=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Uu(e){const t=T(e.condition)?e.condition.map(Oc):Oc(e.condition);return{...Le(e),condition:t}}function Le(e){if(nr(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function Oc(e){if(nr(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function re(e){if(nr(e)){const{expr:t,...n}=e;return{signal:t,...n}}return k(e)?e:e!==void 0?{value:e}:void 0}function Ih(e){return k(e)?e.signal:B(e)}function Cc(e){return k(e)?e.signal:B(e.value)}function Ve(e){return k(e)?e.signal:e==null?null:B(e)}function Rh(e,t,n){for(const i of n){const r=Rt(i,t.markDef,t.config);r!==void 0&&(e[i]=re(r))}return e}function Bu(e){return[].concat(e.type,e.style??[])}function Y(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Rt(e,t,n,i)}function Rt(e,t,n,{vgChannel:i}={}){return fe(i?_r(e,t,n.style):void 0,_r(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function _r(e,t,n){return Wu(e,Bu(t),n)}function Wu(e,t,n){t=le(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function Gu(e,t){return le(e).reduce((n,i)=>(n.field.push($(i,t)),n.order.push(i.sort??"ascending"),n),{field:[],order:[]})}function Hu(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(ft(r,i))return;n.push(i)}),n}function qu(e,t){return ft(e,t)||!t?e:e?[...le(e),...le(t)].join(", "):t}function Xu(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((Wt(n)||k(n))&&(Wt(i)||k(i)))return{explicit:e.explicit,value:qu(n,i)};if(Wt(n)||k(n))return{explicit:e.explicit,value:n};if(Wt(i)||k(i))return{explicit:e.explicit,value:i};if(!Wt(n)&&!k(n)&&!Wt(i)&&!k(i))return{explicit:e.explicit,value:Hu(n,i)};throw new Error("It should never reach here")}function ia(e){return`Invalid specification ${te(e)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const Ph='Autosize "fit" only works for single views and layered views.';function Nc(e){return`${e=="width"?"Width":"Height"} "container" only works for single views and layered views.`}function _c(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return`${t} "container" only works well with autosize "fit" or "fit-${n}".`}function Tc(e){return e?`Dropping "fit-${e}" because spec has discrete ${Re(e)}.`:'Dropping "fit" because spec has discrete size.'}function ra(e){return`Unknown field for ${e}. Cannot calculate view size.`}function Ac(e){return`Cannot project a selection on encoding channel "${e}", which has no field.`}function Lh(e,t){return`Cannot project a selection on encoding channel "${e}" as it uses an aggregate function ("${t}").`}function zh(e){return`The "nearest" transform is not supported for ${e} marks.`}function Vu(e){return`Selection not supported for ${e} yet.`}function Dh(e){return`Cannot find a selection named "${e}".`}const Mh="Scale bindings are currently only supported for scales with unbinned, continuous domains.",jh="Legend bindings are only supported for selections over an individual field or encoding channel.";function Uh(e){return`Lookups can only be performed on selection parameters. "${e}" is a variable parameter.`}function Bh(e){return`Cannot define and lookup the "${e}" selection in the same view. Try moving the lookup into a second, layered view?`}const Wh="The same selection must be used to override scale domains in a layered view.",Gh='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function Hh(e){return`Unknown repeated value "${e}".`}function Fc(e){return`The "columns" property cannot be used when "${e}" has nested row/column.`}const qh="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Xh(e){return`Unrecognized parse "${e}".`}function kc(e,t,n){return`An ancestor parsed field "${e}" as ${n} but a child wants to parse the field as ${t}.`}const Vh="Attempt to add the same child twice.";function Yh(e){return`Ignoring an invalid transform: ${te(e)}.`}const Kh='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Ic(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function Jh(e){const{parentProjection:t,projection:n}=e;return`Layer's shared projection ${te(t)} is overridden by a child projection ${te(n)}.`}const Qh="Arc marks uses theta channel rather than angle, replacing angle with theta.";function Zh(e){return`${e}Offset dropped because ${e} is continuous`}function em(e){return`There is no ${e} encoding. Replacing ${e}Offset encoding as ${e}.`}function tm(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${te(n)}}.`}function Yu(e){return`Invalid field type "${e}".`}function nm(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}function im(e){return`Invalid aggregation operator "${e}".`}function Ku(e,t){const{fill:n,stroke:i}=t;return`Dropping color ${e} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function rm(e){return`Position range does not support relative band size for ${e}.`}function ho(e,t){return`Dropping ${te(e)} from channel "${t}" since it does not contain any data field, datum, value, or signal.`}const sm="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function is(e,t,n){return`${e} dropped as it is incompatible with "${t}"${n?` when ${n}`:""}.`}function om(e){return`${e} encoding has no scale, so specified scale is ignored.`}function am(e){return`${e}-encoding is dropped as ${e} is not a valid encoding channel.`}function cm(e){return`${e} encoding should be discrete (ordinal / nominal / binned).`}function lm(e){return`${e} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function um(e){return`Facet encoding dropped as ${e.join(" and ")} ${e.length>1?"are":"is"} also specified.`}function js(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${t==="ordinal"?"order":"magnitude"}.`}function fm(e){return`The ${e} for range marks cannot be an expression`}function dm(e,t){return`Line mark is for continuous lines and thus cannot be used with ${e&&t?"x2 and y2":e?"x2":"y2"}. We will use the rule mark (line segments) instead.`}function pm(e,t){return`Specified orient "${e}" overridden with "${t}".`}function gm(e){return`Cannot use the scale property "${e}" with non-color channel.`}function hm(e){return`Cannot use the relative band size with ${e} scale.`}function mm(e){return`Using unaggregated domain with raw field has no effect (${te(e)}).`}function ym(e){return`Unaggregated domain not applicable for "${e}" since it produces values outside the origin domain of the source data.`}function bm(e){return`Unaggregated domain is currently unsupported for log scale (${te(e)}).`}function vm(e){return`Cannot apply size to non-oriented mark "${e}".`}function xm(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}function Sm(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}function Ju(e,t,n){return`${n}-scale's "${t}" is dropped as it does not work with ${e} scale.`}function Qu(e){return`The step for "${e}" is dropped because the ${e==="width"?"x":"y"} is continuous.`}function Em(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${te(n)} and ${te(i)}). Using ${te(n)}.`}function wm(e,t,n,i){return`Conflicting ${t.toString()} property "${e.toString()}" (${te(n)} and ${te(i)}). Using the union of the two domains.`}function $m(e){return`Setting the scale to be independent for "${e}" means we also have to set the guide (axis or legend) to be independent.`}function Om(e){return`Dropping sort property ${te(e)} as unioned domains only support boolean or op "count", "min", and "max".`}const Rc="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",Cm="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Nm="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",_m="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Tm(e){return`Cannot stack "${e}" if there is already "${e}2".`}function Am(e){return`Cannot stack non-linear scale (${e}).`}function Fm(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}function Tr(e,t){return`Invalid ${e}: ${te(t)}.`}function km(e){return`Dropping day from datetime ${te(e)} as day cannot be combined with other units.`}function Im(e,t){return`${t?"extent ":""}${t&&e?"and ":""}${e?"center ":""}${t&&e?"are ":"is "}not needed when data are aggregated.`}function Rm(e,t,n){return`${e} is not usually used with ${t} for ${n}.`}function Pm(e,t){return`Continuous axis should not have customized aggregation function ${e}; ${t} already agregates the axis.`}function Pc(e){return`1D error band does not support ${e}.`}function Zu(e){return`Channel ${e} is required for "binned" bin.`}function Lm(e){return`Channel ${e} should not be used with "binned" bin.`}function zm(e){return`Domain for ${e} is required for threshold scale.`}globalThis&&globalThis.__classPrivateFieldSet;globalThis&&globalThis.__classPrivateFieldGet;const ef=Yp(Kp);let oi=ef;function Dm(e){return oi=e,oi}function Mm(){return oi=ef,oi}function S(...e){oi.warn(...e)}function jm(...e){oi.debug(...e)}function Mn(e){if(e&&q(e)){for(const t of oa)if(t in e)return!0}return!1}const tf=["january","february","march","april","may","june","july","august","september","october","november","december"],Um=tf.map(e=>e.substr(0,3)),nf=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Bm=nf.map(e=>e.substr(0,3));function Wm(e){if(Vr(e)&&(e=+e),ue(e))return e>4&&S(Tr("quarter",e)),e-1;throw new Error(Tr("quarter",e))}function Gm(e){if(Vr(e)&&(e=+e),ue(e))return e-1;{const t=e.toLowerCase(),n=tf.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Um.indexOf(i);if(r!==-1)return r;throw new Error(Tr("month",e))}}function Hm(e){if(Vr(e)&&(e=+e),ue(e))return e%7;{const t=e.toLowerCase(),n=nf.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Bm.indexOf(i);if(r!==-1)return r;throw new Error(Tr("day",e))}}function sa(e,t){const n=[];if(t&&e.day!==void 0&&x(e).length>1&&(S(km(e)),e=D(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?Gm(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Wm(e.quarter):e.quarter;n.push(ue(i)?i*3:`${i}*3`)}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Hm(e.day):e.day;n.push(ue(i)?i+1:`${i}+1`)}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r>"u"?0:r)}return n}function _n(e){const n=sa(e,!0).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function qm(e){const n=sa(e,!1).join(", ");return e.utc?`utc(${n})`:`datetime(${n})`}function Xm(e){const t=sa(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const rf={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},oa=x(rf);function Vm(e){return!!rf[e]}function jn(e){return q(e)?e.binned:sf(e)}function sf(e){return e&&e.startsWith("binned")}function aa(e){return e.startsWith("utc")}function Ym(e){return e.substring(3)}const Km={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function rs(e){return oa.filter(t=>af(e,t))}function of(e){const t=rs(e);return t[t.length-1]}function af(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function Jm(e,t,{end:n}={end:!1}){const i=Xo(t),r=aa(e)?"utc":"";function s(c){return c==="quarter"?`(${r}quarter(${i})-1)`:`${r}${c}(${i})`}let o;const a={};for(const c of oa)af(e,c)&&(a[c]=s(c),o=c);return n&&(a[o]+="+1"),qm(a)}function cf(e){if(!e)return;const t=rs(e);return`timeUnitSpecifier(${te(t)}, ${te(Km)})`}function Qm(e,t,n){if(!e)return;const i=cf(e);return`${n||aa(e)?"utc":"time"}Format(${t}, ${i})`}function he(e){if(!e)return;let t;return L(e)?sf(e)?t={unit:e.substring(6),binned:!0}:t={unit:e}:q(e)&&(t={...e,...e.unit?{unit:e.unit}:{}}),aa(t.unit)&&(t.utc=!0,t.unit=Ym(t.unit)),t}function Zm(e){const{utc:t,...n}=he(e);return n.unit?(t?"utc":"")+x(n).map(i=>se(`${i==="unit"?"":`_${i}_`}${n[i]}`)).join(""):(t?"utc":"")+"timeunit"+x(n).map(i=>se(`_${i}_${n[i]}`)).join("")}function lf(e,t=n=>n){const n=he(e),i=of(n.unit);if(i&&i!=="day"){const r={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},{step:s,part:o}=uf(i,n.step),a={...r,[o]:+r[o]+s};return`${t(_n(a))} - ${t(_n(r))}`}}const ey={year:1,month:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};function ty(e){return!!ey[e]}function uf(e,t=1){if(ty(e))return{part:e,step:t};switch(e){case"day":case"dayofyear":return{part:"date",step:t};case"quarter":return{part:"month",step:t*3};case"week":return{part:"date",step:t*7}}}function ny(e){return e==null?void 0:e.param}function ca(e){return!!(e!=null&&e.field)&&e.equal!==void 0}function la(e){return!!(e!=null&&e.field)&&e.lt!==void 0}function ua(e){return!!(e!=null&&e.field)&&e.lte!==void 0}function fa(e){return!!(e!=null&&e.field)&&e.gt!==void 0}function da(e){return!!(e!=null&&e.field)&&e.gte!==void 0}function pa(e){if(e!=null&&e.field){if(T(e.range)&&e.range.length===2)return!0;if(k(e.range))return!0}return!1}function ga(e){return!!(e!=null&&e.field)&&(T(e.oneOf)||T(e.in))}function iy(e){return!!(e!=null&&e.field)&&e.valid!==void 0}function ff(e){return ga(e)||ca(e)||pa(e)||la(e)||fa(e)||ua(e)||da(e)}function at(e,t){return gs(e,{timeUnit:t,wrapTime:!0})}function ry(e,t){return e.map(n=>at(n,t))}function df(e,t=!0){const{field:n}=e,i=he(e.timeUnit),{unit:r,binned:s}=i||{},o=$(e,{expr:"datum"}),a=r?`time(${s?o:Jm(r,n)})`:o;if(ca(e))return`${a}===${at(e.equal,r)}`;if(la(e)){const c=e.lt;return`${a}<${at(c,r)}`}else if(fa(e)){const c=e.gt;return`${a}>${at(c,r)}`}else if(ua(e)){const c=e.lte;return`${a}<=${at(c,r)}`}else if(da(e)){const c=e.gte;return`${a}>=${at(c,r)}`}else{if(ga(e))return`indexof([${ry(e.oneOf,r).join(",")}], ${a}) !== -1`;if(iy(e))return ha(a,e.valid);if(pa(e)){const{range:c}=e,l=k(c)?{signal:`${c.signal}[0]`}:c[0],u=k(c)?{signal:`${c.signal}[1]`}:c[1];if(l!==null&&u!==null&&t)return"inrange("+a+", ["+at(l,r)+", "+at(u,r)+"])";const f=[];return l!==null&&f.push(`${a} >= ${at(l,r)}`),u!==null&&f.push(`${a} <= ${at(u,r)}`),f.length>0?f.join(" && "):"true"}}throw new Error(`Invalid field predicate: ${te(e)}`)}function ha(e,t=!0){return t?`isValid(${e}) && isFinite(+${e})`:`!isValid(${e}) || !isFinite(+${e})`}function sy(e){return ff(e)&&e.timeUnit?{...e,timeUnit:he(e.timeUnit)}:e}const ir={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function oy(e){return e==="quantitative"||e==="temporal"}function pf(e){return e==="ordinal"||e==="nominal"}const Tn=ir.quantitative,ma=ir.ordinal,ai=ir.temporal,ya=ir.nominal,Ei=ir.geojson;function ay(e){if(e)switch(e=e.toLowerCase(),e){case"q":case Tn:return"quantitative";case"t":case ai:return"temporal";case"o":case ma:return"ordinal";case"n":case ya:return"nominal";case Ei:return"geojson"}}const Ae={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},mo={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function cy(e,t){const n=mo[e],i=mo[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const ly={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Lc(e){return ly[e]}const gf=new Set(["linear","log","pow","sqrt","symlog"]),hf=new Set([...gf,"time","utc"]);function mf(e){return gf.has(e)}const yf=new Set(["quantile","quantize","threshold"]),uy=new Set([...hf,...yf,"sequential","identity"]),fy=new Set(["ordinal","bin-ordinal","point","band"]);function be(e){return fy.has(e)}function De(e){return uy.has(e)}function Ye(e){return hf.has(e)}function ci(e){return yf.has(e)}const dy={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0};function py(e){return!L(e)&&!!e.name}function bf(e){return e==null?void 0:e.param}function gy(e){return e==null?void 0:e.unionWith}function hy(e){return q(e)&&"field"in e}const my={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,domainRaw:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:oO,domain:aO,range:cO,rangeMax:lO,rangeMin:uO,scheme:fO,...yy}=my,by=x(yy);function yo(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Ye(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Ye(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"domainRaw":case"clamp":return Ye(e);case"nice":return Ye(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return De(e)&&!G(["log","time","utc","threshold","quantile"],e)}}function vf(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Qn(e)?void 0:gm(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"domainRaw":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function vy(e,t){return G([ma,ya],t)?e===void 0||be(e):t===ai?G([Ae.TIME,Ae.UTC,void 0],e):t===Tn?mf(e)||ci(e)||e===void 0:!0}function xy(e,t,n=!1){if(!Mt(e))return!1;switch(e){case oe:case me:case Zt:case xi:case We:case nt:return Ye(t)||t==="band"?!0:t==="point"?!n:!1;case zt:case nn:case Dt:case en:case tn:case Ln:return Ye(t)||ci(t)||G(["band","point","ordinal"],t);case ke:case xt:case St:return t!=="band";case rn:case Ie:return t==="ordinal"||ci(t)}}const Ne={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},xf=Ne.arc,ss=Ne.area,os=Ne.bar,Sy=Ne.image,as=Ne.line,cs=Ne.point,Ey=Ne.rect,Ar=Ne.rule,Sf=Ne.text,ba=Ne.tick,wy=Ne.trail,va=Ne.circle,xa=Ne.square,Ef=Ne.geoshape;function an(e){return["line","area","trail"].includes(e)}function Sa(e){return["rect","bar","image","arc"].includes(e)}const $y=new Set(x(Ne));function mt(e){return e.type}const Oy=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],Cy=["fill","fillOpacity"],Ny=[...Oy,...Cy],_y={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},zc=x(_y),Ty={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],line:["point"],tick:["bandSize","thickness"]},Ay={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},Fy={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},wf=x(Fy);function An(e){return e&&e.band!=null}const ky={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},$f=5,Iy={binSpacing:1,continuousBandSize:$f,minBandSize:.25,timeUnitBandPosition:.5},Ry={binSpacing:0,continuousBandSize:$f,minBandSize:.25,timeUnitBandPosition:.5},Py={thickness:1};function Ly(e){return mt(e)?e.type:e}function Ea(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=$a(e);return E(n)&&!Du(n.aggregate)&&r&&Ye(r.get("type"))?zy({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function zy({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return an(n.type)?i:Y("invalid",n,r)===null?[Dy(e,t),i]:i}function Dy(e,t){const n=wa(e,!0),r=zn(t)==="y"?{field:{group:"height"}}:{value:0};return{test:n,...r}}function wa(e,t=!0){return ha(L(e)?e:$(e,{expr:"datum"}),!t)}function My(e){const{datum:t}=e;return Mn(t)?_n(t):`${te(t)}`}function Sn(e,t,n,i){const r={};if(t&&(r.scale=t),$t(e)){const{datum:s}=e;Mn(s)?r.signal=_n(s):k(s)?r.signal=s.signal:nr(s)?r.signal=s.expr:r.value=s}else r.field=$(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function Fr({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:s=.5}){const o=0<s&&s<1?"datum":void 0,a=$(t,{expr:o,suffix:r}),c=n!==void 0?$(n,{expr:o}):$(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const u=s===0?a:c;l.field=u}else{const u=k(s)?`${s.signal} * ${a} + (1-${s.signal}) * ${c}`:`${s} * ${a} + ${1-s} * ${c}`;l.signal=`scale("${e}", ${u})`}return i&&(l.offset=i),l}function jy({scaleName:e,fieldDef:t}){const n=$(t,{expr:"datum"}),i=$(t,{expr:"datum",suffix:"end"});return`abs(scale("${e}", ${i}) - scale("${e}", ${n}))`}function $a({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l,bandPosition:u}){if(t){if(j(t)){const f=o==null?void 0:o.get("type");if(Ce(t)){u??(u=kf({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:d,timeUnit:p,type:g}=t;if(ne(d)||u&&p&&g===ai)return a!=null&&a.impute?Sn(t,s,{binSuffix:"mid"},{offset:c}):u&&!be(f)?Fr({scaleName:s,fieldOrDatumDef:t,bandPosition:u,offset:c}):Sn(t,s,ar(t,e)?{binSuffix:"range"}:{},{offset:c});if(xe(d)){if(E(n))return Fr({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:u,offset:c});S(Zu(e===oe?tt:vt))}}return Sn(t,s,be(f)?{binSuffix:"range"}:{},{offset:c,band:f==="band"?u??t.bandPosition??.5:void 0})}else if(Ze(t)){const f=t.value,d=c?{offset:c}:{};return{...ji(e,f),...d}}}return Jp(l)&&(l=l()),l&&{...l,...c?{offset:c}:{}}}function ji(e,t){return G(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:G(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:re(t)}function Fn(e){return e&&e!=="number"&&e!=="time"}function Of(e,t,n){return`${e}(${t}${n?`, ${te(n)}`:""})`}const Uy="  ";function Oa({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var c,l;if(Fn(n))return Ke({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const o=Cf(e,i,r),a=li(e);if(t===void 0&&n===void 0&&s.customFormatTypes){if(a==="quantitative"){if(r&&s.normalizedNumberFormatType)return Ke({fieldOrDatumDef:e,format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,expr:i,config:s});if(s.numberFormatType)return Ke({fieldOrDatumDef:e,format:s.numberFormat,formatType:s.numberFormatType,expr:i,config:s})}if(a==="temporal"&&s.timeFormatType&&E(e)&&e.timeUnit===void 0)return Ke({fieldOrDatumDef:e,format:s.timeFormat,formatType:s.timeFormatType,expr:i,config:s})}if(fi(e)){const u=Wy({field:o,timeUnit:E(e)?(c=he(e.timeUnit))==null?void 0:c.unit:void 0,format:t,formatType:s.timeFormatType,rawTimeFormat:s.timeFormat,isUTCScale:Un(e)&&((l=e.scale)==null?void 0:l.type)===Ae.UTC});return u?{signal:u}:void 0}if(t=bo({type:a,specifiedFormat:t,config:s,normalizeStack:r}),E(e)&&ne(e.bin)){const u=$(e,{expr:i,binSuffix:"end"});return{signal:rr(o,u,t,n,s)}}else return t||li(e)==="quantitative"?{signal:`${Tf(o,t)}`}:{signal:`isValid(${o}) ? ${o} : ""+${o}`}}function Cf(e,t,n){return E(e)?n?`${$(e,{expr:t,suffix:"end"})}-${$(e,{expr:t,suffix:"start"})}`:$(e,{expr:t}):My(e)}function Ke({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o??(o=Cf(e,i,r)),o!=="datum.value"&&E(e)&&ne(e.bin)){const a=$(e,{expr:i,binSuffix:"end"});return{signal:rr(o,a,t,n,s)}}return{signal:Of(n,o,t)}}function Nf(e,t,n,i,r,s){var o;if(!(L(i)&&Fn(i))&&!(n===void 0&&i===void 0&&r.customFormatTypes&&li(e)==="quantitative"&&(r.normalizedNumberFormatType&&ui(e)&&e.stack==="normalize"||r.numberFormatType))){if(ui(e)&&e.stack==="normalize"&&r.normalizedNumberFormat)return bo({type:"quantitative",config:r,normalizeStack:!0});if(fi(e)){const a=E(e)?(o=he(e.timeUnit))==null?void 0:o.unit:void 0;return a===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:By({specifiedFormat:n,timeUnit:a,config:r,omitTimeFormatConfig:s})}return bo({type:t,specifiedFormat:n,config:r})}}function _f(e,t,n){var i;if(e&&(k(e)||e==="number"||e==="time"))return e;if(fi(t)&&n!=="time"&&n!=="utc")return E(t)&&((i=he(t==null?void 0:t.timeUnit))!=null&&i.utc)?"utc":"time"}function bo({type:e,specifiedFormat:t,config:n,normalizeStack:i}){if(L(t))return t;if(e===Tn)return i?n.normalizedNumberFormat:n.numberFormat}function By({specifiedFormat:e,timeUnit:t,config:n,omitTimeFormatConfig:i}){return e||(t?{signal:cf(t)}:i?void 0:n.timeFormat)}function Tf(e,t){return`format(${e}, "${t||""}")`}function Dc(e,t,n,i){return Fn(n)?Of(n,e,t):Tf(e,(L(t)?t:void 0)??i.numberFormat)}function rr(e,t,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return rr(e,t,r.numberFormat,r.numberFormatType,r);const s=Dc(e,n,i,r),o=Dc(t,n,i,r);return`${ha(e,!1)} ? "null" : ${s} + "${Uy}" + ${o}`}function Wy({field:e,timeUnit:t,format:n,formatType:i,rawTimeFormat:r,isUTCScale:s}){return!t||n?!t&&i?`${i}(${e}, '${n}')`:(n=L(n)?n:r,`${s?"utc":"time"}Format(${e}, '${n}')`):Qm(t,e,s)}const ls="min",Gy={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function Mc(e){return e in Gy}function Af(e){return!!(e!=null&&e.encoding)}function pt(e){return e&&(e.op==="count"||!!e.field)}function Ff(e){return e&&T(e)}function sr(e){return"row"in e||"column"in e}function Ca(e){return!!e&&"header"in e}function us(e){return"facet"in e}function Hy(e){return e.param}function qy(e){return e&&!L(e)&&"repeat"in e}function jc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return{...n?{timeUnit:n}:{},...i?{bin:i}:{},...r?{aggregate:r}:{},field:t}}function Na(e){return"sort"in e}function kf({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(j(e)&&e.bandPosition!==void 0)return e.bandPosition;if(E(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return Sa(n.type)?0:Rt("timeUnitBandPosition",n,i);if(ne(s))return .5}}function If({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var l,u,f;const a=Re(e),c=Y(o?"size":a,i,r,{vgChannel:a});if(c!==void 0)return c;if(E(t)){const{timeUnit:d,bin:p}=t;if(d&&!n)return{band:Rt("timeUnitBandSize",i,r)};if(ne(p)&&!be(s))return{band:1}}if(Sa(i.type))return s?be(s)?((l=r[i.type])==null?void 0:l.discreteBandSize)||{band:1}:(u=r[i.type])==null?void 0:u.continuousBandSize:(f=r[i.type])==null?void 0:f.discreteBandSize}function Rf(e,t,n,i){return ne(e.bin)||e.timeUnit&&Ce(e)&&e.type==="temporal"?kf({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function Pf(e){return e&&!!e.sort&&!e.field}function fs(e){return e&&"condition"in e}function ds(e){const t=e==null?void 0:e.condition;return!!t&&!T(t)&&E(t)}function or(e){const t=e==null?void 0:e.condition;return!!t&&!T(t)&&j(t)}function Xy(e){const t=e==null?void 0:e.condition;return!!t&&(T(t)||Ze(t))}function E(e){return e&&(!!e.field||e.aggregate==="count")}function li(e){return e==null?void 0:e.type}function $t(e){return e&&"datum"in e}function Gt(e){return Ce(e)&&!Ir(e)||kr(e)}function Uc(e){return Ce(e)&&e.type==="quantitative"&&!e.bin||kr(e)}function kr(e){return $t(e)&&ue(e.datum)}function j(e){return E(e)||$t(e)}function Ce(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function Ze(e){return e&&"value"in e&&"value"in e}function Un(e){return e&&("scale"in e||"sort"in e)}function ui(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Lf(e){return e&&"legend"in e}function zf(e){return e&&("format"in e||"formatType"in e)}function Vy(e){return Te(e,["legend","axis","header","scale"])}function Yy(e){return"op"in e}function $(e,t={}){let n=e.field;const i=t.prefix;let r=t.suffix,s="";if(Jy(e))n=wu("count");else{let o;if(!t.nofn)if(Yy(e))o=e.op;else{const{bin:a,aggregate:c,timeUnit:l}=e;ne(a)?(o=Mu(a),r=(t.binSuffix??"")+(t.suffix??"")):c?sn(c)?(s=`["${n}"]`,n=`argmax_${c.argmax}`):It(c)?(s=`["${n}"]`,n=`argmin_${c.argmin}`):o=String(c):l&&!jn(l)&&(o=Zm(l),r=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+(t.suffix??""))}o&&(n=n?`${o}_${n}`:o)}return r&&(n=`${n}_${r}`),i&&(n=`${i}_${n}`),t.forAs?Vo(n):t.expr?xu(n,t.expr)+s:Ue(n)+s}function Ir(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return E(e)&&!!e.bin;case"temporal":return!1}throw new Error(Yu(e.type))}function Ky(e){var t;return Un(e)&&ci((t=e.scale)==null?void 0:t.type)}function Jy(e){return e.aggregate==="count"}function Qy(e,t){var o;const{field:n,bin:i,timeUnit:r,aggregate:s}=e;if(s==="count")return t.countTitle;if(ne(i))return`${n} (binned)`;if(r&&!jn(r)){const a=(o=he(r))==null?void 0:o.unit;if(a)return`${n} (${rs(a).join("-")})`}else if(s)return sn(s)?`${n} for max ${s.argmax}`:It(s)?`${n} for min ${s.argmin}`:`${Zi(s)} of ${n}`;return n}function Zy(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(sn(t))return`${r} for argmax(${t.argmax})`;if(It(t))return`${r} for argmin(${t.argmin})`;const s=i&&!jn(i)?he(i):void 0,o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||ne(n)&&"bin";return o?`${o.toUpperCase()}(${r})`:r}const Df=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Zy(e);default:return Qy(e,t)}};let Mf=Df;function jf(e){Mf=e}function eb(){jf(Df)}function Zn(e,t,{allowDisabling:n,includeDefault:i=!0}){var a;const r=(a=_a(e))==null?void 0:a.title;if(!E(e))return r??e.title;const s=e,o=i?Ta(s,t):void 0;return n?fe(r,s.title,o):r??s.title??o}function _a(e){if(ui(e)&&e.axis)return e.axis;if(Lf(e)&&e.legend)return e.legend;if(Ca(e)&&e.header)return e.header}function Ta(e,t){return Mf(e,t)}function Rr(e){if(zf(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}else{const t=_a(e)??{},{format:n,formatType:i}=t;return{format:n,formatType:i}}}function tb(e,t){var s;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(Na(e)&&T(e.sort))return"ordinal";const{aggregate:n,bin:i,timeUnit:r}=e;if(r)return"temporal";if(i||n&&!sn(n)&&!It(n))return"quantitative";if(Un(e)&&((s=e.scale)!=null&&s.type))switch(mo[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function yt(e){if(E(e))return e;if(ds(e))return e.condition}function de(e){if(j(e))return e;if(or(e))return e.condition}function Uf(e,t,n,i={}){if(L(e)||ue(e)||bi(e)){const r=L(e)?"string":ue(e)?"number":"boolean";return S(tm(t,r,e)),{value:e}}return j(e)?Pr(e,t,n,i):or(e)?{...e,condition:Pr(e.condition,t,n,i)}:e}function Pr(e,t,n,i){if(zf(e)){const{format:r,formatType:s,...o}=e;if(Fn(s)&&!n.customFormatTypes)return S(Ic(t)),Pr(o,t,n,i)}else{const r=ui(e)?"axis":Lf(e)?"legend":Ca(e)?"header":null;if(r&&e[r]){const{format:s,formatType:o,...a}=e[r];if(Fn(o)&&!n.customFormatTypes)return S(Ic(t)),Pr({...e,[r]:a},t,n,i)}}return E(e)?Aa(e,t,i):nb(e)}function nb(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=ue(n)?"quantitative":L(n)?"nominal":Mn(n)?"temporal":void 0,{...e,type:t}}function Aa(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a={...e};if(!n&&i&&!na(i)&&!sn(i)&&!It(i)&&(S(im(i)),delete a.aggregate),r&&(a.timeUnit=he(r)),o&&(a.field=`${o}`),ne(s)&&(a.bin=ps(s,t)),xe(s)&&!ye(t)&&S(Lm(t)),Ce(a)){const{type:c}=a,l=ay(c);c!==l&&(a.type=l),c!=="quantitative"&&Du(i)&&(S(nm(c,i)),a.type="quantitative")}else if(!Fu(t)){const c=tb(a,t);a.type=c}if(Ce(a)){const{compatible:c,warning:l}=ib(a,t)||{};c===!1&&S(l)}if(Na(a)&&L(a.sort)){const{sort:c}=a;if(Mc(c))return{...a,sort:{encoding:c}};const l=c.substr(1);if(c.charAt(0)==="-"&&Mc(l))return{...a,sort:{encoding:l,order:"descending"}}}if(Ca(a)){const{header:c}=a;if(c){const{orient:l,...u}=c;if(l)return{...a,header:{...u,labelOrient:c.labelOrient||l,titleOrient:c.titleOrient||l}}}}return a}function ps(e,t){return bi(e)?{maxbins:$c(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?{...e,maxbins:$c(t)}:e}const Gn={compatible:!0};function ib(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case Tt:case At:case Yr:return Ir(e)?Gn:{compatible:!1,warning:cm(t)};case oe:case me:case Zt:case xi:case ke:case xt:case St:case er:case tr:case Kr:case Nn:case Jr:case Qr:case Ln:case We:case nt:case Zr:return Gn;case rt:case Be:case it:case st:return n!==Tn?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:Gn;case Dt:case en:case tn:case nn:case zt:case Lt:case Pt:case tt:case vt:return n==="nominal"&&!e.sort?{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`}:Gn;case Ie:case rn:return!Ir(e)&&!Ky(e)?{compatible:!1,warning:lm(t)}:Gn;case si:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Gn}}function fi(e){const{formatType:t}=Rr(e);return t==="time"||!t&&rb(e)}function rb(e){return e&&(e.type==="temporal"||E(e)&&!!e.timeUnit)}function gs(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var c;const s=t&&((c=he(t))==null?void 0:c.unit);let o=s||n==="temporal",a;return nr(e)?a=e.expr:k(e)?a=e.signal:Mn(e)?(o=!0,a=_n(e)):(L(e)||ue(e))&&o&&(a=`datetime(${te(e)})`,Vm(s)&&(ue(e)&&e<1e4||L(e)&&isNaN(Date.parse(e)))&&(a=_n({[s]:e}))),a?i&&o?`time(${a})`:a:r?void 0:te(e)}function Bf(e,t){const{type:n}=e;return t.map(i=>{const r=E(e)&&!jn(e.timeUnit)?e.timeUnit:void 0,s=gs(i,{timeUnit:r,type:n,undefinedIfExprNotRequired:!0});return s!==void 0?{signal:s}:i})}function ar(e,t){return ne(e.bin)?Mt(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const Bc={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function cr(e){return e==null?void 0:e.condition}const Wf=["domain","grid","labels","ticks","title"],sb={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},Gf={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},ob={...Gf,style:1,labelExpr:1,encoding:1};function Wc(e){return!!ob[e]}const ab={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Hf=x(ab);function jt(e){return"mark"in e}class hs{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return jt(t)?Ly(t.mark)===this.name:!1}}function En(e,t){const n=e&&e[t];return n?T(n)?On(n,i=>!!i.field):E(n)||ds(n):!1}function qf(e,t){const n=e&&e[t];return n?T(n)?On(n,i=>!!i.field):E(n)||$t(n)||or(n):!1}function vo(e,t){if(ye(t)){const n=e[t];if((E(n)||$t(n))&&(pf(n.type)||E(n)&&n.timeUnit)){const i=Qo(t);return qf(e,i)}}return!1}function Fa(e){return On(ch,t=>{if(En(e,t)){const n=e[t];if(T(n))return On(n,i=>!!i.aggregate);{const i=yt(n);return i&&!!i.aggregate}}return!1})}function Xf(e,t){const n=[],i=[],r=[],s=[],o={};return ka(e,(a,c)=>{if(E(a)){const{field:l,aggregate:u,bin:f,timeUnit:d,...p}=a;if(u||d||f){const g=_a(a),h=g==null?void 0:g.title;let m=$(a,{forAs:!0});const y={...h?[]:{title:Zn(a,t,{allowDisabling:!0})},...p,field:m};if(u){let b;if(sn(u)?(b="argmax",m=$({op:"argmax",field:u.argmax},{forAs:!0}),y.field=`${m}.${l}`):It(u)?(b="argmin",m=$({op:"argmin",field:u.argmin},{forAs:!0}),y.field=`${m}.${l}`):u!=="boxplot"&&u!=="errorbar"&&u!=="errorband"&&(b=u),b){const C={op:b,as:m};l&&(C.field=l),s.push(C)}}else if(n.push(m),Ce(a)&&ne(f)){if(i.push({bin:f,field:l,as:m}),n.push($(a,{binSuffix:"end"})),ar(a,c)&&n.push($(a,{binSuffix:"range"})),ye(c)){const b={field:`${m}_end`};o[`${c}2`]=b}y.bin="binned",Fu(c)||(y.type=Tn)}else if(d&&!jn(d)){r.push({timeUnit:d,field:l,as:m});const b=Ce(a)&&a.type!==ai&&"time";b&&(c===er||c===Nn?y.formatType=b:yh(c)?y.legend={formatType:b,...y.legend}:ye(c)&&(y.axis={formatType:b,...y.axis}))}o[c]=y}else n.push(l),o[c]=e[c]}else o[c]=e[c]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function cb(e,t,n){const i=vh(t,n);if(i){if(i==="binned"){const r=e[t===tt?oe:me];return!!(E(r)&&E(e[t])&&xe(r.bin))}}else return!1;return!0}function lb(e,t,n,i){const r={};for(const s of x(e))Au(s)||S(am(s));for(let s of ph){if(!e[s])continue;const o=e[s];if(Si(s)){const a=Iu(s),c=r[a];if(E(c)){if(oy(c.type)&&E(o)&&!c.timeUnit){S(Zh(a));continue}}else s=a,S(em(a))}if(s==="angle"&&t==="arc"&&!e.theta&&(S(Qh),s=We),!cb(e,s,t)){S(is(s,t));continue}if(s===zt&&t==="line"){const a=yt(e[s]);if(a!=null&&a.aggregate){S(sm);continue}}if(s===ke&&(n?"fill"in e:"stroke"in e)){S(Ku("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(s===tr||s===si&&!T(o)&&!Ze(o)||s===Nn&&T(o)){if(o){if(s===si){const a=e[s];if(Pf(a)){r[s]=a;continue}}r[s]=le(o).reduce((a,c)=>(E(c)?a.push(Aa(c,s)):S(ho(c,s)),a),[])}}else{if(s===Nn&&o===null)r[s]=null;else if(!E(o)&&!$t(o)&&!Ze(o)&&!fs(o)&&!k(o)){S(ho(o,s));continue}r[s]=Uf(o,s,i)}}return r}function ms(e,t){const n={};for(const i of x(e)){const r=Uf(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function ub(e){const t=[];for(const n of x(e))if(En(e,n)){const i=e[n],r=le(i);for(const s of r)E(s)?t.push(s):ds(s)&&t.push(s.condition)}return t}function ka(e,t,n){if(e)for(const i of x(e)){const r=e[i];if(T(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function fb(e,t,n,i){return e?x(e).reduce((r,s)=>{const o=e[s];return T(o)?o.reduce((a,c)=>t.call(i,a,c,s),r):t.call(i,r,o,s)},n):n}function Vf(e,t){return x(t).reduce((n,i)=>{switch(i){case oe:case me:case Jr:case Zr:case Qr:case tt:case vt:case Zt:case xi:case We:case Lt:case nt:case Pt:case it:case rt:case st:case Be:case er:case Ie:case Ln:case Nn:return n;case si:if(e==="line"||e==="trail")return n;case tr:case Kr:{const r=t[i];if(T(r)||E(r))for(const s of le(r))s.aggregate||n.push($(s,{}));return n}case zt:if(e==="trail")return n;case ke:case xt:case St:case Dt:case en:case tn:case rn:case nn:{const r=yt(t[i]);return r&&!r.aggregate&&n.push($(r,{})),n}}},[])}function db(e){const{tooltip:t,...n}=e;if(!t)return{filteredEncoding:n};let i,r;if(T(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return T(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function xo(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const c=i?` of ${Ia(t)}`:"";return{field:o+t.field,type:t.type,title:k(a)?{signal:`${a}"${escape(c)}"`}:a+c}}),s=ub(n).map(Vy);return{tooltip:[...r,...dt(s,W)]}}function Ia(e){const{title:t,field:n}=e;return fe(t,n)}function Ra(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:c,positionPrefix:l,endPositionPrefix:u=void 0,extraEncoding:f={}})=>{const d=Ia(n);return Yf(e,a,r,{mark:c,encoding:{[t]:{field:`${l}_${n.field}`,type:n.type,...d!==void 0?{title:d}:{},...s!==void 0?{scale:s}:{},...o!==void 0?{axis:o}:{}},...L(u)?{[`${t}2`]:{field:`${u}_${n.field}`}}:{},...i,...f}})}}function Yf(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[{...i,mark:{...n[t],...r?{clip:r}:{},...s?{color:s}:{},...o?{opacity:o}:{},...mt(i.mark)?i.mark:{type:i.mark},style:`${a}-${String(t)}`,...bi(e[t])?{}:e[t]}}]:[]}function Kf(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i[`${r}2`],a=i[`${r}Error`],c=i[`${r}Error2`];return{continuousAxisChannelDef:pr(s,n),continuousAxisChannelDef2:pr(o,n),continuousAxisChannelDefError:pr(a,n),continuousAxisChannelDefError2:pr(c,n),continuousAxis:r}}function pr(e,t){if(e!=null&&e.aggregate){const{aggregate:n,...i}=e;return n!==t&&S(Pm(n,t)),i}else return e}function Jf(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(mt(n)&&n.orient)return n.orient;if(Gt(r)){if(Gt(s)){const o=E(r)&&r.aggregate,a=E(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return fi(s)&&!fi(r)?"horizontal":"vertical"}return"horizontal"}else{if(Gt(s))return"vertical";throw new Error(`Need a valid continuous axis for ${t}s`)}}const Lr="boxplot",pb=["box","median","outliers","rule","ticks"],gb=new hs(Lr,Zf);function Qf(e){return ue(e)?"tukey":e}function Zf(e,{config:t}){e={...e,encoding:ms(e.encoding,t)};const{mark:n,encoding:i,params:r,projection:s,...o}=e,a=mt(n)?n:{type:n};r&&S(Vu("boxplot"));const c=a.extent??t.boxplot.extent,l=Y("size",a,t),u=a.invalid,f=Qf(c),{bins:d,timeUnits:p,transform:g,continuousAxisChannelDef:h,continuousAxis:m,groupby:y,aggregate:b,encodingWithoutContinuousAxis:C,ticksOrient:I,boxOrient:v,customTooltipWithoutAggregatedField:_}=hb(e,c,t),{color:O,size:M,...V}=C,Q=Vp=>Ra(a,m,h,Vp,t.boxplot),ve=Q(V),ot=Q(C),N=Q({...V,...M?{size:M}:{}}),w=xo([{fieldPrefix:f==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:f==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],h,C),P={type:"tick",color:"black",opacity:1,orient:I,invalid:u,aria:!1},F=f==="min-max"?w:xo([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],h,C),R=[...ve({partName:"rule",mark:{type:"rule",invalid:u,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:F}),...ve({partName:"rule",mark:{type:"rule",invalid:u,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:F}),...ve({partName:"ticks",mark:P,positionPrefix:"lower_whisker",extraEncoding:F}),...ve({partName:"ticks",mark:P,positionPrefix:"upper_whisker",extraEncoding:F})],A=[...f!=="tukey"?R:[],...ot({partName:"box",mark:{type:"bar",...l?{size:l}:{},orient:v,invalid:u,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:w}),...N({partName:"median",mark:{type:"tick",invalid:u,...q(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{},...l?{size:l}:{},orient:I,aria:!1},positionPrefix:"mid_box",extraEncoding:w})];if(f==="min-max")return{...o,transform:(o.transform??[]).concat(g),layer:A};const z=`datum["lower_box_${h.field}"]`,H=`datum["upper_box_${h.field}"]`,U=`(${H} - ${z})`,Z=`${z} - ${c} * ${U}`,Ee=`${H} + ${c} * ${U}`,ie=`datum["${h.field}"]`,cn={joinaggregate:ed(h.field),groupby:y},zs={transform:[{filter:`(${Z} <= ${ie}) && (${ie} <= ${Ee})`},{aggregate:[{op:"min",field:h.field,as:`lower_whisker_${h.field}`},{op:"max",field:h.field,as:`upper_whisker_${h.field}`},{op:"min",field:`lower_box_${h.field}`,as:`lower_box_${h.field}`},{op:"max",field:`upper_box_${h.field}`,as:`upper_box_${h.field}`},...b],groupby:y}],layer:R},{tooltip:N0,...qp}=V,{scale:bc,axis:Xp}=h,vc=Ia(h),xc=Te(Xp,["title"]),Sc=Yf(a,"outliers",t.boxplot,{transform:[{filter:`(${ie} < ${Z}) || (${ie} > ${Ee})`}],mark:"point",encoding:{[m]:{field:h.field,type:h.type,...vc!==void 0?{title:vc}:{},...bc!==void 0?{scale:bc}:{},...J(xc)?{}:{axis:xc}},...qp,...O?{color:O}:{},..._?{tooltip:_}:{}}})[0];let dr;const Ec=[...d,...p,cn];return Sc?dr={transform:Ec,layer:[Sc,zs]}:(dr=zs,dr.transform.unshift(...Ec)),{...o,layer:[dr,{transform:g,layer:A}]}}function ed(e){return[{op:"q1",field:e,as:`lower_box_${e}`},{op:"q3",field:e,as:`upper_box_${e}`}]}function hb(e,t,n){const i=Jf(e,Lr),{continuousAxisChannelDef:r,continuousAxis:s}=Kf(e,i,Lr),o=r.field,a=Qf(t),c=[...ed(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${t}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${t}, datum["min_${o}"])`,as:`lower_whisker_${o}`}],{[s]:u,...f}=e.encoding,{customTooltipWithoutAggregatedField:d,filteredEncoding:p}=db(f),{bins:g,timeUnits:h,aggregate:m,groupby:y,encoding:b}=Xf(p,n),C=i==="vertical"?"horizontal":"vertical",I=i,v=[...g,...h,{aggregate:[...m,...c],groupby:y},...l];return{bins:g,timeUnits:h,transform:v,groupby:y,aggregate:m,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:b,ticksOrient:C,boxOrient:I,customTooltipWithoutAggregatedField:d}}const Pa="errorbar",mb=["ticks","rule"],yb=new hs(Pa,td);function td(e,{config:t}){e={...e,encoding:ms(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:c,tooltipEncoding:l}=nd(e,Pa,t);delete s.size;const u=Ra(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,p={type:"tick",orient:o,aria:!1,...f!==void 0?{thickness:f}:{},...d!==void 0?{size:d}:{}},g=[...u({partName:"ticks",mark:p,positionPrefix:"lower",extraEncoding:l}),...u({partName:"ticks",mark:p,positionPrefix:"upper",extraEncoding:l}),...u({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...f!==void 0?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return{...c,transform:n,...g.length>1?{layer:g}:{...g[0]}}}function bb(e,t){const{encoding:n}=e;if(vb(n))return{orient:Jf(e,t),inputType:"raw"};const i=xb(n),r=Sb(n),s=n.x,o=n.y;if(i){if(r)throw new Error(`${t} cannot be both type aggregated-upper-lower and aggregated-error`);const a=n.x2,c=n.y2;if(j(a)&&j(c))throw new Error(`${t} cannot have both x2 and y2`);if(j(a)){if(Gt(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error(`Both x and x2 have to be quantitative in ${t}`)}else if(j(c)){if(Gt(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error(`Both y and y2 have to be quantitative in ${t}`)}throw new Error("No ranged axis")}else{const a=n.xError,c=n.xError2,l=n.yError,u=n.yError2;if(j(c)&&!j(a))throw new Error(`${t} cannot have xError2 without xError`);if(j(u)&&!j(l))throw new Error(`${t} cannot have yError2 without yError`);if(j(a)&&j(l))throw new Error(`${t} cannot have both xError and yError with both are quantiative`);if(j(a)){if(Gt(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(j(l)){if(Gt(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function vb(e){return(j(e.x)||j(e.y))&&!j(e.x2)&&!j(e.y2)&&!j(e.xError)&&!j(e.xError2)&&!j(e.yError)&&!j(e.yError2)}function xb(e){return j(e.x2)||j(e.y2)}function Sb(e){return j(e.xError)||j(e.xError2)||j(e.yError)||j(e.yError2)}function nd(e,t,n){const{mark:i,encoding:r,params:s,projection:o,...a}=e,c=mt(i)?i:{type:i};s&&S(Vu(t));const{orient:l,inputType:u}=bb(e,t),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:h}=Kf(e,l,t),{errorBarSpecificAggregate:m,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:C}=Eb(c,f,d,p,g,u,t,n),{[h]:I,[h==="x"?"x2":"y2"]:v,[h==="x"?"xError":"yError"]:_,[h==="x"?"xError2":"yError2"]:O,...M}=r,{bins:V,timeUnits:Q,aggregate:ve,groupby:ot,encoding:N}=Xf(M,n),w=[...ve,...m],P=u!=="raw"?[]:ot,F=xo(b,f,N,C);return{transform:[...a.transform??[],...V,...Q,...w.length===0?[]:[{aggregate:w,groupby:P}],...y],groupby:P,continuousAxisChannelDef:f,continuousAxis:h,encodingWithoutContinuousAxis:N,ticksOrient:l==="vertical"?"horizontal":"vertical",markDef:c,outerSpec:a,tooltipEncoding:F}}function Eb(e,t,n,i,r,s,o,a){let c=[],l=[];const u=t.field;let f,d=!1;if(s==="raw"){const p=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,g=e.extent?e.extent:p==="mean"?"stderr":"iqr";if(p==="median"!=(g==="iqr")&&S(Rm(p,g,o)),g==="stderr"||g==="stdev")c=[{op:g,field:u,as:`extent_${u}`},{op:p,field:u,as:`center_${u}`}],l=[{calculate:`datum["center_${u}"] + datum["extent_${u}"]`,as:`upper_${u}`},{calculate:`datum["center_${u}"] - datum["extent_${u}"]`,as:`lower_${u}`}],f=[{fieldPrefix:"center_",titlePrefix:Zi(p)},{fieldPrefix:"upper_",titlePrefix:Gc(p,g,"+")},{fieldPrefix:"lower_",titlePrefix:Gc(p,g,"-")}],d=!0;else{let h,m,y;g==="ci"?(h="mean",m="ci0",y="ci1"):(h="median",m="q1",y="q3"),c=[{op:m,field:u,as:`lower_${u}`},{op:y,field:u,as:`upper_${u}`},{op:h,field:u,as:`center_${u}`}],f=[{fieldPrefix:"upper_",titlePrefix:Zn({field:u,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Zn({field:u,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Zn({field:u,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&S(Im(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:`datum["${n.field}"]`,as:`upper_${u}`},{calculate:`datum["${u}"]`,as:`lower_${u}`}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:`datum["${u}"] + datum["${i.field}"]`,as:`upper_${u}`}],r?l.push({calculate:`datum["${u}"] + datum["${r.field}"]`,as:`lower_${u}`}):l.push({calculate:`datum["${u}"] - datum["${i.field}"]`,as:`lower_${u}`}));for(const p of l)f.push({fieldPrefix:p.as.substring(0,6),titlePrefix:Cn(Cn(p.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:f,tooltipTitleWithFieldName:d}}function Gc(e,t,n){return`${Zi(e)} ${n} ${t}`}const La="errorband",wb=["band","borders"],$b=new hs(La,id);function id(e,{config:t}){e={...e,encoding:ms(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:c}=nd(e,La,t),l=o,u=Ra(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},p={type:f?"line":"rule"};const g={...l.interpolate?{interpolate:l.interpolate}:{},...l.tension&&l.interpolate?{tension:l.tension}:{}};return f?(d={...d,...g,ariaRoleDescription:"errorband"},p={...p,...g,aria:!1}):l.interpolate?S(Pc("interpolate")):l.tension&&S(Pc("tension")),{...a,transform:n,layer:[...u({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}),...u({partName:"borders",mark:p,positionPrefix:"lower",extraEncoding:c}),...u({partName:"borders",mark:p,positionPrefix:"upper",extraEncoding:c})]}}const rd={};function za(e,t,n){const i=new hs(e,t);rd[e]={normalizer:i,parts:n}}function Ob(){return x(rd)}za(Lr,Zf,pb);za(Pa,td,mb);za(La,id,wb);const Cb=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],sd={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},od={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Nb=x(sd),_b=x(od),Tb={header:1,headerRow:1,headerColumn:1,headerFacet:1},ad=x(Tb),cd=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],Ab={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Fb={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},et="_vgsid_",kb={point:{on:"click",fields:[et],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Da(e){return e==="legend"||!!(e!=null&&e.legend)}function Us(e){return Da(e)&&q(e)}function Ma(e){return!!(e!=null&&e.select)}function ld(e){const t=[];for(const n of e||[]){if(Ma(n))continue;const{expr:i,bind:r,...s}=n;if(r&&i){const o={...s,bind:r,init:i};t.push(o)}else{const o={...s,...i?{update:i}:{},...r?{bind:r}:{}};t.push(o)}}return t}function Ib(e){return ys(e)||Ua(e)||ja(e)}function ja(e){return"concat"in e}function ys(e){return"vconcat"in e}function Ua(e){return"hconcat"in e}function ud({step:e,offsetIsDiscrete:t}){return t?e.for??"offset":"position"}function bt(e){return q(e)&&e.step!==void 0}function Hc(e){return e.view||e.width||e.height}const qc=20,Rb={align:1,bounds:1,center:1,columns:1,spacing:1},Pb=x(Rb);function Lb(e,t,n){const i=n[t],r={},{spacing:s,columns:o}=i;s!==void 0&&(r.spacing=s),o!==void 0&&(us(e)&&!sr(e.facet)||ja(e))&&(r.columns=o),ys(e)&&(r.columns=1);for(const a of Pb)if(e[a]!==void 0)if(a==="spacing"){const c=e[a];r[a]=ue(c)?c:{row:c.row??s,column:c.column??s}}else r[a]=e[a];return r}function So(e,t){return e[t]??e[t==="width"?"continuousWidth":"continuousHeight"]}function zr(e,t){const n=Dr(e,t);return bt(n)?n.step:fd}function Dr(e,t){const n=e[t]??e[t==="width"?"discreteWidth":"discreteHeight"];return fe(n,{step:e.step})}const fd=20,zb={continuousWidth:200,continuousHeight:200,step:fd},Db={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:zb,mark:Ay,arc:{},area:{},bar:Iy,circle:{},geoshape:{},image:{},line:{},point:{},rect:Ry,rule:{color:"black"},square:{},text:{color:"black"},tick:Py,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:dy,projection:{},legend:Ab,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:kb,style:{},title:{},facet:{spacing:qc},concat:{spacing:qc},normalizedNumberFormat:".0%"},Ot=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Xc={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},Vc={blue:Ot[0],orange:Ot[1],red:Ot[2],teal:Ot[3],green:Ot[4],yellow:Ot[5],purple:Ot[6],pink:Ot[7],brown:Ot[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Mb(e={}){return{signals:[{name:"color",value:q(e)?{...Vc,...e}:Vc}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function jb(e){return{signals:[{name:"fontSize",value:q(e)?{...Xc,...e}:Xc}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Ub(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function dd(e){const t=x(e||{}),n={};for(const i of t){const r=e[i];n[i]=cr(r)?Uu(r):Le(r)}return n}function Bb(e){const t=x(e),n={};for(const i of t)n[i]=dd(e[i]);return n}const Wb=[...wf,...Hf,...ad,"background","padding","legend","lineBreak","scale","style","title","view"];function pd(e={}){const{color:t,font:n,fontSize:i,selection:r,...s}=e,o=qr({},D(Db),n?Ub(n):{},t?Mb(t):{},i?jb(i):{},s||{});r&&zo(o,"selection",r,!0);const a=Te(o,Wb);for(const c of["background","lineBreak","padding"])o[c]&&(a[c]=Le(o[c]));for(const c of wf)o[c]&&(a[c]=_e(o[c]));for(const c of Hf)o[c]&&(a[c]=dd(o[c]));for(const c of ad)o[c]&&(a[c]=_e(o[c]));return o.legend&&(a.legend=_e(o.legend)),o.scale&&(a.scale=_e(o.scale)),o.style&&(a.style=Bb(o.style)),o.title&&(a.title=_e(o.title)),o.view&&(a.view=_e(o.view)),a}const Gb=new Set(["view",...$y]),Hb=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],qb={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...Ty};function Xb(e){e=D(e);for(const t of Hb)delete e[t];if(e.axis)for(const t in e.axis)cr(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of Cb)delete e.legend[t];if(e.mark){for(const t of zc)delete e.mark[t];e.mark.tooltip&&q(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(ld(e.params)),delete e.params);for(const t of Gb){for(const i of zc)delete e[t][i];const n=qb[t];if(n)for(const i of n)delete e[t][i];Yb(e,t)}for(const t of Ob())delete e[t];Vb(e);for(const t in e)q(e[t])&&J(e[t])&&delete e[t];return J(e)?void 0:e}function Vb(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=ju(e.title);J(t)||(e.style["group-title"]={...e.style["group-title"],...t}),J(n)||(e.style["group-subtitle"]={...e.style["group-subtitle"],...n}),J(i)?delete e.title:e.title=i}function Yb(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s={...r,...e.style[n??t]};J(s)||(e.style[n??t]=s),i||delete e[t]}function bs(e){return"layer"in e}function Kb(e){return"repeat"in e}function Jb(e){return!T(e.repeat)&&e.repeat.layer}class Ba{map(t,n){return us(t)?this.mapFacet(t,n):Kb(t)?this.mapRepeat(t,n):Ua(t)?this.mapHConcat(t,n):ys(t)?this.mapVConcat(t,n):ja(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(bs(t))return this.mapLayer(t,n);if(jt(t))return this.mapUnit(t,n);throw new Error(ia(t))}mapLayer(t,n){return{...t,layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))}}mapHConcat(t,n){return{...t,hconcat:t.hconcat.map(i=>this.map(i,n))}}mapVConcat(t,n){return{...t,vconcat:t.vconcat.map(i=>this.map(i,n))}}mapConcat(t,n){const{concat:i,...r}=t;return{...r,concat:i.map(s=>this.map(s,n))}}mapFacet(t,n){return{...t,spec:this.map(t.spec,n)}}mapRepeat(t,n){return{...t,spec:this.map(t.spec,n)}}}const Qb={zero:1,center:1,normalize:1};function Zb(e){return e in Qb}const ev=new Set([xf,os,ss,Ar,cs,va,xa,as,Sf,ba]),tv=new Set([os,ss,xf]);function Hn(e){return E(e)&&li(e)==="quantitative"&&!e.bin}function Yc(e,t,{orient:n,type:i}){const r=t==="x"?"y":"radius",s=t==="x",o=e[t],a=e[r];if(E(o)&&E(a))if(Hn(o)&&Hn(a)){if(o.stack)return t;if(a.stack)return r;const c=E(o)&&!!o.aggregate,l=E(a)&&!!a.aggregate;if(c!==l)return c?t:r;if(s&&["bar","area"].includes(i)){if(n==="vertical")return r;if(n==="horizontal")return t}}else{if(Hn(o))return t;if(Hn(a))return r}else{if(Hn(o))return t;if(Hn(a))return r}}function nv(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function gd(e,t){var d,p;const n=mt(e)?e:{type:e},i=n.type;if(!ev.has(i))return null;const r=Yc(t,"x",n)||Yc(t,"theta",n);if(!r)return null;const s=t[r],o=E(s)?$(s,{}):void 0,a=nv(r),c=[],l=new Set;if(t[a]){const g=t[a],h=E(g)?$(g,{}):void 0;h&&h!==o&&(c.push(a),l.add(h));const m=a==="x"?"xOffset":"yOffset",y=t[m],b=E(y)?$(y,{}):void 0;b&&b!==o&&(c.push(m),l.add(b))}const u=gh.reduce((g,h)=>{if(h!=="tooltip"&&En(t,h)){const m=t[h];for(const y of le(m)){const b=yt(y);if(b.aggregate)continue;const C=$(b,{});(!C||!l.has(C))&&g.push({channel:h,fieldDef:b})}}return g},[]);let f;return s.stack!==void 0?bi(s.stack)?f=s.stack?"zero":null:f=s.stack:tv.has(i)&&(f="zero"),!f||!Zb(f)||Fa(t)&&u.length===0?null:(d=s==null?void 0:s.scale)!=null&&d.type&&((p=s==null?void 0:s.scale)==null?void 0:p.type)!==Ae.LINEAR?(s!=null&&s.stack&&S(Am(s.scale.type)),null):j(t[Et(r)])?(s.stack!==void 0&&S(Tm(r)),null):(E(s)&&s.aggregate&&!Ch.has(s.aggregate)&&S(Fm(s.aggregate)),{groupbyChannels:c,groupbyFields:l,fieldChannel:r,impute:s.impute===null?!1:an(i),stackBy:u,offset:f})}function hd(e,t,n){const i=_e(e),r=Y("orient",i,n);if(i.orient=ov(i.type,t,r),r!==void 0&&r!==i.orient&&S(pm(i.orient,r)),i.type==="bar"&&i.orient){const a=Y("cornerRadiusEnd",i,n);if(a!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:ky[i.orient];for(const l of c)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return Y("opacity",i,n)===void 0&&(i.opacity=rv(i.type,t)),Y("cursor",i,n)===void 0&&(i.cursor=iv(i,t,n)),i}function iv(e,t,n){return t.href||e.href||Y("href",e,n)?"pointer":e.cursor}function rv(e,t){if(G([cs,ba,va,xa],e)&&!Fa(t))return .7}function sv(e,t,{graticule:n}){if(n)return!1;const i=Rt("filled",e,t),r=e.type;return fe(i,r!==cs&&r!==as&&r!==Ar)}function ov(e,t,n){switch(e){case cs:case va:case xa:case Sf:case Ey:case Sy:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case os:if(E(i)&&(xe(i.bin)||E(r)&&r.aggregate&&!i.aggregate))return"vertical";if(E(r)&&(xe(r.bin)||E(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s)return(E(i)&&i.type===Tn&&!ne(i.bin)||kr(i))&&E(r)&&xe(r.bin)?"horizontal":"vertical";if(!o)return(E(r)&&r.type===Tn&&!ne(r.bin)||kr(r))&&E(i)&&xe(i.bin)?"vertical":"horizontal"}case Ar:if(s&&!(E(i)&&xe(i.bin))&&o&&!(E(r)&&xe(r.bin)))return;case ss:if(o)return E(r)&&xe(r.bin)?"horizontal":"vertical";if(s)return E(i)&&xe(i.bin)?"vertical":"horizontal";if(e===Ar){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case as:case ba:{const a=Uc(i),c=Uc(r);if(n)return n;if(a&&!c)return e!=="tick"?"horizontal":"vertical";if(!a&&c)return e!=="tick"?"vertical":"horizontal";if(a&&c)return"vertical";{const l=Ce(i)&&i.type===ai,u=Ce(r)&&r.type===ai;if(l&&!u)return"vertical";if(!l&&u)return"horizontal"}return}}return"vertical"}function av(e){const{point:t,line:n,...i}=e;return x(i).length>1?i:i.type}function cv(e){for(const t of["line","area","rule","trail"])e[t]&&(e={...e,[t]:Te(e[t],["point","line"])});return e}function Bs(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?q(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?q(t.point)?t.point:{}:void 0}function Kc(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class lv{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(jt(t)){const{mark:i,encoding:r}=t,s=mt(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!Bs(s,n[s.type],r);case"area":return!!Bs(s,n[s.type],r)||!!Kc(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:o,mark:a,name:c,encoding:l,...u}=t,f=ms(l,r),d=mt(a)?a:{type:a},p=Bs(d,r[d.type],f),g=d.type==="area"&&Kc(d,r[d.type]),h=[{name:c,...s?{params:s}:{},mark:av({...d.type==="area"&&d.opacity===void 0&&d.fillOpacity===void 0?{opacity:.7}:{},...d}),encoding:Te(f,["shape"])}],m=gd(hd(d,f,r),f);let y=f;if(m){const{fieldChannel:b,offset:C}=m;y={...f,[b]:{...f[b],...C?{stack:C}:{}}}}return y=Te(y,["y2","x2"]),g&&h.push({...o?{projection:o}:{},mark:{type:"line",...ii(d,["clip","interpolate","tension","tooltip"]),...g},encoding:y}),p&&h.push({...o?{projection:o}:{},mark:{type:"point",opacity:1,filled:!0,...ii(d,["clip","tooltip"]),...p},encoding:y}),i({...u,layer:h},{...n,config:cv(r)})}}function uv(e,t){return t?sr(e)?yd(e,t):md(e,t):e}function Ws(e,t){return t?yd(e,t):e}function Eo(e,t,n){const i=t[e];if(qy(i)){if(i.repeat in n)return{...t,[e]:n[i.repeat]};S(Hh(i.repeat));return}return t}function md(e,t){if(e=Eo("field",e,t),e!==void 0){if(e===null)return null;if(Na(e)&&pt(e.sort)){const n=Eo("field",e.sort,t);e={...e,...n?{sort:n}:{}}}return e}}function Jc(e,t){if(E(e))return md(e,t);{const n=Eo("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function Qc(e,t){if(j(e)){const n=Jc(e,t);if(n)return n;if(fs(e))return{condition:e.condition}}else{if(or(e)){const n=Jc(e.condition,t);if(n)return{...e,condition:n};{const{condition:i,...r}=e;return r}}return e}}function yd(e,t){const n={};for(const i in e)if(Yn(e,i)){const r=e[i];if(T(r))n[i]=r.map(s=>Qc(s,t)).filter(s=>s);else{const s=Qc(r,t);s!==void 0&&(n[i]=s)}}return n}class fv{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(jt(t)){const{encoding:n,mark:i}=t;if(i==="line"||mt(i)&&i.type==="line")for(const r of dh){const s=zn(r),o=n[s];if(n[r]&&(E(o)&&!xe(o.bin)||$t(o)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return S(dm(!!r.x2,!!r.y2)),i({...t,mark:q(s)?{...s,type:"rule"}:"rule"},n)}}class dv extends Ba{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[gb,yb,$b,new lv,new fv]}map(t,n){if(jt(t)){const i=En(t.encoding,Tt),r=En(t.encoding,At),s=En(t.encoding,Yr);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=Ws(t.encoding,n.repeater),o={...t,...t.name?{name:[n.repeaterPrefix,t.name].filter(c=>c).join("_")}:{},...s?{encoding:s}:{}};if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const c of this.nonFacetUnitNormalizers)if(c.hasMatchingType(o,n.config))return c.run(o,n,a);return o}mapRepeat(t,n){return Jb(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r,...s}=t,{row:o,column:a,layer:c}=i,{repeater:l={},repeaterPrefix:u=""}=n;return o||a?this.mapRepeat({...t,repeat:{...o?{row:o}:{},...a?{column:a}:{}},spec:{repeat:{layer:c},spec:r}},n):{...s,layer:c.map(f=>{const d={...l,layer:f},p=`${(r.name?`${r.name}_`:"")+u}child__layer_${se(f)}`,g=this.mapLayerOrUnit(r,{...n,repeater:d,repeaterPrefix:p});return g.name=p,g})}}mapNonLayerRepeat(t,n){const{repeat:i,spec:r,data:s,...o}=t;!T(i)&&t.columns&&(t=Te(t,["columns"]),S(Fc("repeat")));const a=[],{repeater:c={},repeaterPrefix:l=""}=n,u=!T(i)&&i.row||[c?c.row:null],f=!T(i)&&i.column||[c?c.column:null],d=T(i)&&i||[c?c.repeat:null];for(const g of d)for(const h of u)for(const m of f){const y={repeat:g,row:h,column:m,layer:c.layer},b=(r.name?`${r.name}_`:"")+l+"child__"+(T(i)?`${se(g)}`:(i.row?`row_${se(h)}`:"")+(i.column?`column_${se(m)}`:"")),C=this.map(r,{...n,repeater:y,repeaterPrefix:b});C.name=b,a.push(Te(C,["data"]))}const p=T(i)?t.columns:i.column?i.column.length:1;return{data:r.data??s,align:"all",...o,columns:p,concat:a}}mapFacet(t,n){const{facet:i}=t;return sr(i)&&t.columns&&(t=Te(t,["columns"]),S(Fc("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,c=el({parentProjection:o,projection:r}),l=Zc({parentEncoding:s,encoding:Ws(i,n.repeater)});return this.mapUnit({...t,...c?{projection:c}:{},...l?{encoding:l}:{}},{config:a})}mapFacetedUnit(t,n){const{row:i,column:r,facet:s,...o}=t.encoding,{mark:a,width:c,projection:l,height:u,view:f,params:d,encoding:p,...g}=t,{facetMapping:h,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:s},n),y=Ws(o,n.repeater);return this.mapFacet({...g,...m,facet:h,spec:{...c?{width:c}:{},...u?{height:u}:{},...f?{view:f}:{},...l?{projection:l}:{},mark:a,encoding:y,...d?{params:d}:{}}},n)}getFacetMappingAndLayout(t,n){const{row:i,column:r,facet:s}=t;if(i||r){s&&S(um([...i?[Tt]:[],...r?[At]:[]]));const o={},a={};for(const c of[Tt,At]){const l=t[c];if(l){const{align:u,center:f,spacing:d,columns:p,...g}=l;o[c]=g;for(const h of["align","center","spacing"])l[h]!==void 0&&(a[h]??(a[h]={}),a[h][c]=l[h])}}return{facetMapping:o,layout:a}}else{const{align:o,center:a,spacing:c,columns:l,...u}=s;return{facetMapping:uv(u,n.repeater),layout:{...o?{align:o}:{},...a?{center:a}:{},...c?{spacing:c}:{},...l?{columns:l}:{}}}}}mapLayer(t,{parentEncoding:n,parentProjection:i,...r}){const{encoding:s,projection:o,...a}=t,c={...r,parentEncoding:Zc({parentEncoding:n,encoding:s,layer:!0}),parentProjection:el({parentProjection:i,projection:o})};return super.mapLayer({...a,...t.name?{name:[c.repeaterPrefix,t.name].filter(l=>l).join("_")}:{}},c)}}function Zc({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...x(e),...x(t)]);for(const s of r){const o=t[s],a=e[s];if(j(o)){const c={...a,...o};i[s]=c}else or(o)?i[s]={...o,condition:{...a,...o.condition}}:o||o===null?i[s]=o:(n||Ze(a)||k(a)||j(a)||T(a))&&(i[s]=a)}}else i=t;return!i||J(i)?void 0:i}function el(e){const{parentProjection:t,projection:n}=e;return t&&n&&S(Jh({parentProjection:t,projection:n})),n??t}function Wa(e){return"filter"in e}function pv(e){return(e==null?void 0:e.stop)!==void 0}function bd(e){return"lookup"in e}function gv(e){return"data"in e}function hv(e){return"param"in e}function mv(e){return"pivot"in e}function yv(e){return"density"in e}function bv(e){return"quantile"in e}function vv(e){return"regression"in e}function xv(e){return"loess"in e}function Sv(e){return"sample"in e}function Ev(e){return"window"in e}function wv(e){return"joinaggregate"in e}function $v(e){return"flatten"in e}function Ov(e){return"calculate"in e}function vd(e){return"bin"in e}function Cv(e){return"impute"in e}function Nv(e){return"timeUnit"in e}function _v(e){return"aggregate"in e}function Tv(e){return"stack"in e}function Av(e){return"fold"in e}function Fv(e){return"extent"in e&&!("density"in e)}function kv(e){return e.map(t=>Wa(t)?{filter:Jn(t.filter,sy)}:t)}class Iv extends Ba{map(t,n){return n.emptySelections??(n.emptySelections={}),n.selectionPredicates??(n.selectionPredicates={}),t=tl(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=tl(t,n),t.encoding){const i={};for(const[r,s]of Xt(t.encoding))i[r]=xd(s,n);t={...t,encoding:i}}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const{selection:i,...r}=t;return i?{...r,params:Xt(i).map(([s,o])=>{const{init:a,bind:c,empty:l,...u}=o;u.type==="single"?(u.type="point",u.toggle=!1):u.type==="multi"&&(u.type="point"),n.emptySelections[s]=l!=="none";for(const f of Se(n.selectionPredicates[s]??{}))f.empty=l!=="none";return{name:s,value:a,select:u,bind:c}})}:t}}function tl(e,t){const{transform:n,...i}=e;if(n){const r=n.map(s=>{if(Wa(s))return{filter:wo(s,t)};if(vd(s)&&Dn(s.bin))return{...s,bin:Sd(s.bin)};if(bd(s)){const{selection:o,...a}=s.from;return o?{...s,from:{param:o,...a}}:s}return s});return{...i,transform:r}}return e}function xd(e,t){var i,r;const n=D(e);if(E(n)&&Dn(n.bin)&&(n.bin=Sd(n.bin)),Un(n)&&((r=(i=n.scale)==null?void 0:i.domain)!=null&&r.selection)){const{selection:s,...o}=n.scale.domain;n.scale.domain={...o,...s?{param:s}:{}}}if(fs(n))if(T(n.condition))n.condition=n.condition.map(s=>{const{selection:o,param:a,test:c,...l}=s;return a?s:{...l,test:wo(s,t)}});else{const{selection:s,param:o,test:a,...c}=xd(n.condition,t);n.condition=o?n.condition:{...c,test:wo(n.condition,t)}}return n}function Sd(e){const t=e.extent;if(t!=null&&t.selection){const{selection:n,...i}=t;return{...e,extent:{...i,param:n}}}return e}function wo(e,t){const n=i=>Jn(i,r=>{var s;const o=t.emptySelections[r]??!0,a={param:r,empty:o};return(s=t.selectionPredicates)[r]??(s[r]=[]),t.selectionPredicates[r].push(a),a});return e.selection?n(e.selection):Jn(e.test||e.filter,i=>i.selection?n(i.selection):i)}class $o extends Ba{map(t,n){const i=n.selections??[];if(t.params&&!jt(t)){const r=[];for(const s of t.params)Ma(s)?i.push(s):r.push(s);t.params=r}return n.selections=i,super.map(t,n)}mapUnit(t,n){const i=n.selections;if(!i||!i.length)return t;const r=(n.path??[]).concat(t.name),s=[];for(const o of i)if(!o.views||!o.views.length)s.push(o);else for(const a of o.views)(L(a)&&(a===t.name||r.includes(a))||T(a)&&a.map(c=>r.indexOf(c)).every((c,l,u)=>c!==-1&&(l===0||c>u[l-1])))&&s.push(o);return s.length&&(t.params=s),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=$o.prototype[e];$o.prototype[e]=function(n,i){return t.call(this,n,Rv(n,i))}}function Rv(e,t){return e.name?{...t,path:(t.path??[]).concat(e.name)}:t}function Ed(e,t){t===void 0&&(t=pd(e.config));const n=Dv(e,t),{width:i,height:r}=e,s=Mv(n,{width:i,height:r,autosize:e.autosize},t);return{...n,...s?{autosize:s}:{}}}const Pv=new dv,Lv=new Iv,zv=new $o;function Dv(e,t={}){const n={config:t};return zv.map(Pv.map(Lv.map(e,n),n),n)}function nl(e){return L(e)?{type:e}:e??{}}function Mv(e,t,n){let{width:i,height:r}=t;const s=jt(e)||bs(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(S(Nc("width")),i=void 0),r=="container"&&(S(Nc("height")),r=void 0));const a={type:"pad",...o,...n?nl(n.autosize):{},...nl(e.autosize)};if(a.type==="fit"&&!s&&(S(Ph),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&S(_c("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&S(_c("height")),!ft(a,{type:"pad"}))return a}function jv(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Uv(e){return e?`fit-${es(e)}`:"fit"}const Bv=["background","padding"];function il(e,t){const n={};for(const i of Bv)e&&e[i]!==void 0&&(n[i]=Le(e[i]));return t&&(n.params=e.params),n}class Ut{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new Ut(D(this.explicit),D(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(t){return fe(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of x(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function ut(e){return{explicit:!0,value:e}}function Pe(e){return{explicit:!1,value:e}}function wd(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:vs(t,n,i,r)}}function vs(e,t,n,i){return e.explicit&&t.explicit&&S(Em(n,i,e.value,t.value)),e}function Yt(e,t,n,i,r=vs){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:ft(e.value,t.value)?e:r(e,t,n,i)}class Wv extends Ut{constructor(t={},n={},i=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function di(e){return"url"in e}function qi(e){return"values"in e}function $d(e){return"name"in e&&!di(e)&&!qi(e)&&!Ht(e)}function Ht(e){return e&&(Od(e)||Cd(e)||Ga(e))}function Od(e){return"sequence"in e}function Cd(e){return"sphere"in e}function Ga(e){return"graticule"in e}var ee;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(ee||(ee={}));function Nd(e){const{signals:t,hasLegend:n,index:i,...r}=e;return r.field=Ue(r.field),r}function kn(e,t=!0,n=Qp){if(T(e)){const i=e.map(r=>kn(r,t,n));return t?`[${i.join(", ")}]`:i}else if(Mn(e))return n(t?_n(e):Xm(e));return t?n(te(e)):e}function Gv(e,t){for(const n of Se(e.component.selection??{})){const i=n.name;let r=`${i}${Jt}, ${n.resolve==="global"?"true":`{unit: ${wn(e)}}`}`;for(const s of Ss)s.defined(n)&&(s.signals&&(t=s.signals(e,n,t)),s.modifyExpr&&(r=s.modifyExpr(e,n,r)));t.push({name:i+Ex,on:[{events:{signal:n.name+Jt},update:`modify(${B(n.name+In)}, ${r})`}]})}return Ha(t)}function Hv(e,t){if(e.component.selection&&x(e.component.selection).length){const n=B(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:vi("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return Ha(t)}function qv(e,t){let n=!1;for(const i of Se(e.component.selection??{})){const r=i.name,s=B(r+In);if(t.filter(a=>a.name===r).length===0){const a=i.resolve==="global"?"union":i.resolve,c=i.type==="point"?", true, true)":")";t.push({name:i.name,update:`${Gd}(${s}, ${B(a)}${c}`})}n=!0;for(const a of Ss)a.defined(i)&&a.topLevelSignals&&(t=a.topLevelSignals(e,i,t))}return n&&t.filter(r=>r.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),Ha(t)}function Xv(e,t){const n=[...t],i=wn(e,{escape:!1});for(const r of Se(e.component.selection??{})){const s={name:r.name+In};if(r.project.hasSelectionId&&(s.transform=[{type:"collect",sort:{field:et}}]),r.init){const a=r.project.items.map(Nd);s.values=r.project.hasSelectionId?r.init.map(c=>({unit:i,[et]:kn(c,!1)[0]})):r.init.map(c=>({unit:i,fields:a,values:kn(c,!1)}))}n.filter(a=>a.name===r.name+In).length||n.push(s)}return n}function _d(e,t){for(const n of Se(e.component.selection??{}))for(const i of Ss)i.defined(n)&&i.marks&&(t=i.marks(e,n,t));return t}function Vv(e,t){for(const n of e.children)ce(n)&&(t=_d(n,t));return t}function Yv(e,t,n,i){const r=Yd(e,t.param,t);return{signal:De(n.get("type"))&&T(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function Ha(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class K{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){S(Vh);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this);const i=t.parent.removeChild(t);this._parent=n,n.addChild(this,i),t.parent=this}}class Oe extends K{clone(){const t=new this.constructor;return t.debugName=`clone_${this.debugName}`,t._source=this._source,t._name=`clone_${this._name}`,t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}constructor(t,n,i,r){super(t,n),this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash=`Output ${Eu()}`),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}function Gs(e){return e.as!==void 0}function rl(e){return`${e}_end`}class gt extends K{clone(){return new gt(null,D(this.formula))}constructor(t,n){super(t),this.formula=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s)=>{const{field:o,timeUnit:a}=s;if(a){let c;if(jn(a)){if(ce(n)){const{mark:l}=n;(Sa(l)||s.bandPosition)&&(c={timeUnit:he(a),field:o})}}else c={as:$(s,{forAs:!0}),field:o,timeUnit:a};c&&(r[W(c)]=c)}return r},{});return J(i)?null:new gt(t,i)}static makeFromTransform(t,n){const{timeUnit:i,...r}={...n},s=he(i),o={...r,timeUnit:s};return new gt(t,{[W(o)]:o})}merge(t){this.formula={...this.formula};for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Xt(this.formula)){const s=Gs(r)?r.as:`${r.field}_end`;t.has(s)||(n[i]=r)}this.formula=n}producedFields(){return new Set(Se(this.formula).map(t=>Gs(t)?t.as:rl(t.field)))}dependentFields(){return new Set(Se(this.formula).map(t=>t.field))}hash(){return`TimeUnit ${W(this.formula)}`}assemble(){const t=[];for(const n of Se(this.formula))if(Gs(n)){const{field:i,as:r,timeUnit:s}=n,{unit:o,utc:a,...c}=he(s);t.push({field:Ue(i),type:"timeunit",...o?{units:rs(o)}:{},...a?{timezone:"utc"}:{},...c,as:[r,`${r}_end`]})}else if(n){const{field:i,timeUnit:r}=n,s=of(r==null?void 0:r.unit),{part:o,step:a}=uf(s,r.step);t.push({type:"formula",expr:`timeOffset('${o}', datum['${i}'], ${a})`,as:rl(i)})}return t}}const lr="_tuple_fields";class Kv{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const Jv={defined:()=>!0,parse:(e,t,n)=>{const i=t.name,r=t.project??(t.project=new Kv),s={},o={},a=new Set,c=(g,h)=>{const m=h==="visual"?g.channel:g.field;let y=se(`${i}_${m}`);for(let b=1;a.has(y);b++)y=se(`${i}_${m}_${b}`);return a.add(y),{[h]:y}},l=t.type,u=e.config.selection[l],f=n.value!==void 0?le(n.value):null;let{fields:d,encodings:p}=q(n.select)?n.select:{};if(!d&&!p&&f){for(const g of f)if(q(g))for(const h of x(g))fh(h)?(p||(p=[])).push(h):l==="interval"?(S(Gh),p=u.encodings):(d??(d=[])).push(h)}!d&&!p&&(p=u.encodings,"fields"in u&&(d=u.fields));for(const g of p??[]){const h=e.fieldDef(g);if(h){let m=h.field;if(h.aggregate){S(Lh(g,h.aggregate));continue}else if(!m){S(Ac(g));continue}if(h.timeUnit&&!jn(h.timeUnit)){m=e.vgField(g);const y={timeUnit:h.timeUnit,as:m,field:h.field};o[W(y)]=y}if(!s[m]){const y=l==="interval"&&Mt(g)&&De(e.getScaleComponent(g).get("type"))?"R":h.bin?"R-RE":"E",b={field:m,channel:g,type:y,index:r.items.length};b.signals={...c(b,"data"),...c(b,"visual")},r.items.push(s[m]=b),r.hasField[m]=s[m],r.hasSelectionId=r.hasSelectionId||m===et,_u(g)?(b.geoChannel=g,b.channel=Nu(g),r.hasChannel[b.channel]=s[m]):r.hasChannel[g]=s[m]}}else S(Ac(g))}for(const g of d??[]){if(r.hasField[g])continue;const h={type:"E",field:g,index:r.items.length};h.signals={...c(h,"data")},r.items.push(h),r.hasField[g]=h,r.hasSelectionId=r.hasSelectionId||g===et}f&&(t.init=f.map(g=>r.items.map(h=>q(g)?g[h.geoChannel||h.channel]!==void 0?g[h.geoChannel||h.channel]:g[h.field]:g))),J(o)||(r.timeUnit=new gt(null,o))},signals:(e,t,n)=>{const i=t.name+lr;return n.filter(s=>s.name===i).length>0||t.project.hasSelectionId?n:n.concat({name:i,value:t.project.items.map(Nd)})}},Ft={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!Mt(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!De(o)){S(Mh);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||sl(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(Gd)>=0)r.update=`{${i.map(o=>`${B(Ue(o.field))}: ${o.signals.data}`).join(", ")}}`;else{for(const o of i){const a=`${B(Ue(o.field))}: ${o.signals.data}`;s.includes(a)||(s=`${s.substring(0,s.length-1)}, ${a}}`)}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!sl(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Oo(e,t){return`domain(${B(e.scaleName(t))})`}function sl(e){return e.parent&&Ni(e.parent)&&!e.parent.parent}const ei="_brush",Td="_scale_trigger",Ai="geo_interval_init_tick",Ad="_init",Qv="_center",Zv={defined:e=>e.type==="interval",parse:(e,t,n)=>{var i;if(e.hasProjection){const r={...q(n.select)?n.select:{}};r.fields=[et],r.encodings||(r.encodings=n.value?x(n.value):[rt,it]),n.select={type:"interval",...r}}if(t.translate&&!Ft.defined(t)){const r=`!event.item || event.item.mark.name !== ${B(t.name+ei)}`;for(const s of t.events){if(!s.between){S(`${s} is not an ordered event stream for interval selections.`);continue}const o=le((i=s.between[0]).filter??(i.filter=[]));o.indexOf(r)<0&&o.push(r)}}},signals:(e,t,n)=>{const i=t.name,r=i+Jt,s=Se(t.project.hasChannel).filter(a=>a.channel===oe||a.channel===me),o=t.init?t.init[0]:null;if(n.push(...s.reduce((a,c)=>a.concat(ex(e,t,c,o&&o[c.index])),[])),e.hasProjection){const a=B(e.projectionName()),c=e.projectionName()+Qv,{x:l,y:u}=t.project.hasChannel,f=l&&l.signals.visual,d=u&&u.signals.visual,p=l?o&&o[l.index]:`${c}[0]`,g=u?o&&o[u.index]:`${c}[1]`,h=v=>e.getSizeSignalRef(v).signal,m=`[[${f?f+"[0]":"0"}, ${d?d+"[0]":"0"}],[${f?f+"[1]":h("width")}, ${d?d+"[1]":h("height")}]]`;o&&(n.unshift({name:i+Ad,init:`[scale(${a}, [${l?p[0]:p}, ${u?g[0]:g}]), scale(${a}, [${l?p[1]:p}, ${u?g[1]:g}])]`}),(!l||!u)&&(n.find(_=>_.name===c)||n.unshift({name:c,update:`invert(${a}, [${h("width")}/2, ${h("height")}/2])`})));const y=`intersect(${m}, {markname: ${B(e.getName("marks"))}}, unit.mark)`,b=`{unit: ${wn(e)}}`,C=`vlSelectionTuples(${y}, ${b})`,I=s.map(v=>v.signals.visual);return n.concat({name:r,on:[{events:[...I.length?[{signal:I.join(" || ")}]:[],...o?[{signal:Ai}]:[]],update:C}]})}else{if(!Ft.defined(t)){const l=i+Td,u=s.map(f=>{const d=f.channel,{data:p,visual:g}=f.signals,h=B(e.scaleName(d)),m=e.getScaleComponent(d).get("type"),y=De(m)?"+":"";return`(!isArray(${p}) || (${y}invert(${h}, ${g})[0] === ${y}${p}[0] && ${y}invert(${h}, ${g})[1] === ${y}${p}[1]))`});u.length&&n.push({name:l,value:{},on:[{events:s.map(f=>({scale:e.scaleName(f.channel)})),update:u.join(" && ")+` ? ${l} : {}`}]})}const a=s.map(l=>l.signals.data),c=`unit: ${wn(e)}, fields: ${i+lr}, values`;return n.concat({name:r,...o?{init:`{${c}: ${kn(o)}}`}:{},...a.length?{on:[{events:[{signal:a.join(" || ")}],update:`${a.join(" && ")} ? {${c}: [${a}]} : null`}]}:{}})}},topLevelSignals:(e,t,n)=>(ce(e)&&e.hasProjection&&t.init&&(n.filter(r=>r.name===Ai).length||n.unshift({name:Ai,value:null,on:[{events:"timer{1}",update:`${Ai} === null ? {} : ${Ai}`}]})),n),marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r==null?void 0:r.signals.visual,a=s==null?void 0:s.signals.visual,c=`data(${B(t.name+In)})`;if(Ft.defined(t)||!r&&!s)return n;const l={x:r!==void 0?{signal:`${o}[0]`}:{value:0},y:s!==void 0?{signal:`${a}[0]`}:{value:0},x2:r!==void 0?{signal:`${o}[1]`}:{field:{group:"width"}},y2:s!==void 0?{signal:`${a}[1]`}:{field:{group:"height"}}};if(t.resolve==="global")for(const h of x(l))l[h]=[{test:`${c}.length && ${c}[0].unit === ${wn(e)}`,...l[h]},{value:0}];const{fill:u,fillOpacity:f,cursor:d,...p}=t.mark,g=x(p).reduce((h,m)=>(h[m]=[{test:[r!==void 0&&`${o}[0] !== ${o}[1]`,s!==void 0&&`${a}[0] !== ${a}[1]`].filter(y=>y).join(" && "),value:p[m]},{value:null}],h),{});return[{name:`${i+ei}_bg`,type:"rect",clip:!0,encode:{enter:{fill:{value:u},fillOpacity:{value:f}},update:l}},...n,{name:i+ei,type:"rect",clip:!0,encode:{enter:{...d?{cursor:{value:d}}:{},fill:{value:"transparent"}},update:{...l,...g}}}]}};function ex(e,t,n,i){const r=!e.hasProjection,s=n.channel,o=n.signals.visual,a=B(r?e.scaleName(s):e.projectionName()),c=d=>`scale(${a}, ${d})`,l=e.getSizeSignalRef(s===oe?"width":"height").signal,u=`${s}(unit)`,f=t.events.reduce((d,p)=>[...d,{events:p.between[0],update:`[${u}, ${u}]`},{events:p,update:`[${o}[0], clamp(${u}, 0, ${l})]`}],[]);if(r){const d=n.signals.data,p=Ft.defined(t),g=e.getScaleComponent(s),h=g?g.get("type"):void 0,m=i?{init:kn(i,!0,c)}:{value:[]};return f.push({events:{signal:t.name+Td},update:De(h)?`[${c(`${d}[0]`)}, ${c(`${d}[1]`)}]`:"[0, 0]"}),p?[{name:d,on:[]}]:[{name:o,...m,on:f},{name:d,...i?{init:kn(i)}:{},on:[{events:{signal:o},update:`${o}[0] === ${o}[1] ? null : invert(${a}, ${o})`}]}]}else{const d=s===oe?0:1,p=t.name+Ad,g=i?{init:`[${p}[0][${d}], ${p}[1][${d}]]`}:{value:[]};return[{name:o,...g,on:f}]}}const tx={defined:e=>e.type==="point",signals:(e,t,n)=>{const i=t.name,r=i+lr,s=t.project,o="(item().isVoronoi ? datum.datum : datum)",a=Se(e.component.selection??{}).reduce((f,d)=>d.type==="interval"?f.concat(d.name+ei):f,[]).map(f=>`indexof(item().mark.name, '${f}') < 0`).join(" && "),c=`datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0${a?` && ${a}`:""}`;let l=`unit: ${wn(e)}, `;if(t.project.hasSelectionId)l+=`${et}: ${o}[${B(et)}]`;else{const f=s.items.map(d=>{const p=e.fieldDef(d.channel);return p!=null&&p.bin?`[${o}[${B(e.vgField(d.channel,{}))}], ${o}[${B(e.vgField(d.channel,{binSuffix:"end"}))}]]`:`${o}[${B(d.field)}]`}).join(", ");l+=`fields: ${r}, values: [${f}]`}const u=t.events;return n.concat([{name:i+Jt,on:u?[{events:u,update:`${c} ? {${l}} : null`,force:!0}]:[]}])}};function wi(e,t,n,i){const r=fs(t)&&t.condition,s=i(t);if(r){const a=le(r).map(c=>{const l=i(c);if(Hy(c)){const{param:u,empty:f}=c;return{test:Vd(e,{param:u,empty:f}),...l}}else return{test:Ur(e,c.test),...l}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function qa(e,t="text"){const n=e.encoding[t];return wi(e,n,t,i=>xs(i,e.config))}function xs(e,t,n="datum"){if(e){if(Ze(e))return re(e.value);if(j(e)){const{format:i,formatType:r}=Rr(e);return Oa({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function Fd(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(T(o))return{tooltip:ol({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return wi(e,o,"tooltip",c=>{const l=xs(c,r,a);if(l)return l;if(c===null)return;let u=Y("tooltip",i,r);if(u===!0&&(u={content:"encoding"}),L(u))return{value:u};if(q(u))return k(u)?u:u.content==="encoding"?ol(n,s,r,t):{signal:a}})}}function kd(e,t,n,{reactiveGeom:i}={}){const r={...n,...n.tooltipFormat},s={},o=i?"datum.datum":"datum",a=[];function c(u,f){const d=zn(f),p=Ce(u)?u:{...u,type:e[d].type},g=p.title||Ta(p,r),h=le(g).join(", ").replaceAll(/"/g,'\\"');let m;if(ye(f)){const y=f==="x"?"x2":"y2",b=yt(e[y]);if(xe(p.bin)&&b){const C=$(p,{expr:o}),I=$(b,{expr:o}),{format:v,formatType:_}=Rr(p);m=rr(C,I,v,_,r),s[y]=!0}}if((ye(f)||f===We||f===nt)&&t&&t.fieldChannel===f&&t.offset==="normalize"){const{format:y,formatType:b}=Rr(p);m=Oa({fieldOrDatumDef:p,format:y,formatType:b,expr:o,config:r,normalizeStack:!0}).signal}m??(m=xs(p,r,o).signal),a.push({channel:f,key:h,value:m})}ka(e,(u,f)=>{E(u)?c(u,f):ds(u)&&c(u.condition,f)});const l={};for(const{channel:u,key:f,value:d}of a)!s[u]&&!l[f]&&(l[f]=d);return l}function ol(e,t,n,{reactiveGeom:i}={}){const r=kd(e,t,n,{reactiveGeom:i}),s=Xt(r).map(([o,a])=>`"${o}": ${a}`);return s.length>0?{signal:`{${s.join(", ")}}`}:void 0}function nx(e){const{markDef:t,config:n}=e,i=Y("aria",t,n);return i===!1?{}:{...i?{aria:i}:{},...ix(e),...rx(e)}}function ix(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=Y("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in kh?{}:{ariaRoleDescription:{value:t}}}function rx(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return wi(e,s,"description",c=>xs(c,e.config));const o=Y("description",n,i);if(o!=null)return{description:re(o)};if(i.aria===!1)return{};const a=kd(t,r,i);if(!J(a))return{description:{signal:Xt(a).map(([c,l],u)=>`"${u>0?"; ":""}${c}: " + (${l})`).join(" + ")}}}function ge(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:c}=n;a===void 0&&(c??(c=Y(e,i,s,{vgChannel:o,ignoreVgConfig:!0})),c!==void 0&&(a=re(c)));const l=r[e];return wi(t,l,o??e,u=>$a({channel:e,channelDef:u,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Id(e,t={filled:void 0}){const{markDef:n,encoding:i,config:r}=e,{type:s}=n,o=t.filled??Y("filled",n,r),a=G(["bar","point","circle","square","geoshape"],s)?"transparent":void 0,c=Y(o===!0?"color":void 0,n,r,{vgChannel:"fill"})??r.mark[o===!0&&"color"]??a,l=Y(o===!1?"color":void 0,n,r,{vgChannel:"stroke"})??r.mark[o===!1&&"color"],u=o?"fill":"stroke",f={...c?{fill:re(c)}:{},...l?{stroke:re(l)}:{}};return n.color&&(o?n.fill:n.stroke)&&S(Ku("property",{fill:"fill"in n,stroke:"stroke"in n})),{...f,...ge("color",e,{vgChannel:u,defaultValue:o?c:l}),...ge("fill",e,{defaultValue:i.fill?c:void 0}),...ge("stroke",e,{defaultValue:i.stroke?l:void 0})}}function sx(e){const{encoding:t,mark:n}=e,i=t.order;return!an(n)&&Ze(i)?wi(e,i,"zindex",r=>re(r.value)):{}}function pi({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const s=`${e}Offset`,o=t[s],a=n[s];if((s==="xOffset"||s==="yOffset")&&a)return{offsetType:"encoding",offset:$a({channel:s,channelDef:a,markDef:t,config:i==null?void 0:i.config,scaleName:i.scaleName(s),scale:i.getScaleComponent(s),stack:null,defaultRef:re(o),bandPosition:r})};const c=t[s];return c?{offsetType:"visual",offset:c}:{}}function we(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=t,c=r[e],l=r[Et(e)],u=t.scaleName(e),f=t.getScaleComponent(e),{offset:d,offsetType:p}=pi({channel:e,markDef:s,encoding:r,model:t,bandPosition:.5}),g=Xa({model:t,defaultPos:n,channel:e,scaleName:u,scale:f}),h=!c&&ye(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:ox({channel:e,channelDef:c,channel2Def:l,markDef:s,config:o,scaleName:u,scale:f,stack:a,offset:d,defaultRef:g,bandPosition:p==="encoding"?0:void 0});return h?{[i||e]:h}:void 0}function ox(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=e;if(j(n)&&r&&t===r.fieldChannel){if(E(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return Fr({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return Sn(n,i,{suffix:"end"},{offset:s})}return Ea(e)}function Xa({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=zn(n),c=Vt(n),l=Y(n,s,o,{vgChannel:c});if(l!==void 0)return ji(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const u=r.get("type");if(!G([Ae.LOG,Ae.TIME,Ae.UTC],u)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:`min(${e.width.signal},${e.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return{...e[Re(n)],mult:.5}}}}const ax={left:"x",center:"xc",right:"x2"},cx={top:"y",middle:"yc",bottom:"y2"};function Rd(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Vt(e);const r=e==="x"?"align":"baseline",s=Y(r,t,n);let o;return k(s)?(S(fm(r)),o=void 0):o=s,e==="x"?ax[o||(i==="top"?"left":"center")]:cx[o||i]}function Mr(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?Pd(e,t,{defaultPos:n,defaultPos2:i}):we(e,t,{defaultPos:n})}function Pd(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=Et(e),a=Re(e),c=lx(t,i,o),l=c[a]?Rd(e,r,s):Vt(e);return{...we(e,t,{defaultPos:n,vgChannel:l}),...c}}function lx(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,c=zn(n),l=Re(n),u=Vt(n),f=i[c],d=e.scaleName(c),p=e.getScaleComponent(c),{offset:g}=n in i||n in s?pi({channel:n,markDef:s,encoding:i,model:e}):pi({channel:c,markDef:s,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=Re(n),y=e.markDef[m];return y!=null?{[m]:{value:y}}:{[u]:{field:e.getName(n)}}}const h=ux({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:p,stack:o,offset:g,defaultRef:void 0});return h!==void 0?{[u]:h}:gr(n,s)||gr(n,{[n]:_r(n,s,a.style),[l]:_r(l,s,a.style)})||gr(n,a[r])||gr(n,a.mark)||{[u]:Xa({model:e,defaultPos:t,channel:n,scaleName:d,scale:p})()}}function ux({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l}){return j(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Sn(t,s,{suffix:"start"},{offset:c}):Ea({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:c,defaultRef:l})}function gr(e,t){const n=Re(e),i=Vt(e);if(t[i]!==void 0)return{[i]:ji(e,t[i])};if(t[e]!==void 0)return{[i]:ji(e,t[e])};if(t[n]){const r=t[n];if(An(r))S(rm(n));else return{[n]:ji(e,r)}}}function Kt(e,t){const{config:n,encoding:i,markDef:r}=e,s=r.type,o=Et(t),a=Re(t),c=i[t],l=i[o],u=e.getScaleComponent(t),f=u?u.get("type"):void 0,d=r.orient,p=i[a]??i.size??Y("size",r,n,{vgChannel:a}),g=ku(t),h=s==="bar"&&(t==="x"?d==="vertical":d==="horizontal");return E(c)&&(ne(c.bin)||xe(c.bin)||c.timeUnit&&!l)&&!(p&&!An(p))&&!i[g]&&!be(f)?px({fieldDef:c,fieldDef2:l,channel:t,model:e}):(j(c)&&be(f)||h)&&!l?dx(c,t,e):Pd(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function fx(e,t,n,i,r,s,o){if(An(r))if(n){const c=n.get("type");if(c==="band"){let l=`bandwidth('${t}')`;r.band!==1&&(l=`${r.band} * ${l}`);const u=Rt("minBandSize",{type:o},i);return{signal:u?`max(${Ve(u)}, ${l})`:l}}else r.band!==1&&(S(hm(c)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(k(r))return r;if(r)return{value:r}}if(n){const c=n.get("range");if(on(c)&&ue(c.step))return{value:c.step-2}}if(!s){const{bandPaddingInner:c,barBandPaddingInner:l,rectBandPaddingInner:u}=i.scale,f=fe(c,o==="bar"?l:u);if(k(f))return{signal:`(1 - (${f.signal})) * ${e}`};if(ue(f))return{signal:`${1-f} * ${e}`}}return{value:zr(i.view,e)-2}}function dx(e,t,n){const{markDef:i,encoding:r,config:s,stack:o}=n,a=i.orient,c=n.scaleName(t),l=n.getScaleComponent(t),u=Re(t),f=Et(t),d=ku(t),p=n.scaleName(d),g=n.getScaleComponent(Qo(t)),h=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let m;(r.size||i.size)&&(h?m=ge("size",n,{vgChannel:u,defaultRef:re(i.size)}):S(vm(i.type)));const y=!!m,b=If({channel:t,fieldDef:e,markDef:i,config:s,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:h});m=m||{[u]:fx(u,p||c,g||l,s,b,!!e,i.type)};const C=(l==null?void 0:l.get("type"))==="band"&&An(b)&&!y?"top":"middle",I=Rd(t,i,s,C),v=I==="xc"||I==="yc",{offset:_,offsetType:O}=pi({channel:t,markDef:i,encoding:r,model:n,bandPosition:v?.5:0}),M=Ea({channel:t,channelDef:e,markDef:i,config:s,scaleName:c,scale:l,stack:o,offset:_,defaultRef:Xa({model:n,defaultPos:"mid",channel:t,scaleName:c,scale:l}),bandPosition:v?O==="encoding"?0:.5:k(b)?{signal:`(1-${b})/2`}:An(b)?(1-b.band)/2:0});if(u)return{[I]:M,...m};{const V=Vt(f),Q=m[u],ve=_?{...Q,offset:_}:Q;return{[I]:M,[V]:T(M)?[M[0],{...M[1],offset:ve}]:{...M,offset:ve}}}}function al(e,t,n,i,r,s,o){if(Cu(e))return 0;const a=e==="x"||e==="y2",c=a?-t/2:t/2;if(k(n)||k(r)||k(i)||s){const l=Ve(n),u=Ve(r),f=Ve(i),d=Ve(s),g=s?`(${o} < ${d} ? ${a?"":"-"}0.5 * (${d} - (${o})) : ${c})`:c,h=f?`${f} + `:"",m=l?`(${l} ? -1 : 1) * `:"",y=u?`(${u} + ${g})`:g;return{signal:h+m+y}}else return r=r||0,i+(n?-r-c:+r+c)}function px({fieldDef:e,fieldDef2:t,channel:n,model:i}){var V;const{config:r,markDef:s,encoding:o}=i,a=i.getScaleComponent(n),c=i.scaleName(n),l=a?a.get("type"):void 0,u=a.get("reverse"),f=If({channel:n,fieldDef:e,markDef:s,config:r,scaleType:l}),d=(V=i.component.axes[n])==null?void 0:V[0],p=(d==null?void 0:d.get("translate"))??.5,g=ye(n)?Y("binSpacing",s,r)??0:0,h=Et(n),m=Vt(n),y=Vt(h),b=Rt("minBandSize",s,r),{offset:C}=pi({channel:n,markDef:s,encoding:o,model:i,bandPosition:0}),{offset:I}=pi({channel:h,markDef:s,encoding:o,model:i,bandPosition:0}),v=jy({fieldDef:e,scaleName:c}),_=al(n,g,u,p,C,b,v),O=al(h,g,u,p,I??C,b,v),M=k(f)?{signal:`(1-${f.signal})/2`}:An(f)?(1-f.band)/2:.5;if(ne(e.bin)||e.timeUnit)return{[y]:cl({fieldDef:e,scaleName:c,bandPosition:M,offset:O}),[m]:cl({fieldDef:e,scaleName:c,bandPosition:k(M)?{signal:`1-${M.signal}`}:1-M,offset:_})};if(xe(e.bin)){const Q=Sn(e,c,{},{offset:O});if(E(t))return{[y]:Q,[m]:Sn(t,c,{},{offset:_})};if(Dn(e.bin)&&e.bin.step)return{[y]:Q,[m]:{signal:`scale("${c}", ${$(e,{expr:"datum"})} + ${e.bin.step})`,offset:_}}}S(Zu(h))}function cl({fieldDef:e,scaleName:t,bandPosition:n,offset:i}){return Fr({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i})}const gx=new Set(["aria","width","height"]);function Ge(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?Id(e):{};return{...hx(e.markDef,t),...ll(e,"fill",n),...ll(e,"stroke",i),...ge("opacity",e),...ge("fillOpacity",e),...ge("strokeOpacity",e),...ge("strokeWidth",e),...ge("strokeDash",e),...sx(e),...Fd(e),...qa(e,"href"),...nx(e)}}function ll(e,t,n){const{config:i,mark:r,markDef:s}=e;if(Y("invalid",s,i)==="hide"&&n&&!an(r)){const a=mx(e,{invalid:!0,channels:ts});if(a)return{[t]:[{test:a,value:null},...le(n)]}}return n?{[t]:n}:{}}function hx(e,t){return Fh.reduce((n,i)=>(!gx.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=re(e[i])),n),{})}function mx(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&De(c)&&(s[l]=!0)}return s},{}),r=x(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>wa(o,t)).join(` ${s} `)}}function Va(e){const{config:t,markDef:n}=e;if(Y("invalid",n,t)){const r=yx(e,{channels:wt});if(r)return{defined:{signal:r}}}return{}}function yx(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{var c;const a=e.getScaleComponent(o);if(a){const l=a.get("type"),u=e.vgField(o,{expr:"datum",binSuffix:(c=e.stack)!=null&&c.impute?"mid":void 0});u&&De(l)&&(s[u]=!0)}return s},{}),r=x(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>wa(o,t)).join(` ${s} `)}}function ul(e,t){if(t!==void 0)return{[e]:re(t)}}const Hs="voronoi",Ld={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(Hs)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(an(s))return S(zh(s)),n;const o={name:e.getName(Hs),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...Fd(e,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,c=!1;return n.forEach((l,u)=>{const f=l.name??"";f===e.component.mark[0].name?a=u:f.indexOf(Hs)>=0&&(c=!0)}),c||n.splice(a+1,0,o),n}},zd={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Da(e.bind),parse:(e,t,n)=>Hd(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=Ld.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((c,l)=>{const u=se(`${i}_${c.field}`);n.filter(d=>d.name===u).length||n.unshift({name:u,...o?{init:kn(o[l])}:{value:null},on:t.events?[{events:t.events,update:`datum && item().mark.marktype !== 'group' ? ${a}[${B(c.field)}] : null`}]:[],bind:s[c.field]??s[c.channel]??s})}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+Jt)[0],o=i+lr,a=r.items.map(l=>se(`${i}_${l.field}`)),c=a.map(l=>`${l} !== null`).join(" && ");return a.length&&(s.update=`${c} ? {fields: ${o}, values: [${a.join(", ")}]} : null`),delete s.value,delete s.on,n}},jr="_toggle",Dd={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+jr,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Jt,i=t.name+jr;return`${i} ? null : ${n}, `+(t.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${wn(e)}}, `)+`${i} ? ${n} : null`}},bx={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=L(t.clear)?vi(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(zd.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===se(`${t.name}_${i.field}`));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Jt);i(r,"null"),Dd.defined(t)&&(r=n.findIndex(s=>s.name===t.name+jr),i(r,"false"))}return n}},Md={defined:e=>{const t=e.resolve==="global"&&e.bind&&Da(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==et;return t&&!n&&S(jh),t&&n},parse:(e,t,n)=>{const i=D(n);if(i.select=L(i.select)?{type:i.select,toggle:t.toggle}:{...i.select,toggle:t.toggle},Hd(t,i),q(n.select)&&(n.select.on||n.select.clear)){const o='event.item && indexof(event.item.mark.role, "legend") < 0';for(const a of t.events)a.filter=le(a.filter??[]),a.filter.includes(o)||a.filter.push(o)}const r=Us(t.bind)?t.bind.legend:"click",s=L(r)?vi(r,"view"):le(r);t.bind={legend:{merge:s}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=Us(t.bind)&&t.bind.legend,s=o=>a=>{const c=D(a);return c.markname=o,c};for(const o of t.project.items){if(!o.hasLegend)continue;const a=`${se(o.field)}_legend`,c=`${i}_${a}`;if(n.filter(u=>u.name===c).length===0){const u=r.merge.map(s(`${a}_symbols`)).concat(r.merge.map(s(`${a}_labels`))).concat(r.merge.map(s(`${a}_entries`)));n.unshift({name:c,...t.init?{}:{value:null},on:[{events:u,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:`!event.item || !datum ? null : ${c}`,force:!0}]})}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+Jt),o=i+lr,a=r.items.filter(d=>d.hasLegend).map(d=>se(`${i}_${se(d.field)}_legend`)),l=`${a.map(d=>`${d} !== null`).join(" && ")} ? {fields: ${o}, values: [${a.join(", ")}]} : null`;t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(d=>d.name===i+jr),f=Us(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push({...u.on[0],events:f}):u.on[0].events=f),n}};function vx(e,t,n){var r;const i=(r=e.fieldDef(t))==null?void 0:r.field;for(const s of Se(e.component.selection??{})){const o=s.project.hasField[i]??s.project.hasChannel[t];if(o&&Md.defined(s)){const a=n.get("selections")??[];a.push(s.name),n.set("selections",a,!1),o.hasLegend=!0}}}const jd="_translate_anchor",Ud="_translate_delta",xx={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Ft.defined(t),s=i+jd,{x:o,y:a}=t.project.hasChannel;let c=vi(t.translate,"scope");return r||(c=c.map(l=>(l.between[0].markname=i+ei,l))),n.push({name:s,value:{},on:[{events:c.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?`, extent_x: ${r?Oo(e,oe):`slice(${o.signals.visual})`}`:"")+(a!==void 0?`, extent_y: ${r?Oo(e,me):`slice(${a.signals.visual})`}`:"")+"}"}]},{name:i+Ud,value:{},on:[{events:c,update:`{x: ${s}.x - x(unit), y: ${s}.y - y(unit)}`}]}),o!==void 0&&fl(e,t,o,"width",n),a!==void 0&&fl(e,t,a,"height",n),n}};function fl(e,t,n,i,r){const s=t.name,o=s+jd,a=s+Ud,c=n.channel,l=Ft.defined(t),u=r.filter(v=>v.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(c),p=d&&d.get("type"),g=d&&d.get("reverse"),h=l?c===oe?g?"":"-":g?"-":"":"",m=`${o}.extent_${c}`,y=`${h}${a}.${c} / ${l?`${f}`:`span(${m})`}`,b=!l||!d?"panLinear":p==="log"?"panLog":p==="symlog"?"panSymlog":p==="pow"?"panPow":"panLinear",C=l?p==="pow"?`, ${d.get("exponent")??1}`:p==="symlog"?`, ${d.get("constant")??1}`:"":"",I=`${b}(${m}, ${y}${C})`;u.on.push({events:{signal:a},update:l?I:`clampRange(${I}, 0, ${f})`})}const Bd="_zoom_anchor",Wd="_zoom_delta",Sx={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Ft.defined(t),s=i+Wd,{x:o,y:a}=t.project.hasChannel,c=B(e.scaleName(oe)),l=B(e.scaleName(me));let u=vi(t.zoom,"scope");return r||(u=u.map(f=>(f.markname=i+ei,f))),n.push({name:i+Bd,on:[{events:u,update:r?"{"+[c?`x: invert(${c}, x(unit))`:"",l?`y: invert(${l}, y(unit))`:""].filter(f=>f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&dl(e,t,o,"width",n),a!==void 0&&dl(e,t,a,"height",n),n}};function dl(e,t,n,i,r){const s=t.name,o=n.channel,a=Ft.defined(t),c=r.filter(b=>b.name===n.signals[a?"data":"visual"])[0],l=e.getSizeSignalRef(i).signal,u=e.getScaleComponent(o),f=u&&u.get("type"),d=a?Oo(e,o):c.name,p=s+Wd,g=`${s}${Bd}.${o}`,h=!a||!u?"zoomLinear":f==="log"?"zoomLog":f==="symlog"?"zoomSymlog":f==="pow"?"zoomPow":"zoomLinear",m=a?f==="pow"?`, ${u.get("exponent")??1}`:f==="symlog"?`, ${u.get("constant")??1}`:"":"",y=`${h}(${d}, ${g}, ${p}${m})`;c.on.push({events:{signal:p},update:a?y:`clampRange(${y}, 0, ${l})`})}const In="_store",Jt="_tuple",Ex="_modify",Gd="vlSelectionResolve",Ss=[tx,Zv,Jv,Dd,zd,Ft,Md,bx,xx,Sx,Ld];function wx(e){let t=e.parent;for(;t&&!Qe(t);)t=t.parent;return t}function wn(e,{escape:t}={escape:!0}){let n=t?B(e.name):e.name;const i=wx(e);if(i){const{facet:r}=i;for(const s of je)r[s]&&(n+=` + '__facet_${s}_' + (facet[${B(i.vgField(s))}])`)}return n}function Ya(e){return Se(e.component.selection??{}).reduce((t,n)=>t||n.project.hasSelectionId,!1)}function Hd(e,t){(L(t.select)||!t.select.on)&&delete e.events,(L(t.select)||!t.select.clear)&&delete e.clear,(L(t.select)||!t.select.toggle)&&delete e.toggle}function Co(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...Co(e.object)),t.push(...Co(e.property))),t)}function qd(e){return e.object.type==="MemberExpression"?qd(e.object):e.object.name==="datum"}function Xd(e){const t=Zp(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&qd(i)&&n.add(Co(i).slice(1).join("."))}),n}class $i extends K{clone(){return new $i(null,this.model,D(this.filter))}constructor(t,n,i){super(t),this.model=n,this.filter=i,this.expr=Ur(this.model,this.filter,this),this._dependentFields=Xd(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function $x(e,t){const n={},i=e.config.selection;if(!t||!t.length)return n;for(const r of t){const s=se(r.name),o=r.select,a=L(o)?o:o.type,c=q(o)?D(o):{type:a},l=i[a];for(const d in l)d==="fields"||d==="encodings"||(d==="mark"&&(c[d]={...l[d],...c[d]}),(c[d]===void 0||c[d]===!0)&&(c[d]=D(l[d]??c[d])));const u=n[s]={...c,name:s,type:a,init:r.value,bind:r.bind,events:L(c.on)?vi(c.on,"scope"):le(D(c.on))},f=D(r);for(const d of Ss)d.defined(u)&&d.parse&&d.parse(e,u,f)}return n}function Vd(e,t,n,i="datum"){const r=L(t)?t:t.param,s=se(r),o=B(s+In);let a;try{a=e.getSelectionComponent(s,r)}catch{return`!!${s}`}if(a.project.timeUnit){const d=n??e.component.data.raw,p=a.project.timeUnit.clone();d.parent?p.insertAsParentOf(d):d.parent=p}const c=a.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",l=a.resolve==="global"?")":`, ${B(a.resolve)})`,u=`${c}${o}, ${i}${l}`,f=`length(data(${o}))`;return t.empty===!1?`${f} && ${u}`:`!${f} || ${u}`}function Yd(e,t,n){const i=se(t),r=n.encoding;let s=n.field,o;try{o=e.getSelectionComponent(i,t)}catch{return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&S(`A "field" or "encoding" must be specified when using a selection as a scale domain. Using "field": ${B(s)}.`);else if(r&&!s){const a=o.project.items.filter(c=>c.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,S((a.length?"Multiple ":"No ")+`matching ${B(r)} encoding found for selection ${B(n.param)}. Using "field": ${B(s)}.`)):s=a[0].field}return`${o.name}[${B(Ue(s))}]`}function Ox(e,t){for(const[n,i]of Xt(e.component.selection??{})){const r=e.getName(`lookup_${n}`);e.component.data.outputNodes[r]=i.materialized=new Oe(new $i(t,e,{param:n}),r,ee.Lookup,e.component.data.outputNodeRefCounts)}}function Ur(e,t,n){return Mi(t,i=>L(i)?i:ny(i)?Vd(e,i,n):df(i))}function Cx(e,t){if(e)return T(e)&&!Wt(e)?e.map(n=>Ta(n,t)).join(", "):e}function qs(e,t,n,i){var r,s;e.encode??(e.encode={}),(r=e.encode)[t]??(r[t]={}),(s=e.encode[t]).update??(s.update={}),e.encode[t].update[n]=i}function Li(e,t,n,i={header:!1}){var f,d;const{disable:r,orient:s,scale:o,labelExpr:a,title:c,zindex:l,...u}=e.combine();if(!r){for(const p in u){const g=sb[p],h=u[p];if(g&&g!==t&&g!=="both")delete u[p];else if(cr(h)){const{condition:m,...y}=h,b=le(m),C=Bc[p];if(C){const{vgProp:I,part:v}=C,_=[...b.map(O=>{const{test:M,...V}=O;return{test:Ur(null,M),...V}}),y];qs(u,v,I,_),delete u[p]}else if(C===null){const I={signal:b.map(v=>{const{test:_,...O}=v;return`${Ur(null,_)} ? ${Cc(O)} : `}).join("")+Cc(y)};u[p]=I}}else if(k(h)){const m=Bc[p];if(m){const{vgProp:y,part:b}=m;qs(u,b,y,h),delete u[p]}}G(["labelAlign","labelBaseline"],p)&&u[p]===null&&delete u[p]}if(t==="grid"){if(!u.grid)return;if(u.encode){const{grid:p}=u.encode;u.encode={...p?{grid:p}:{}},J(u.encode)&&delete u.encode}return{scale:o,orient:s,...u,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:fe(l,0)}}else{if(!i.header&&e.mainExtracted)return;if(a!==void 0){let g=a;(d=(f=u.encode)==null?void 0:f.labels)!=null&&d.update&&k(u.encode.labels.update.text)&&(g=Cn(a,"datum.label",u.encode.labels.update.text.signal)),qs(u,"labels","text",{signal:g})}if(u.labelAlign===null&&delete u.labelAlign,u.encode){for(const g of Wf)e.hasAxisPart(g)||delete u.encode[g];J(u.encode)&&delete u.encode}const p=Cx(c,n);return{scale:o,orient:s,grid:!1,...p?{title:p}:{},...u,...n.aria===!1?{aria:!1}:{},zindex:fe(l,0)}}}}function Kd(e){const{axes:t}=e.component,n=[];for(const i of wt)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Nx(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>Li(r,"grid",t)),...i.map(r=>Li(r,"grid",t)),...n.map(r=>Li(r,"main",t)),...i.map(r=>Li(r,"main",t))].filter(r=>r)}function pl(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},c=new Set([...x(o),...x(a)]),l={};for(const u of c.values())l[u]={signal:`${i.signal} === "${s}" ? ${Ve(o[u])} : ${Ve(a[u])}`};return l}return t[r]})])}function _x(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:mf(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=k(n)?"axisOrient":`axis${Zi(n)}`,a=[...r,...r.map(l=>s+l.substr(4))],c=["axis",o,s];return{vlOnlyAxisConfig:pl(a,i,e,n),vgAxisConfig:pl(c,i,e,n),axisConfigStyle:Tx([...c,...a],i)}}function Tx(e,t){var i;const n=[{}];for(const r of e){let s=(i=t[r])==null?void 0:i.style;if(s){s=le(s);for(const o of s)n.push(t.style[o])}}return Object.assign.apply(null,n)}function No(e,t,n,i={}){var s;const r=Wu(e,n,t);if(r!==void 0)return{configFrom:"style",configValue:r};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((s=i[o])==null?void 0:s[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const gl={scale:({model:e,channel:t})=>e.scaleName(t),format:({format:e})=>e,formatType:({formatType:e})=>e,grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>t.grid??Ax(n,e),gridScale:({model:e,channel:t})=>Fx(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||Qd(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||Jd(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>e.labelFlush??Ix(t.type,n),labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>e.labelOverlap??Rx(t.type,n,E(t)&&!!t.timeUnit,E(t)?t.sort:void 0),orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{const s=e==="x"?"width":e==="y"?"height":void 0,o=s?t.getSizeSignalRef(s):void 0;return n.tickCount??Lx({fieldOrDatumDef:i,scaleType:r,size:o,values:n.values})},tickMinStep:zx,title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=Zd(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return Hu(r?[jc(r)]:[],E(o)?[jc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Dx(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>e.zindex??Mx(n,t)};function Ax(e,t){return!be(e)&&E(t)&&!ne(t==null?void 0:t.bin)&&!xe(t==null?void 0:t.bin)}function Fx(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function kx(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return k(s)?s:Hi(s);{const{configValue:o}=No("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Hi(o):n===oe&&G([ya,ma],e.type)&&!(E(e)&&e.timeUnit)?270:void 0}}function _o(e){return`(((${e.signal} % 360) + 360) % 360)`}function Jd(e,t,n,i){if(e!==void 0)if(n==="x"){if(k(e)){const r=_o(e),s=k(t)?`(${t.signal} === "top")`:t==="top";return{signal:`(45 < ${r} && ${r} < 135) || (225 < ${r} && ${r} < 315) ? "middle" :(${r} <= 45 || 315 <= ${r}) === ${s} ? "bottom" : "top"`}}if(45<e&&e<135||225<e&&e<315)return"middle";if(k(t)){const r=e<=45||315<=e?"===":"!==";return{signal:`${t.signal} ${r} "top" ? "bottom" : "top"`}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(k(e)){const r=_o(e),s=k(t)?`(${t.signal} === "left")`:t==="left";return{signal:`${r} <= 45 || 315 <= ${r} || (135 <= ${r} && ${r} <= 225) ? ${i?'"middle"':"null"} : (45 <= ${r} && ${r} <= 135) === ${s} ? "top" : "bottom"`}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(k(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:`${t.signal} ${r} "left" ? "top" : "bottom"`}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function Qd(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(k(e)){const o=_o(e),a=k(t)?`(${t.signal} === "${s}")`:t===s;return{signal:`(${r?`(${o} + 90)`:o} % 180 === 0) ? ${i?null:'"center"'} :(${r} < ${o} && ${o} < ${180+r}) === ${a} ? "left" : "right"`}}if((e+r)%180===0)return i?null:"center";if(k(t)){const o=r<e&&e<180+r?"===":"!==";return{signal:`${`${t.signal} ${o} "${s}"`} ? "left" : "right"`}}return(r<e&&e<180+r)==(t===s)?"left":"right"}function Ix(e,t){if(t==="x"&&G(["quantitative","temporal"],e))return!0}function Rx(e,t,n,i){if(n&&!q(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function Px(e){return e==="x"?"bottom":"left"}function Lx({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!be(t)&&t!=="log"){if(E(e)){if(ne(e.bin))return{signal:`ceil(${n.signal}/10)`};if(e.timeUnit&&G(["month","hours","day","quarter"],(r=he(e.timeUnit))==null?void 0:r.unit))return}return{signal:`ceil(${n.signal}/40)`}}}function zx({format:e,fieldOrDatumDef:t}){if(e==="d")return 1;if(E(t)){const{timeUnit:n}=t;if(n){const i=lf(n);if(i)return{signal:i}}}}function Zd(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;if(s&&o)return qu(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function Dx(e,t){const n=e.values;if(T(n))return Bf(t,n);if(k(n))return n}function Mx(e,t){return e==="rect"&&Ir(t)?1:0}class gi extends K{clone(){return new gi(null,D(this.transform))}constructor(t,n){super(t),this.transform=n,this._dependentFields=Xd(this.transform.calculate)}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(Un(i)&&Ff(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,c=a.map((l,u)=>`${df({field:s,timeUnit:o,equal:l})} ? ${u} : `).join("")+a.length;t=new gi(t,{calculate:c,as:hi(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${W(this.transform)}`}}function hi(e,t,n){return $(e,{prefix:t,suffix:"sort_index",...n??{}})}function Es(e,t){return G(["top","bottom"],t)?"column":G(["left","right"],t)||e==="row"?"row":"column"}function mi(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return fe((t||{})[e],r[e],n.header[e])}function ws(e,t,n,i){const r={};for(const s of e){const o=mi(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const Ka=["row","column"],Ja=["header","footer"];function jx(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=ws(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),c=Es(t,a),l=Hi(o);return{name:`${t}-title`,type:"group",role:`${c}-title`,title:{text:n,...t==="row"?{orient:"left"}:{},style:"guide-title",...tp(l,c),...ep(c,l,s),...np(i,r,t,Nb,sd)}}}function ep(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=Qd(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function tp(e,t){const n=Jd(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Ux(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of Ja)if(n[r])for(const s of n[r]){const o=Wx(e,t,r,n,s);o!=null&&i.push(o)}return i}function Bx(e,t){const{sort:n}=e;return pt(n)?{field:$(n,{expr:"datum"}),order:n.order??"ascending"}:T(n)?{field:hi(e,t,{expr:"datum"}),order:"ascending"}:{field:$(e,{expr:"datum"}),order:n??"ascending"}}function To(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:c}=ws(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=Oa({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,u=Es(t,a);return{text:{signal:c?Cn(Cn(c,"datum.label",l),"datum.value",$(e,{expr:"parent"})):l},...t==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...tp(s,u),...ep(u,s,o),...np(n,e,t,_b,od)}}function Wx(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=ws(["labelOrient"],o.header,a,t);(t==="row"&&!G(["top","bottom"],f)||t==="column"&&!G(["left","right"],f))&&(s=To(o,t,a))}const c=Qe(e)&&!sr(e.facet),l=r.axes,u=(l==null?void 0:l.length)>0;if(s||u){const f=t==="row"?"height":"width";return{name:e.getName(`${t}_${n}`),type:"group",role:`${t}-${n}`,...i.facetFieldDef?{from:{data:e.getName(`${t}_domain`)},sort:Bx(o,t)}:{},...u&&c?{from:{data:e.getName(`facet_domain_${t}`)}}:{},...s?{title:s}:{},...r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{},...u?{axes:l}:{}}}}return null}const Gx={column:{start:0,end:1},row:{start:1,end:0}};function Hx(e,t){return Gx[t][e]}function qx(e,t){const n={};for(const i of je){const r=e[i];if(r!=null&&r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=ws(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=Es(i,o),c=Hx(s,a);c!==void 0&&(n[a]=c)}}return J(n)?void 0:n}function np(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=mi(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function Qa(e){return[...hr(e,"width"),...hr(e,"height"),...hr(e,"childWidth"),...hr(e,"childHeight")]}function hr(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(be(o)&&on(a)){const c=e.scaleName(n);return Qe(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[hl(c,a)]:[hl(c,a),{name:r,update:ip(c,s,`domain('${c}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=So(e.config.view,s?"width":"height"),c=`isFinite(${o}) ? ${o} : ${a}`;return[{name:r,init:c,on:[{update:c,events:"window:resize"}]}]}else return[{name:r,value:i}]}function hl(e,t){const n=`${e}_step`;return k(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function ip(e,t,n){const i=t.get("type"),r=t.get("padding"),s=fe(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,`bandspace(${n}, ${Ve(o)}, ${Ve(s)}) * ${e}_step`}function rp(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function sp(e,t){return x(e).reduce((n,i)=>{const r=e[i];return{...n,...wi(t,r,i,s=>re(s.value))}},{})}function op(e,t){if(Qe(t))return e==="theta"?"independent":"shared";if(Ni(t))return"shared";if(sc(t))return ye(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function Za(e,t){const n=e.scale[t],i=ye(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&S($m(t)),"independent"):e[i][t]||"shared"}const Xx={...Fb,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},ap=x(Xx);class Vx extends Ut{}const ml={symbols:Yx,gradient:Kx,labels:Jx,entries:Qx};function Yx(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){if(s!=="symbol")return;const{markDef:o,encoding:a,config:c,mark:l}=n,u=o.filled&&l!=="trail";let f={...Rh({},n,Ny),...Id(n,{filled:u})};const d=r.get("symbolOpacity")??c.legend.symbolOpacity,p=r.get("symbolFillColor")??c.legend.symbolFillColor,g=r.get("symbolStrokeColor")??c.legend.symbolStrokeColor,h=d===void 0?cp(a.opacity)??o.opacity:void 0;if(f.fill){if(i==="fill"||u&&i===ke)delete f.fill;else if(f.fill.field)p?delete f.fill:(f.fill=re(c.legend.symbolBaseFillColor??"black"),f.fillOpacity=re(h??1));else if(T(f.fill)){const m=Ao(a.fill??a.color)??o.fill??(u&&o.color);m&&(f.fill=re(m))}}if(f.stroke){if(i==="stroke"||!u&&i===ke)delete f.stroke;else if(f.stroke.field||g)delete f.stroke;else if(T(f.stroke)){const m=fe(Ao(a.stroke||a.color),o.stroke,u?o.color:void 0);m&&(f.stroke={value:m})}}if(i!==Dt){const m=E(t)&&up(n,r,t);m?f.opacity=[{test:m,...re(h??1)},re(c.legend.unselectedOpacity)]:h&&(f.opacity=re(h))}return f={...f,...e},J(f)?void 0:f}function Kx(e,{model:t,legendType:n,legendCmpt:i}){if(n!=="gradient")return;const{config:r,markDef:s,encoding:o}=t;let a={};const l=(i.get("gradientOpacity")??r.legend.gradientOpacity)===void 0?cp(o.opacity)||s.opacity:void 0;return l&&(a.opacity=re(l)),a={...a,...e},J(a)?void 0:a}function Jx(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=E(t)?up(n,r,t):void 0,c=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:u}=s;let f;Fn(u)?f=Ke({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:u,config:o}):l===void 0&&u===void 0&&o.customFormatTypes&&(t.type==="quantitative"&&o.numberFormatType?f=Ke({fieldOrDatumDef:t,field:"datum.value",format:o.numberFormat,formatType:o.numberFormatType,config:o}):t.type==="temporal"&&o.timeFormatType&&E(t)&&t.timeUnit===void 0&&(f=Ke({fieldOrDatumDef:t,field:"datum.value",format:o.timeFormat,formatType:o.timeFormatType,config:o})));const d={...c?{opacity:c}:{},...f?{text:f}:{},...e};return J(d)?void 0:d}function Qx(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?{...e,fill:{value:"transparent"}}:e}function cp(e){return lp(e,(t,n)=>Math.max(t,n.value))}function Ao(e){return lp(e,(t,n)=>fe(t,n.value))}function lp(e,t){if(Xy(e))return le(e.condition).reduce(t,e.value);if(Ze(e))return e.value}function up(e,t,n){const i=t.get("selections");if(!(i!=null&&i.length))return;const r=B(n.field);return i.map(s=>`(!length(data(${B(se(s)+In)})) || (${s}[${r}] && indexof(${s}[${r}], datum.value) >= 0))`).join(" || ")}const yl={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return Nf(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return _f(i,t,n)},gradientLength:e=>{const{legend:t,legendConfig:n}=e;return t.gradientLength??n.gradientLength??sS(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>e.labelOverlap??t.labelOverlap??oS(n),symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>e.symbolType??eS(t.type,n,i.shape,t.shape),title:({fieldOrDatumDef:e,config:t})=>Zn(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Qn(n)&&Ye(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>Zx(t,e)};function Zx(e,t){const n=e.values;if(T(n))return Bf(t,n);if(k(n))return n}function eS(e,t,n,i){if(t!=="shape"){const r=Ao(n)??i;if(r)return r}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function tS(e){const{legend:t}=e;return fe(t.type,nS(e))}function nS({channel:e,timeUnit:t,scaleType:n}){if(Qn(e)){if(G(["quarter","month","day"],t))return"symbol";if(Ye(n))return"gradient"}return"symbol"}function iS({legendConfig:e,legendType:t,orient:n,legend:i}){return i.direction??e[t?"gradientDirection":"symbolDirection"]??rS(n,t)}function rS(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function sS({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:c}=e;if(Ye(r))return n==="horizontal"?i==="top"||i==="bottom"?bl(t,"width",o,s):o:bl(t,"height",c,a)}function bl(e,t,n,i){return{signal:`clamp(${e.getSizeSignalRef(t).signal}, ${n}, ${i})`}}function oS(e){if(G(["quantile","threshold","log","symlog"],e))return"greedy"}function fp(e){const t=ce(e)?aS(e):fS(e);return e.component.legends=t,t}function aS(e){const{encoding:t}=e,n={};for(const i of[ke,...cd]){const r=de(t[i]);!r||!e.getScaleComponent(i)||i===Ie&&E(r)&&r.type===Ei||(n[i]=uS(e,i))}return n}function cS(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function lS(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function uS(e,t){var I;let n=e.legend(t);const{markDef:i,encoding:r,config:s}=e,o=s.legend,a=new Vx({},cS(e,t));vx(e,t,a);const c=n!==void 0?!n:o.disable;if(a.set("disable",c,n!==void 0),c)return a;n=n||{};const l=e.getScaleComponent(t).get("type"),u=de(r[t]),f=E(u)?(I=he(u.timeUnit))==null?void 0:I.unit:void 0,d=n.orient||s.legend.orient||"right",p=tS({legend:n,channel:t,timeUnit:f,scaleType:l}),g=iS({legend:n,legendType:p,orient:d,legendConfig:o}),h={legend:n,channel:t,model:e,markDef:i,encoding:r,fieldOrDatumDef:u,legendConfig:o,config:s,scaleType:l,orient:d,legendType:p,direction:g};for(const v of ap){if(p==="gradient"&&v.startsWith("symbol")||p==="symbol"&&v.startsWith("gradient"))continue;const _=v in yl?yl[v](h):n[v];if(_!==void 0){const O=lS(_,v,n,e.fieldDef(t));(O||s.legend[v]===void 0)&&a.set(v,_,O)}}const m=(n==null?void 0:n.encoding)??{},y=a.get("selections"),b={},C={fieldOrDatumDef:u,model:e,channel:t,legendCmpt:a,legendType:p};for(const v of["labels","legend","title","symbols","gradient","entries"]){const _=sp(m[v]??{},e),O=v in ml?ml[v](_,C):_;O!==void 0&&!J(O)&&(b[v]={...y!=null&&y.length&&E(u)?{name:`${se(u.field)}_legend_${v}`}:{},...y!=null&&y.length?{interactive:!!y}:{},update:O})}return J(b)||a.set("encode",b,!!(n!=null&&n.encoding)),a}function fS(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){fp(i);for(const r of x(i.component.legends))n.legend[r]=Za(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=dp(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of x(t))for(const r of e.children)r.component.legends[i]&&n.legend[i]==="shared"&&delete r.component.legends[i];return t}function dp(e,t){var s,o,a,c;if(!e)return t.clone();const n=e.getWithExplicit("orient"),i=t.getWithExplicit("orient");if(n.explicit&&i.explicit&&n.value!==i.value)return;let r=!1;for(const l of ap){const u=Yt(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return dS(f,d);case"title":return Xu(f,d);case"type":return r=!0,Pe("symbol")}return vs(f,d,l,"legend")});e.setWithExplicit(l,u)}return r&&((o=(s=e.implicit)==null?void 0:s.encode)!=null&&o.gradient&&Nr(e.implicit,["encode","gradient"]),(c=(a=e.explicit)==null?void 0:a.encode)!=null&&c.gradient&&Nr(e.explicit,["encode","gradient"])),e}function dS(e,t){return t.value==="circle"?t:e}function pS(e,t,n,i){var r,s;e.encode??(e.encode={}),(r=e.encode)[t]??(r[t]={}),(s=e.encode[t]).update??(s.update={}),e.encode[t].update[n]=i}function pp(e){const t=e.component.legends,n={};for(const r of x(t)){const s=e.getScaleComponent(r),o=te(s.get("domains"));if(n[o])for(const a of n[o])dp(a,t[r])||n[o].push(t[r]);else n[o]=[t[r].clone()]}return Se(n).flat().map(r=>gS(r,e.config)).filter(r=>r!==void 0)}function gS(e,t){var o,a,c;const{disable:n,labelExpr:i,selections:r,...s}=e.combine();if(!n){if(t.aria===!1&&s.aria==null&&(s.aria=!1),(o=s.encode)!=null&&o.symbols){const l=s.encode.symbols.update;l.fill&&l.fill.value!=="transparent"&&!l.stroke&&!s.stroke&&(l.stroke={value:"transparent"});for(const u of cd)s[u]&&delete l[u]}if(s.title||delete s.title,i!==void 0){let l=i;(c=(a=s.encode)==null?void 0:a.labels)!=null&&c.update&&k(s.encode.labels.update.text)&&(l=Cn(i,"datum.label",s.encode.labels.update.text.signal)),pS(s,"labels","text",{signal:l})}return s}}function hS(e){return Ni(e)||sc(e)?mS(e):gp(e)}function mS(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),gp(e))}function gp(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:`[${t.size.map(o=>o.signal).join(", ")}]`},s=t.data.reduce((o,a)=>{const c=k(a)?a.signal:`data('${e.lookupDataSource(a)}')`;return G(o,c)||o.push(c),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:i,size:r,fit:{signal:s.length>1?`[${s.join(", ")}]`:s[0]},...n}]}else return[{name:i,translate:{signal:"[width / 2, height / 2]"},...n}]}const yS=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class hp extends Ut{constructor(t,n,i,r){super({...n},{name:t}),this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function mp(e){e.component.projection=ce(e)?bS(e):SS(e)}function bS(e){if(e.hasProjection){const t=_e(e.specifiedProjection),n=!(t&&(t.scale!=null||t.translate!=null)),i=n?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,r=n?vS(e):void 0,s=new hp(e.projectionName(!0),{..._e(e.config.projection)??{},...t??{}},i,r);return s.get("type")||s.set("type","equalEarth",!1),s}}function vS(e){const t=[],{encoding:n}=e;for(const i of[[rt,it],[Be,st]])(de(n[i[0]])||de(n[i[1]]))&&t.push({signal:e.getName(`geojson_${t.length}`)});return e.channelHasField(Ie)&&e.typedFieldDef(Ie).type===Ei&&t.push({signal:e.getName(`geojson_${t.length}`)}),t.length===0&&t.push(e.requestDataName(ee.Main)),t}function xS(e,t){const n=Go(yS,r=>!!(!Yn(e.explicit,r)&&!Yn(t.explicit,r)||Yn(e.explicit,r)&&Yn(t.explicit,r)&&ft(e.get(r),t.get(r))));if(ft(e.size,t.size)){if(n)return e;if(ft(e.explicit,{}))return t;if(ft(t.explicit,{}))return e}return null}function SS(e){if(e.children.length===0)return;let t;for(const i of e.children)mp(i);const n=Go(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=xS(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new hp(i,t.specifiedProjection,t.size,D(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}}function ES(e,t,n,i){if(ar(t,n)){const r=ce(e)?e.axis(n)??e.legend(n)??{}:{},s=$(t,{expr:"datum"}),o=$(t,{expr:"datum",binSuffix:"end"});return{formulaAs:$(t,{binSuffix:"range",forAs:!0}),formula:rr(s,o,r.format,r.formatType,i)}}return{}}function yp(e,t){return`${Mu(e)}_${t}`}function wS(e,t){return{signal:e.getName(`${t}_bins`),extentSignal:e.getName(`${t}_extent`)}}function ec(e,t,n){const i=ps(n,void 0)??{},r=yp(i,t);return e.getName(`${r}_bins`)}function $S(e){return"as"in e}function vl(e,t,n){let i,r;$S(e)?i=L(e.as)?[e.as,`${e.as}_end`]:[e.as[0],e.as[1]]:i=[$(e,{forAs:!0}),$(e,{binSuffix:"end",forAs:!0})];const s={...ps(t,void 0)},o=yp(s,e.field),{signal:a,extentSignal:c}=wS(n,o);if(ns(s.extent)){const u=s.extent;r=Yd(n,u.param,u),delete s.extent}const l={bin:s,field:e.field,as:[i],...a?{signal:a}:{},...c?{extentSignal:c}:{},...r?{span:r}:{}};return{key:o,binComponent:l}}class ht extends K{clone(){return new ht(null,D(this.bins))}constructor(t,n){super(t),this.bins=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(Ce(s)&&ne(s.bin)){const{key:a,binComponent:c}=vl(s,s.bin,n);r[a]={...c,...r[a],...ES(n,s,o,n.config)}}return r},{});return J(i)?null:new ht(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=vl(n,n.bin,i);return new ht(t,{[r]:s})}merge(t,n){for(const i of x(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=dt([...this.bins[i].as,...t.bins[i].as],W)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(Se(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Se(this.bins).map(t=>t.field))}hash(){return`Bin ${W(this.bins)}`}assemble(){return Se(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,{extent:s,...o}=t.bin,a={type:"bin",field:Ue(t.field),as:i,signal:t.signal,...ns(s)?{extent:null}:{extent:s},...t.span?{span:{signal:`span(${t.span})`}}:{},...o};!s&&t.extentSignal&&(n.push({type:"extent",field:Ue(t.field),signal:t.extentSignal}),a.extent={signal:t.extentSignal}),n.push(a);for(const c of r)for(let l=0;l<2;l++)n.push({type:"formula",expr:$({field:i[l]},{expr:"datum"}),as:c[l]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function OS(e,t,n,i){var s;const r=ce(i)?i.encoding[Et(t)]:void 0;if(Ce(n)&&ce(i)&&Rf(n,r,i.markDef,i.config))e.add($(n,{})),e.add($(n,{suffix:"end"})),n.bin&&ar(n,t)&&e.add($(n,{binSuffix:"range"}));else if(_u(t)){const o=Nu(t);e.add(i.getName(o))}else e.add($(n));return Un(n)&&hy((s=n.scale)==null?void 0:s.range)&&e.add(n.scale.range.field),e}function CS(e,t){for(const n of x(t)){const i=t[n];for(const r of x(i))n in e?e[n][r]=new Set([...e[n][r]??[],...i[r]]):e[n]={[r]:i[r]}}}class Je extends K{clone(){return new Je(null,new Set(this.dimensions),D(this.measures))}constructor(t,n,i){super(t),this.dimensions=n,this.measures=i}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return!i||(n.forEachFieldDef((o,a)=>{const{aggregate:c,field:l}=o;if(c)if(c==="count")r["*"]??(r["*"]={}),r["*"].count=new Set([$(o,{forAs:!0})]);else{if(It(c)||sn(c)){const u=It(c)?"argmin":"argmax",f=c[u];r[f]??(r[f]={}),r[f][u]=new Set([$({op:u,field:f},{forAs:!0})])}else r[l]??(r[l]={}),r[l][c]=new Set([$(o,{forAs:!0})]);Mt(a)&&n.scaleDomain(a)==="unaggregated"&&(r[l]??(r[l]={}),r[l].min=new Set([$({field:l,aggregate:"min"},{forAs:!0})]),r[l].max=new Set([$({field:l,aggregate:"max"},{forAs:!0})]))}else OS(s,a,o,n)}),s.size+x(r).length===0)?null:new Je(t,s,r)}static makeFromTransform(t,n){const i=new Set,r={};for(const s of n.aggregate){const{op:o,field:a,as:c}=s;o&&(o==="count"?(r["*"]??(r["*"]={}),r["*"].count=new Set([c||$(s,{forAs:!0})])):(r[a]??(r[a]={}),r[a][o]=new Set([c||$(s,{forAs:!0})])))}for(const s of n.groupby??[])i.add(s);return i.size+x(r).length===0?null:new Je(t,i,r)}merge(t){return vu(this.dimensions,t.dimensions)?(CS(this.measures,t.measures),!0):(jm("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...x(this.measures)])}producedFields(){const t=new Set;for(const n of x(this.measures))for(const i of x(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add(`${i}_${n}`):r.forEach(t.add,t)}return t}hash(){return`Aggregate ${W({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[],n=[],i=[];for(const s of x(this.measures))for(const o of x(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:Ue(s));return{type:"aggregate",groupby:[...this.dimensions].map(Ue),ops:t,fields:n,as:i}}}class Oi extends K{constructor(t,n,i,r){super(t),this.model=n,this.name=i,this.data=r;for(const s of je){const o=n.facet[s];if(o){const{bin:a,sort:c}=o;this[s]={name:n.getName(`${s}_domain`),fields:[$(o),...ne(a)?[$(o,{binSuffix:"end"})]:[]],...pt(c)?{sortField:c}:T(c)?{sortIndexField:hi(o,s)}:{}}}}this.childModel=n.child}hash(){let t="Facet";for(const n of je)this[n]&&(t+=` ${n.charAt(0)}:${W(this[n])}`);return t}get fields(){var n;const t=[];for(const i of je)(n=this[i])!=null&&n.fields&&t.push(...this[i].fields);return t}dependentFields(){const t=new Set(this.fields);for(const n of je)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of wt){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(be(r)&&on(s)){const o=$s(this.childModel,n),a=rc(o);a?t[n]=a:S(ra(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push(`distinct_${i[r]}`),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push(`distinct_${i[r]}`));const{sortField:c,sortIndexField:l}=this[t];if(c){const{op:u=ls,field:f}=c;s.push(f),o.push(u),a.push($(c,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n??this.data,transform:[{type:"aggregate",groupby:this[t].fields,...s.length?{fields:s,ops:o,as:a}:{}}]}}assembleFacetHeaderData(t){var c;const{columns:n}=this.model.layout,{layoutHeaders:i}=this.model.component,r=[],s={};for(const l of Ka){for(const u of Ja){const f=(i[l]&&i[l][u])??[];for(const d of f)if(((c=d.axes)==null?void 0:c.length)>0){s[l]=!0;break}}if(s[l]){const u=`length(data("${this.facet.name}"))`,f=l==="row"?n?{signal:`ceil(${u} / ${n})`}:1:n?{signal:`min(${u}, ${n})`}:{signal:u};r.push({name:`${this.facet.name}_${l}`,transform:[{type:"sequence",start:0,stop:f}]})}}const{row:o,column:a}=s;return(o||a)&&r.unshift(this.assembleRowColumnHeaderData("facet",null,t)),r}assemble(){const t=[];let n=null;const i=this.getChildIndependentFieldsWithStep(),{column:r,row:s,facet:o}=this;if(r&&s&&(i.x||i.y)){n=`cross_${this.column.name}_${this.row.name}`;const a=[].concat(i.x??[],i.y??[]),c=a.map(()=>"distinct");t.push({name:n,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:a,ops:c}]})}for(const a of[At,Tt])this[a]&&t.push(this.assembleRowColumnHeaderData(a,n,i));if(o){const a=this.assembleFacetHeaderData(i);a&&t.push(...a)}return t}}function xl(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function NS(e,t){const n=Xo(e);if(t==="number")return`toNumber(${n})`;if(t==="boolean")return`toBoolean(${n})`;if(t==="string")return`toString(${n})`;if(t==="date")return`toDate(${n})`;if(t==="flatten")return n;if(t.startsWith("date:")){const i=xl(t.slice(5,t.length));return`timeParse(${n},'${i}')`}else if(t.startsWith("utc:")){const i=xl(t.slice(4,t.length));return`utcParse(${n},'${i}')`}else return S(Xh(t)),null}function _S(e){const t={};return $r(e.filter,n=>{if(ff(n)){let i=null;ca(n)?i=Le(n.equal):ua(n)?i=Le(n.lte):la(n)?i=Le(n.lt):fa(n)?i=Le(n.gt):da(n)?i=Le(n.gte):pa(n)?i=n.range[0]:ga(n)&&(i=(n.oneOf??n.in)[0]),i&&(Mn(i)?t[n.field]="date":ue(i)?t[n.field]="number":L(i)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function TS(e){const t={};function n(i){fi(i)?t[i.field]="date":i.type==="quantitative"&&Oh(i.aggregate)?t[i.field]="number":ri(i.field)>1?i.field in t||(t[i.field]="flatten"):Un(i)&&pt(i.sort)&&ri(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((ce(e)||Qe(e))&&e.forEachFieldDef((i,r)=>{if(Ce(i))n(i);else{const s=zn(r),o=e.fieldDef(s);n({...i,type:o.type})}}),ce(e)){const{mark:i,markDef:r,encoding:s}=e;if(an(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];E(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function AS(e){const t={};if(ce(e)&&e.component.selection)for(const n of x(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&ri(r.field)>1&&(t[r.field]="flatten")}return t}class $e extends K{clone(){return new $e(null,D(this._parse))}constructor(t,n){super(t),this._parse=n}hash(){return`Parse ${W(this._parse)}`}static makeExplicit(t,n,i){var o;let r={};const s=n.data;return!Ht(s)&&((o=s==null?void 0:s.format)!=null&&o.parse)&&(r=s.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const a of x(i)){const c=r.getWithExplicit(a);c.value!==void 0&&(c.explicit||c.value===i[a]||c.value==="derived"||i[a]==="flatten"?delete i[a]:S(kc(a,i[a],c.value)))}for(const a of x(n)){const c=r.get(a);c!==void 0&&(c===n[a]?delete n[a]:S(kc(a,n[a],c)))}const s=new Ut(n,i);r.copyAll(s);const o={};for(const a of x(s.combine())){const c=s.get(a);c!==null&&(o[a]=c)}return x(o).length===0||r.parseNothing?null:new $e(t,o)}get parse(){return this._parse}merge(t){this._parse={...this._parse,...t.parse},t.remove()}assembleFormatParse(){const t={};for(const n of x(this._parse)){const i=this._parse[n];ri(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(x(this._parse))}dependentFields(){return new Set(x(this._parse))}assembleTransforms(t=!1){return x(this._parse).filter(n=>t?ri(n)>1:!0).map(n=>{const i=NS(n,this._parse[n]);return i?{type:"formula",expr:i,as:Vo(n)}:null}).filter(n=>n!==null)}}class Qt extends K{clone(){return new Qt(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([et])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:et}}}class ur extends K{clone(){return new ur(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){}hash(){return`Graticule ${W(this.params)}`}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class fr extends K{clone(){return new fr(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){return new Set([this.params.as??"data"])}hash(){return`Hash ${W(this.params)}`}assemble(){return{type:"sequence",...this.params}}}class Rn extends K{constructor(t){super(null),t??(t={name:"source"});let n;if(Ht(t)||(n=t.format?{...Te(t.format,["parse"])}:{}),qi(t))this._data={values:t.values};else if(di(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];G(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else Cd(t)?this._data={values:[{type:"Sphere"}]}:($d(t)||Ht(t))&&(this._data={});this._generator=Ht(t),t.name&&(this._name=t.name),n&&!J(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var Sl=globalThis&&globalThis.__classPrivateFieldSet||function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},FS=globalThis&&globalThis.__classPrivateFieldGet||function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},zi;function tc(e){return e instanceof Rn||e instanceof ur||e instanceof fr}class nc{constructor(){zi.set(this,void 0),Sl(this,zi,!1,"f")}setModified(){Sl(this,zi,!0,"f")}get modifiedFlag(){return FS(this,zi,"f")}}zi=new WeakMap;class Bn extends nc{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class ic extends nc{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class kS extends ic{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of x(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class IS extends ic{constructor(t){super(),this.requiresSelectionId=t&&Ya(t)}run(t){t instanceof Qt&&(this.requiresSelectionId&&(tc(t.parent)||t.parent instanceof Je||t.parent instanceof $e)||(this.setModified(),t.remove()))}}class RS extends nc{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof gt&&(i=t.producedFields(),Ho(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class PS extends ic{constructor(){super()}run(t){t instanceof Oe&&!t.isRequired()&&(this.setModified(),t.remove())}}class LS extends Bn{run(t){if(!tc(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof $e)if(t instanceof $e)this.setModified(),t.merge(n);else{if(qo(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class zS extends Bn{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof $e);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const c of x(a))c in r?r[c]!==a[c]&&s.add(c):r[c]=a[c]}for(const o of s)delete r[o];if(!J(r)){this.setModified();const o=new $e(t,r);for(const a of n){if(a instanceof $e)for(const c of x(r))delete a.parse[c];t.removeChild(a),a.parent=o,a instanceof $e&&x(a.parse).length===0&&a.remove()}}}}}class DS extends Bn{run(t){t instanceof Oe||t.numChildren()>0||t instanceof Oi||t instanceof Rn||(this.setModified(),t.remove())}}class MS extends Bn{run(t){const n=t.children.filter(r=>r instanceof gt),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class jS extends Bn{run(t){const n=t.children.filter(r=>r instanceof Je),i={};for(const r of n){const s=W(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of x(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class US extends Bn{constructor(t){super(),this.model=t}run(t){const n=!(tc(t)||t instanceof $i||t instanceof $e||t instanceof Qt),i=[],r=[];for(const s of t.children)s instanceof ht&&(n&&!qo(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof ht?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class BS extends Bn{run(t){const n=[...t.children];if(!On(n,o=>o instanceof Oe)||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof Oe){let a=o;for(;a.numChildren()===1;){const[c]=a.children;if(c instanceof Oe)a=c;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class Wn extends K{clone(){return new Wn(null,D(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=dt(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){return t.as??$(t)}hash(){return`JoinAggregateTransform ${W(this.transform)}`}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return{type:"joinaggregate",as:i,ops:n,fields:t,...r!==void 0?{groupby:r}:{}}}}function WS(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=$(i);return r&&t.push(r),t},[])}function GS(e){return T(e)&&e.every(t=>L(t))&&e.length>1}class kt extends K{clone(){return new kt(null,D(this._stack))}constructor(t,n){super(t),this._stack=n}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],c=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),c.push(fe(f.order,"ascending"));const l={field:a,order:c};let u;return GS(s)?u=s:L(s)?u=[s,`${s}_end`]:u=[`${n.stack}_start`,`${n.stack}_end`],new kt(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:s,fieldChannel:o,offset:a,impute:c}=i,l=s.map(p=>{const g=r[p];return yt(g)}).filter(p=>!!p),u=WS(n),f=n.encoding.order;let d;if(T(f)||E(f))d=Gu(f);else{const p=Pf(f)?f.sort:o==="y"?"descending":"ascending";d=u.reduce((g,h)=>(g.field.push(h),g.order.push(p),g),{field:[],order:[]})}return new kt(t,{dimensionFieldDefs:l,stackField:n.vgField(o),facetby:[],stackby:u,sort:d,offset:a,impute:c,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${W(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[$(r,{binSuffix:"mid"})]:[$(r,{}),$(r,{binSuffix:"end"})]:[$(r)]).flat():i??[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:s,sort:o,offset:a,impute:c,as:l}=this._stack;if(c)for(const u of i){const{bandPosition:f=.5,bin:d}=u;if(d){const p=$(u,{expr:"datum"}),g=$(u,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${f}*${p}+${1-f}*${g}`,as:$(u,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...s,...n],key:$(u,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class Ci extends K{clone(){return new Ci(null,D(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=dt(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return(this.transform.groupby??[]).forEach(t.add,t),(this.transform.sort??[]).forEach(n=>t.add(n.field)),this.transform.window.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){return t.as??$(t)}hash(){return`WindowTransform ${W(this.transform)}`}assemble(){const t=[],n=[],i=[],r=[];for(const f of this.transform.window)n.push(f.op),i.push(this.getDefaultName(f)),r.push(f.param===void 0?null:f.param),t.push(f.field===void 0?null:f.field);const s=this.transform.frame,o=this.transform.groupby;if(s&&s[0]===null&&s[1]===null&&n.every(f=>na(f)))return{type:"joinaggregate",as:i,ops:n,fields:t,...o!==void 0?{groupby:o}:{}};const a=[],c=[];if(this.transform.sort!==void 0)for(const f of this.transform.sort)a.push(f.field),c.push(f.order??"ascending");const l={field:a,order:c},u=this.transform.ignorePeers;return{type:"window",params:r,as:i,ops:n,fields:t,sort:l,...u!==void 0?{ignorePeers:u}:{},...o!==void 0?{groupby:o}:{},...s!==void 0?{frame:s}:{}}}}function HS(e){function t(n){if(!(n instanceof Oi)){const i=n.clone();if(i instanceof Oe){const r=ko+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Je||i instanceof kt||i instanceof Ci||i instanceof Wn)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function Fo(e){if(e instanceof Oi)if(e.numChildren()===1&&!(e.children[0]instanceof Oe)){const t=e.children[0];(t instanceof Je||t instanceof kt||t instanceof Ci||t instanceof Wn)&&t.addDimensions(e.fields),t.swapWithParent(),Fo(e)}else{const t=e.model.component.data.main;bp(t);const n=HS(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(Fo)}function bp(e){if(e instanceof Oe&&e.type===ee.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Oi||(t.swapWithParent(),bp(e))}}const ko="scale_",mr=5;function Io(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!Io(t.children))return!1}return!0}function He(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function El(e,t,n){let i=e.sources,r=!1;return r=He(new PS,i)||r,r=He(new IS(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=He(new DS,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=He(new LS,i)||r,r=He(new US(t),i)||r,r=He(new RS,i)||r,r=He(new zS,i)||r,r=He(new jS,i)||r,r=He(new MS,i)||r,r=He(new kS,i)||r,r=He(new BS,i)||r),e.sources=i,r}function qS(e,t){Io(e.sources);let n=0,i=0;for(let r=0;r<mr&&El(e,t,!0);r++)n++;e.sources.map(Fo);for(let r=0;r<mr&&El(e,t,!1);r++)i++;Io(e.sources),Math.max(n,i)===mr&&S(`Maximum optimization runs(${mr}) reached.`)}class Fe{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new Fe(()=>t(n))}}function vp(e){ce(e)?XS(e):VS(e)}function XS(e){const t=e.component.scales;for(const n of x(t)){const i=KS(e,n);if(t[n].setWithExplicit("domains",i),QS(e,n),e.component.data.isFaceted){let s=e;for(;!Qe(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of i.value)_t(a)&&(a.data=ko+a.data.replace(ko,""))}}}function VS(e){for(const n of e.children)vp(n);const t=e.component.scales;for(const n of x(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Yt(i,o.getWithExplicit("domains"),"domains","scale",Ro);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&S(Wh),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function YS(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=wl(t,n);if(!r){S(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=wl(t,n);if(r)return"unaggregated"}return e}function KS(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=YS(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]={...e.specifiedScales[t],domain:r}),t==="x"&&de(i.x2)?de(i.x)?Yt(Bt(n,r,e,"x"),Bt(n,r,e,"x2"),"domain","scale",Ro):Bt(n,r,e,"x2"):t==="y"&&de(i.y2)?de(i.y)?Yt(Bt(n,r,e,"y"),Bt(n,r,e,"y2"),"domain","scale",Ro):Bt(n,r,e,"y2"):Bt(n,r,e,t)}function JS(e,t,n){return e.map(i=>({signal:`{data: ${gs(i,{timeUnit:n,type:t})}}`}))}function Xs(e,t,n){var r;const i=(r=he(n))==null?void 0:r.unit;return t==="temporal"||i?JS(e,t,i):[e]}function Bt(e,t,n,i){const{encoding:r}=n,s=de(r[i]),{type:o}=s,a=s.timeUnit;if(gy(t)){const f=Bt(e,void 0,n,i),d=Xs(t.unionWith,o,a);return ut([...d,...f.value])}else{if(k(t))return ut([t]);if(t&&t!=="unaggregated"&&!bf(t))return ut(Xs(t,o,a))}const c=n.stack;if(c&&i===c.fieldChannel){if(c.offset==="normalize")return Pe([[0,1]]);const f=n.requestDataName(ee.Main);return Pe([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=Mt(i)&&E(s)?ZS(n,i,e):void 0;if($t(s)){const f=Xs([s.datum],o,a);return Pe(f)}const u=s;if(t==="unaggregated"){const f=n.requestDataName(ee.Main),{field:d}=s;return Pe([{data:f,field:$({field:d,aggregate:"min"})},{data:f,field:$({field:d,aggregate:"max"})}])}else if(ne(u.bin)){if(be(e))return Pe(e==="bin-ordinal"?[]:[{data:Gi(l)?n.requestDataName(ee.Main):n.requestDataName(ee.Raw),field:n.vgField(i,ar(u,i)?{binSuffix:"range"}:{}),sort:l===!0||!q(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=u;if(ne(f)){const d=ec(n,u.field,f);return Pe([new Fe(()=>{const p=n.getSignalName(d);return`[${p}.start, ${p}.stop]`})])}else return Pe([{data:n.requestDataName(ee.Main),field:n.vgField(i,{})}])}}else if(u.timeUnit&&G(["time","utc"],e)&&Rf(u,ce(n)?n.encoding[Et(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(ee.Main);return Pe([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Pe(l?[{data:Gi(l)?n.requestDataName(ee.Main):n.requestDataName(ee.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(ee.Main),field:n.vgField(i)}])}function Vs(e,t){const{op:n,field:i,order:r}=e;return{op:n??(t?"sum":ls),...i?{field:Ue(i)}:{},...r?{order:r}:{}}}function QS(e,t){var a;const n=e.component.scales[t],i=e.specifiedScales[t].domain,r=(a=e.fieldDef(t))==null?void 0:a.bin,s=bf(i)&&i,o=Dn(r)&&ns(r.extent)&&r.extent;(s||o)&&n.set("selectionExtent",s??o,!0)}function ZS(e,t,n){if(!be(n))return;const i=e.fieldDef(t),r=i.sort;if(Ff(r))return{op:"min",field:hi(i,t),order:"ascending"};const{stack:s}=e,o=s?new Set([...s.groupbyFields,...s.stackBy.map(a=>a.fieldDef.field)]):void 0;if(pt(r)){const a=s&&!o.has(r.field);return Vs(r,a)}else if(Af(r)){const{encoding:a,order:c}=r,l=e.fieldDef(a),{aggregate:u,field:f}=l,d=s&&!o.has(f);if(It(u)||sn(u))return Vs({field:$(l),order:c},d);if(na(u)||!u)return Vs({op:u,field:f,order:c},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(G(["ascending",void 0],r))return!0}}function wl(e,t){const{aggregate:n,type:i}=e;return n?L(n)&&!Nh.has(n)?{valid:!1,reason:ym(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:bm(e)}:{valid:!0}:{valid:!1,reason:mm(e)}}function Ro(e,t,n,i){return e.explicit&&t.explicit&&S(wm(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function eE(e){const t=dt(e.map(o=>{if(_t(o)){const{sort:a,...c}=o;return c}return o}),W),n=dt(e.map(o=>{if(_t(o)){const a=o.sort;return a!==void 0&&!Gi(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),W);if(t.length===0)return;if(t.length===1){const o=e[0];if(_t(o)&&n.length>0){let a=n[0];if(n.length>1){S(Rc);const c=n.filter(l=>q(l)&&"op"in l&&l.op!=="min");n.every(l=>q(l)&&"op"in l)&&c.length===1?a=c[0]:a=!0}else if(q(a)&&"field"in a){const c=a.field;o.field===c&&(a=a.order?{order:a.order}:!0)}return{...o,sort:a}}return o}const i=dt(n.map(o=>Gi(o)||!("op"in o)||L(o.op)&&o.op in wh?o:(S(Om(o)),!0)),W);let r;i.length===1?r=i[0]:i.length>1&&(S(Rc),r=!0);const s=dt(e.map(o=>_t(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?{data:s[0],fields:t.map(a=>a.field),...r?{sort:r}:{}}:{fields:t,...r?{sort:r}:{}}}function rc(e){if(_t(e)&&L(e.field))return e.field;if(_h(e)){let t;for(const n of e.fields)if(_t(n)&&L(n.field)){if(!t)t=n.field;else if(t!==n.field)return S(Cm),t}return S(Nm),t}else if(Th(e)){S(_m);const t=e.fields[0];return L(t)?t:void 0}}function $s(e,t){const i=e.component.scales[t].get("domains").map(r=>(_t(r)&&(r.data=e.lookupDataSource(r.data)),r));return eE(i)}function xp(e){return Ni(e)||sc(e)?e.children.reduce((t,n)=>t.concat(xp(n)),$l(e)):$l(e)}function $l(e){return x(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:c,range:l,reverse:u,...f}=r,d=tE(r.range,s,n,e),p=$s(e,n),g=a?Yv(e,a,i,p):null;return t.push({name:s,type:o,...p?{domain:p}:{},...g?{domainRaw:g}:{},range:d,...u!==void 0?{reverse:u}:{},...f}),t},[])}function tE(e,t,n,i){if(ye(n)){if(on(e))return{step:{signal:`${t}_step`}}}else if(q(e)&&_t(e))return{...e,data:i.lookupDataSource(e.data)};return e}class Sp extends Ut{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:On(this.get("domains"),t=>T(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const nE=["range","scheme"];function iE(e){const t=e.component.scales;for(const n of ts){const i=t[n];if(!i)continue;const r=rE(n,e);i.setWithExplicit("range",r)}}function Ol(e,t){const n=e.fieldDef(t);if(n!=null&&n.bin){const{bin:i,field:r}=n,s=Re(t),o=e.getName(s);if(q(i)&&i.binned&&i.step!==void 0)return new Fe(()=>{const a=e.scaleName(t),c=`(domain("${a}")[1] - domain("${a}")[0]) / ${i.step}`;return`${e.getSignalName(o)} / (${c})`});if(ne(i)){const a=ec(e,r,i);return new Fe(()=>{const c=e.getSignalName(a),l=`(${c}.stop - ${c}.start) / ${c}.step`;return`${e.getSignalName(o)} / (${l})`})}}}function rE(e,t){const n=t.specifiedScales[e],{size:i}=t,s=t.getScaleComponent(e).get("type");for(const f of nE)if(n[f]!==void 0){const d=yo(s,f),p=vf(e,f);if(!d)S(Ju(s,f,e));else if(p)S(p);else switch(f){case"range":{const g=n.range;if(T(g)){if(ye(e))return ut(g.map(h=>{if(h==="width"||h==="height"){const m=t.getName(h),y=t.getSignalName.bind(t);return Fe.fromName(y,m)}return h}))}else if(q(g))return ut({data:t.requestDataName(ee.Main),field:g.field,sort:{op:"min",field:t.vgField(e)}});return ut(g)}case"scheme":return ut(sE(n[f]))}}const o=e===oe||e==="xOffset"?"width":"height",a=i[o];if(bt(a)){if(ye(e))if(be(s)){const f=Ep(a,t,e);if(f)return ut({step:f})}else S(Qu(o));else if(Si(e)){const f=e===Zt?"x":"y";if(t.getScaleComponent(f).get("type")==="band"){const g=wp(a,s);if(g)return ut(g)}}}const{rangeMin:c,rangeMax:l}=n,u=oE(e,t);return(c!==void 0||l!==void 0)&&yo(s,"rangeMin")&&T(u)&&u.length===2?ut([c??u[0],l??u[1]]):Pe(u)}function sE(e){return py(e)?{scheme:e.name,...Te(e,["name"])}:{scheme:e}}function oE(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=de(s[e]),l=t.getScaleComponent(e).get("type"),{domain:u,domainMid:f}=t.specifiedScales[e];switch(e){case oe:case me:{if(G(["point","band"],l)){const g=$p(e,n,i.view);if(bt(g))return{step:Ep(g,t,e)}}const d=Re(e),p=t.getName(d);return e===me&&De(l)?[Fe.fromName(o,p),0]:[0,Fe.fromName(o,p)]}case Zt:case xi:return aE(e,t,l);case zt:{const d=t.component.scales[e].get("zero"),p=Op(r,d,i),g=uE(r,n,t,i);return ci(l)?lE(p,g,cE(l,i,u,e)):[p,g]}case We:return[0,Math.PI*2];case Ln:return[0,360];case nt:return[0,new Fe(()=>{const d=t.getSignalName("width"),p=t.getSignalName("height");return`min(${d},${p})/2`})];case nn:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case rn:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Ie:return"symbol";case ke:case xt:case St:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case Dt:case en:case tn:return[i.scale.minOpacity,i.scale.maxOpacity]}}function Ep(e,t,n){const{encoding:i}=t,r=t.getScaleComponent(n),s=Qo(n),o=i[s];if(ud({step:e,offsetIsDiscrete:j(o)&&pf(o.type)})==="offset"&&qf(i,s)){const c=t.getScaleComponent(s);let u=`domain('${t.scaleName(s)}').length`;if(c.get("type")==="band"){const d=c.get("paddingInner")??c.get("padding")??0,p=c.get("paddingOuter")??c.get("padding")??0;u=`bandspace(${u}, ${d}, ${p})`}const f=r.get("paddingInner")??r.get("padding");return{signal:`${e.step} * ${u} / (1-${Ih(f)})`}}else return e.step}function wp(e,t){if(ud({step:e,offsetIsDiscrete:be(t)})==="offset")return{step:e.step}}function aE(e,t,n){const i=e===Zt?"x":"y",s=t.getScaleComponent(i).get("type"),o=t.scaleName(i);if(s==="band"){const a=$p(i,t.size,t.config.view);if(bt(a)){const c=wp(a,n);if(c)return c}return[0,{signal:`bandwidth('${o}')`}]}else{const a=t.encoding[i];if(E(a)&&a.timeUnit){const c=lf(a.timeUnit,u=>`scale('${o}', ${u})`),l=t.config.scale.bandWithNestedOffsetPaddingInner;if(l){const u=k(l)?`${l.signal}/2`:`${l/2}`,f=k(l)?`(1 - ${l.signal}/2)`:`${1-l/2}`;return[{signal:`${u} * (${c})`},{signal:`${f} * (${c})`}]}return[0,{signal:c}]}return yu(`Cannot use ${e} scale if ${i} scale is not discrete.`)}}function $p(e,t,n){const i=e===oe?"width":"height",r=t[i];return r||Dr(n,i)}function cE(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&T(n)?n.length+1:(S(zm(i)),3)}}function lE(e,t,n){const i=()=>{const r=Ve(t),s=Ve(e),o=`(${r} - ${s}) / (${n} - 1)`;return`sequence(${s}, ${r} + ${o}, ${o})`};return k(t)?new Fe(i):{signal:i()}}function Op(e,t,n){if(t)return k(t)?{signal:`${t.signal} ? 0 : ${Op(e,!1,n)}`}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(is("size",e))}const Cl=.95;function uE(e,t,n,i){const r={x:Ol(n,"x"),y:Ol(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=Nl(t,r,i.view);return ue(s)?s-1:new Fe(()=>`${s.signal} - 1`)}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=Nl(t,r,i.view);return ue(s)?Math.pow(Cl*s,2):new Fe(()=>`pow(${Cl} * ${s.signal}, 2)`)}}throw new Error(is("size",e))}function Nl(e,t,n){const i=bt(e.width)?e.width.step:zr(n,"width"),r=bt(e.height)?e.height.step:zr(n,"height");return t.x||t.y?new Fe(()=>`min(${[t.x?t.x.signal:i,t.y?t.y.signal:r].join(", ")})`):Math.min(i,r)}function Cp(e,t){ce(e)?fE(e,t):_p(e,t)}function fE(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of x(n)){const c=o[a],l=n[a],u=e.getScaleComponent(a),f=de(r[a]),d=c[t],p=u.get("type"),g=u.get("padding"),h=u.get("paddingInner"),m=yo(p,t),y=vf(a,t);if(d!==void 0&&(m?y&&S(y):S(Ju(p,t,a))),m&&y===void 0)if(d!==void 0){const b=f.timeUnit,C=f.type;switch(t){case"domainMax":case"domainMin":Mn(c[t])||C==="temporal"||b?l.set(t,{signal:gs(c[t],{type:C,timeUnit:b})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const b=t in _l?_l[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:p,scalePadding:g,scalePaddingInner:h,domain:c.domain,domainMin:c.domainMin,domainMax:c.domainMax,markDef:s,config:i,hasNestedOffsetScale:vo(r,a),hasSecondaryRangeChannel:!!r[Et(a)]}):i.scale[t];b!==void 0&&l.set(t,b,!1)}}}const _l={bins:({model:e,fieldOrDatumDef:t})=>E(t)?dE(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>pE(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:s})=>gE(e,t,n,i,r,s),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>hE(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:s})=>mE(e,t,n.type,i,r.scale,s),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:s})=>yE(e,t,n,i,r.scale,s),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=E(e)?e.sort:void 0;return bE(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r,config:s,hasSecondaryRangeChannel:o})=>vE(e,t,n,i,r,s.scale,o)};function Np(e){ce(e)?iE(e):_p(e,"range")}function _p(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?Np(i):Cp(i,t);for(const i of x(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=Yt(r,a,t,"scale",wd((c,l)=>{switch(t){case"range":return c.step&&l.step?c.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function dE(e,t){const n=t.bin;if(ne(n)){const i=ec(e,t.field,n);return new Fe(()=>e.getSignalName(i))}else if(xe(n)&&Dn(n)&&n.step!==void 0)return{step:n.step}}function pE(e,t){if(G([ke,xt,St],e)&&t!=="nominal")return"hcl"}function gE(e,t,n,i,r,s){var o;if(!((o=yt(s))!=null&&o.bin||T(n)||r!=null||i!=null||G([Ae.TIME,Ae.UTC],e)))return ye(t)?!0:void 0}function hE(e,t,n,i,r,s){if(ye(e)){if(Ye(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(E(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===Ae.POINT)return n.pointPadding}}function mE(e,t,n,i,r,s=!1){if(e===void 0){if(ye(t)){const{bandPaddingInner:o,barBandPaddingInner:a,rectBandPaddingInner:c,bandWithNestedOffsetPaddingInner:l}=r;return s?l:fe(o,n==="bar"?a:c)}else if(Si(t)&&i===Ae.BAND)return r.offsetBandPaddingInner}}function yE(e,t,n,i,r,s=!1){if(e===void 0){if(ye(t)){const{bandPaddingOuter:o,bandWithNestedOffsetPaddingOuter:a}=r;if(s)return a;if(n===Ae.BAND)return fe(o,k(i)?{signal:`${i.signal}/2`}:i/2)}else if(Si(t)){if(n===Ae.POINT)return .5;if(n===Ae.BAND)return r.offsetBandPaddingOuter}}}function bE(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return De(e)&&t==="descending"?k(i.xReverse)?{signal:`!${i.xReverse.signal}`}:!i.xReverse:i.xReverse;if(De(e)&&t==="descending")return!0}function vE(e,t,n,i,r,s,o){if(!!n&&n!=="unaggregated"&&De(r)){if(T(n)){const c=n[0],l=n[n.length-1];if(c<=0&&l>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!ci(r))return!0;if(!(E(t)&&t.bin)&&G([...wt,...hh],e)){const{orient:c,type:l}=i;return G(["bar","area","line","trail"],l)&&(c==="horizontal"&&e==="y"||c==="vertical"&&e==="x")?!1:G(["bar","area"],l)&&!o?!0:s==null?void 0:s.zero}return!1}function xE(e,t,n,i,r=!1){const s=SE(t,n,i,r),{type:o}=e;return Mt(t)?o!==void 0?xy(t,o)?E(n)&&!vy(o,n.type)?(S(Sm(o,s)),s):o:(S(xm(t,o,s)),s):s:null}function SE(e,t,n,i){var r;switch(t.type){case"nominal":case"ordinal":{if(Qn(e)||Ms(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&S(js(e,"ordinal")),"ordinal";if(ye(e)||Si(e)){if(G(["rect","bar","image","rule"],n.type)||i)return"band"}else if(n.type==="arc"&&e in ta)return"band";const s=n[Re(e)];return An(s)||ui(t)&&((r=t.axis)!=null&&r.tickBand)?"band":"point"}case"temporal":return Qn(e)?"time":Ms(e)==="discrete"?(S(js(e,"temporal")),"ordinal"):E(t)&&t.timeUnit&&he(t.timeUnit).utc?"utc":"time";case"quantitative":return Qn(e)?E(t)&&ne(t.bin)?"bin-ordinal":"linear":Ms(e)==="discrete"?(S(js(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Yu(t.type))}function EE(e,{ignoreRange:t}={}){Tp(e),vp(e);for(const n of by)Cp(e,n);t||Np(e)}function Tp(e){ce(e)?e.component.scales=wE(e):e.component.scales=OE(e)}function wE(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const s of ts){const o=de(t[s]);if(o&&n===Ef&&s===Ie&&o.type===Ei)continue;let a=o&&o.scale;if(Si(s)){const c=Iu(s);if(!vo(t,c)){a&&S(om(s));continue}}if(o&&a!==null&&a!==!1){a??(a={});const c=vo(t,s),l=xE(a,s,o,i,c);r[s]=new Sp(e.scaleName(`${s}`,!0),{value:l,explicit:a.type===l})}}return r}const $E=wd((e,t)=>Lc(e)-Lc(t));function OE(e){var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const s of e.children){Tp(s);for(const o of x(s.component.scales))if((t=r.scale)[o]??(t[o]=op(o,e)),r.scale[o]==="shared"){const a=i[o],c=s.component.scales[o].getWithExplicit("type");a?cy(a.value,c.value)?i[o]=Yt(a,c,"type","scale",$E):(r.scale[o]="independent",delete i[o]):i[o]=c}}for(const s of x(i)){const o=e.scaleName(s,!0),a=i[s];n[s]=new Sp(o,a);for(const c of e.children){const l=c.component.scales[s];l&&(c.renameScale(l.get("name"),o),l.merged=!0)}}return n}class Ys{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function ce(e){return(e==null?void 0:e.type)==="unit"}function Qe(e){return(e==null?void 0:e.type)==="facet"}function sc(e){return(e==null?void 0:e.type)==="concat"}function Ni(e){return(e==null?void 0:e.type)==="layer"}class oc{constructor(t,n,i,r,s,o,a){this.type=n,this.parent=i,this.config=s,this.correctDataNames=c=>{var l,u,f;return(l=c.from)!=null&&l.data&&(c.from.data=this.lookupDataSource(c.from.data)),(f=(u=c.from)==null?void 0:u.facet)!=null&&f.data&&(c.from.facet.data=this.lookupDataSource(c.from.facet.data)),c},this.parent=i,this.config=s,this.view=_e(a),this.name=t.name??r,this.title=Wt(t.title)?{text:t.title}:t.title?_e(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new Ys,this.projectionNameMap=i?i.projectionNameMap:new Ys,this.signalNameMap=i?i.signalNameMap:new Ys,this.data=t.data,this.description=t.description,this.transforms=kv(t.transform??[]),this.layout=n==="layer"||n==="unit"?{}:Lb(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:us(t)||(i==null?void 0:i.component.data.isFaceted)&&t.data===void 0},layoutSize:new Ut,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...o?D(o):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){EE(this)}parseProjection(){mp(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){fp(this)}assembleEncodeFromView(t){const{style:n,...i}=t,r={};for(const s of x(i)){const o=i[s];o!==void 0&&(r[s]=re(o))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=re(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...n??{}}:J(n)?void 0:n}assembleLayout(){if(!this.layout)return;const{spacing:t,...n}=this.layout,{component:i,config:r}=this,s=qx(i.layoutHeaders,r);return{padding:t,...this.assembleDefaultLayout(),...n,...s?{titleBand:s}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of je)t[i].title&&n.push(jx(this,i));for(const i of Ka)n=n.concat(Ux(this,i));return n}assembleAxes(){return Nx(this.component.axes,this.config)}assembleLegends(){return pp(this)}assembleProjections(){return hS(this)}assembleTitle(){const{encoding:t,...n}=this.title??{},i={...ju(this.config.title).nonMarkTitleProperties,...n,...t?{encode:{update:t}}:{}};if(i.text)return G(["unit","layer"],this.type)?G(["middle",void 0],i.anchor)&&(i.frame??(i.frame="group")):i.anchor??(i.anchor="start"),J(i)?void 0:i}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Qe(this.parent)?xp(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return se((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(ee[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Qe(this.parent)){const n=rp(t),i=es(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(be(s)&&on(o)){const a=r.get("name"),c=$s(this,i),l=rc(c);if(l){const u=$({aggregate:"distinct",field:l},{expr:"datum"});return{signal:ip(a,r,u)}}else return S(ra(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(Au(t)&&Mt(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Dh(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)==null?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)==null?void 0:n.some(i=>i.hasOrientSignalRef()))}}class Ap extends oc{vgField(t,n={}){const i=this.fieldDef(t);if(i)return $(i,n)}reduceFieldDef(t,n){return fb(this.getMapping(),(i,r,s)=>{const o=yt(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){ka(this.getMapping(),(i,r)=>{const s=yt(i);s&&t(s,r)},n)}}class Os extends K{clone(){return new Os(null,D(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=D(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"value",i[1]??"density"],n.groupby&&n.minsteps==null&&n.maxsteps==null&&n.steps==null&&(this.transform.steps=200)}dependentFields(){return new Set([this.transform.density,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${W(this.transform)}`}assemble(){const{density:t,...n}=this.transform;return{type:"kde",field:t,...n}}}class Cs extends K{clone(){return new Cs(null,D(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=D(n)}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return`ExtentTransform ${W(this.transform)}`}assemble(){const{extent:t,param:n}=this.transform;return{type:"extent",field:t,signal:n}}}class Xi extends K{clone(){return new Xi(null,{...this.filter})}constructor(t,n){super(t),this.filter=n}static make(t,n){const{config:i,mark:r,markDef:s}=n;if(Y("invalid",s,i)!=="filter")return null;const a=n.reduceFieldDef((c,l,u)=>{const f=Mt(u)&&n.getScaleComponent(u);if(f){const d=f.get("type");De(d)&&l.aggregate!=="count"&&!an(r)&&(c[l.field]=l)}return c},{});return x(a).length?new Xi(t,a):null}dependentFields(){return new Set(x(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${W(this.filter)}`}assemble(){const t=x(this.filter).reduce((n,i)=>{const r=this.filter[i],s=$(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push(`(isDate(${s}) || (isValid(${s}) && isFinite(+${s})))`):r.type==="quantitative"&&(n.push(`isValid(${s})`),n.push(`isFinite(+${s})`))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class Ns extends K{clone(){return new Ns(this.parent,D(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=D(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>r[o]??s)}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${W(this.transform)}`}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class _s extends K{clone(){return new _s(null,D(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=D(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"key",i[1]??"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${W(this.transform)}`}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class ti extends K{clone(){return new ti(null,D(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[rt,it],[Be,st]]){const s=r.map(o=>{const a=de(n.encoding[o]);return E(a)?a.field:$t(a)?{expr:`${a.datum}`}:Ze(a)?{expr:`${a.value}`}:void 0});(s[0]||s[1])&&(t=new ti(t,s,null,n.getName(`geojson_${i++}`)))}if(n.channelHasField(Ie)){const r=n.typedFieldDef(Ie);r.type===Ei&&(t=new ti(t,null,r.field,n.getName(`geojson_${i++}`)))}return t}constructor(t,n,i,r){super(t),this.fields=n,this.geojson=i,this.signal=r}dependentFields(){const t=(this.fields??[]).filter(L);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${W(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class Vi extends K{clone(){return new Vi(null,this.projection,D(this.fields),D(this.as))}constructor(t,n,i,r){super(t),this.projection=n,this.fields=i,this.as=r}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[rt,it],[Be,st]]){const r=i.map(o=>{const a=de(n.encoding[o]);return E(a)?a.field:$t(a)?{expr:`${a.datum}`}:Ze(a)?{expr:`${a.value}`}:void 0}),s=i[0]===Be?"2":"";(r[0]||r[1])&&(t=new Vi(t,n.projectionName(),r,[n.getName(`x${s}`),n.getName(`y${s}`)]))}return t}dependentFields(){return new Set(this.fields.filter(L))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${W(this.fields)} ${W(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class $n extends K{clone(){return new $n(null,D(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set([this.transform.impute,this.transform.key,...this.transform.groupby??[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t;return{signal:`sequence(${[n,i,...r?[r]:[]].join(",")})`}}static makeFromTransform(t,n){return new $n(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(E(r)&&E(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:c,value:l,frame:u,keyvals:f}=o.impute,d=Vf(n.mark,i);return new $n(t,{impute:o.field,key:a.field,...c?{method:c}:{},...l!==void 0?{value:l}:{},...u?{frame:u}:{},...f!==void 0?{keyvals:f}:{},...d.length?{groupby:d}:{}})}return null}hash(){return`Impute ${W(this.transform)}`}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,c={type:"impute",field:t,key:n,...i?{keyvals:pv(i)?this.processSequence(i):i}:{},method:"value",...s?{groupby:s}:{},value:!r||r==="value"?o:null};if(r&&r!=="value"){const l={type:"window",as:[`imputed_${t}_value`],ops:[r],fields:[t],frame:a,ignorePeers:!1,...s?{groupby:s}:{}},u={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[c,l,u]}else return[c]}}class Ts extends K{clone(){return new Ts(null,D(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=D(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.loess]}dependentFields(){return new Set([this.transform.loess,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${W(this.transform)}`}assemble(){const{loess:t,on:n,...i}=this.transform;return{type:"loess",x:n,y:t,...i}}}class Yi extends K{clone(){return new Yi(null,D(this.transform),this.secondary)}constructor(t,n,i){super(t),this.transform=n,this.secondary=i}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(gv(o)){let c=Ip(o.data,s);c||(c=new Rn(o.data),s.push(c));const l=n.getName(`lookup_${r}`);a=new Oe(c,l,ee.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(hv(o)){const c=o.param;i={as:c,...i};let l;try{l=n.getSelectionComponent(se(c),c)}catch{throw new Error(Uh(c))}if(a=l.materialized,!a)throw new Error(Bh(c))}return new Yi(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?le(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${W({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields)t={values:this.transform.from.fields,...this.transform.as?{as:le(this.transform.as)}:{}};else{let n=this.transform.as;L(n)||(S(Kh),n="_lookup"),t={as:[n]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...t,...this.transform.default?{default:this.transform.default}:{}}}}class As extends K{clone(){return new As(null,D(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=D(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??"prob",i[1]??"value"]}dependentFields(){return new Set([this.transform.quantile,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${W(this.transform)}`}assemble(){const{quantile:t,...n}=this.transform;return{type:"quantile",field:t,...n}}}class Fs extends K{clone(){return new Fs(null,D(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=D(n);const i=this.transform.as??[void 0,void 0];this.transform.as=[i[0]??n.on,i[1]??n.regression]}dependentFields(){return new Set([this.transform.regression,this.transform.on,...this.transform.groupby??[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${W(this.transform)}`}assemble(){const{regression:t,on:n,...i}=this.transform;return{type:"regression",x:n,y:t,...i}}}class ks extends K{clone(){return new ks(null,D(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=dt((this.transform.groupby??[]).concat(t),n=>n)}producedFields(){}dependentFields(){return new Set([this.transform.pivot,this.transform.value,...this.transform.groupby??[]])}hash(){return`PivotTransform ${W(this.transform)}`}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return{type:"pivot",field:t,value:n,...r!==void 0?{limit:r}:{},...s!==void 0?{op:s}:{},...i!==void 0?{groupby:i}:{}}}}class Is extends K{clone(){return new Is(null,D(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${W(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function Fp(e){let t=0;function n(i,r){if(i instanceof Rn&&!i.isGenerator&&!di(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof $e&&(i.parent instanceof Rn&&!r.source?(r.format={...r.format??{},parse:i.assembleFormatParse()},r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Oi){r.name||(r.name=`data_${t++}`),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}switch((i instanceof ur||i instanceof fr||i instanceof Xi||i instanceof $i||i instanceof gi||i instanceof Vi||i instanceof Je||i instanceof Yi||i instanceof Ci||i instanceof Wn||i instanceof _s||i instanceof Ns||i instanceof Os||i instanceof Ts||i instanceof As||i instanceof Fs||i instanceof Qt||i instanceof Is||i instanceof ks||i instanceof Cs)&&r.transform.push(i.assemble()),(i instanceof ht||i instanceof gt||i instanceof $n||i instanceof kt||i instanceof ti)&&r.transform.push(...i.assemble()),i instanceof Oe&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof Oe?i.setSource(r.name):(r.name||(r.name=`data_${t++}`),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof Oe&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name=`data_${t++}`);let s=r.name;!r.source||r.transform.length>0?e.push(r):s=r.source;for(const o of i.children)n(o,{name:null,source:s,transform:[]});break}}}return n}function CE(e){const t=[],n=Fp(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function NE(e,t){const n=[],i=Fp(n);let r=0;for(const o of e.sources){o.hasName()||(o.dataName=`source_${r++}`);const a=o.assemble();i(o,a)}for(const o of n)o.transform.length===0&&delete o.transform;let s=0;for(const[o,a]of n.entries())(a.transform??[]).length===0&&!a.source&&n.splice(s++,0,n.splice(o,1)[0]);for(const o of n)for(const a of o.transform??[])a.type==="lookup"&&(a.from=e.outputNodes[a.from].getSource());for(const o of n)o.name in t&&(o.values=t[o.name]);return n}function _E(e){return e==="top"||e==="left"||k(e)?"header":"footer"}function TE(e){for(const t of je)AE(e,t);Tl(e,"x"),Tl(e,"y")}function AE(e,t){var o;const{facet:n,config:i,child:r,component:s}=e;if(e.channelHasField(t)){const a=n[t],c=mi("title",null,i,t);let l=Zn(a,i,{allowDisabling:!0,includeDefault:c===void 0||!!c});r.component.layoutHeaders[t].title&&(l=T(l)?l.join(", "):l,l+=` / ${r.component.layoutHeaders[t].title}`,r.component.layoutHeaders[t].title=null);const u=mi("labelOrient",a.header,i,t),f=a.header!==null?fe((o=a.header)==null?void 0:o.labels,i.header.labels,!0):!1,d=G(["bottom","right"],u)?"footer":"header";s.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[kp(e,t,f)]}}}function kp(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function Tl(e,t){const{child:n}=e;if(n.component.axes[t]){const{layoutHeaders:i,resolve:r}=e.component;if(r.axis[t]=Za(r,t),r.axis[t]==="shared"){const s=t==="x"?"column":"row",o=i[s];for(const a of n.component.axes[t]){const c=_E(a.get("orient"));o[c]??(o[c]=[kp(e,s,!1)]);const l=Li(a,"main",e.config,{header:!0});l&&o[c][0].axes.push(l),a.mainExtracted=!0}}}}function FE(e){ac(e),Br(e,"width"),Br(e,"height")}function kE(e){ac(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Br(e,t),Br(e,n)}function ac(e){for(const t of e.children)t.parseLayoutSize()}function Br(e,t){const n=rp(t),i=es(n),r=e.component.resolve,s=e.component.layoutSize;let o;for(const a of e.children){const c=a.component.layoutSize.getWithExplicit(n),l=r.scale[i]??op(i,e);if(l==="independent"&&c.value==="step"){o=void 0;break}if(o){if(l==="independent"&&o.value!==c.value){o=void 0;break}o=Yt(o,c,n,"")}else o=c}if(o){for(const a of e.children)e.renameSignal(a.getName(n),e.getName(t)),a.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,o)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function IE(e){const{size:t,component:n}=e;for(const i of wt){const r=Re(i);if(t[r]){const s=t[r];n.layoutSize.set(r,bt(s)?"step":s,!0)}else{const s=RE(e,r);n.layoutSize.set(r,s,!1)}}}function RE(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(be(s)){const a=Dr(i.view,t);return on(o)||bt(a)?"step":a}else return So(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return So(i.view,t);{const s=Dr(i.view,t);return bt(s)?s.step:s}}}function Po(e,t,n){return $(t,{suffix:`by_${$(e)}`,...n??{}})}class Ui extends Ap{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve),this.child=dc(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!sr(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=x(t),i={};for(const r of n){if(![Tt,At].includes(r)){S(is(r,"facet"));break}const s=t[r];if(s.field===void 0){S(ho(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=Aa(t,n);return i.header?i.header=_e(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Rs(this),this.child.parseData()}parseLayoutSize(){ac(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),TE(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){const t={};for(const n of je)for(const i of Ja){const r=this.component.layoutHeaders[n],s=r[i],{facetFieldDef:o}=r;if(o){const a=mi("titleOrient",o.header,this.config,n);if(["right","bottom"].includes(a)){const c=Es(n,a);t.titleAnchor??(t.titleAnchor={}),t.titleAnchor[c]="end"}}if(s!=null&&s[0]){const a=n==="row"?"height":"width",c=i==="header"?"headerBand":"footerBand";n!=="facet"&&!this.child.component.layoutSize.get(a)&&(t[c]??(t[c]={}),t[c][n]=.5),r.title&&(t.offset??(t.offset={}),t.offset[n==="row"?"rowTitle":"columnTitle"]=10)}}return t}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),{...this.getHeaderLayoutMixins(),...i?{columns:i}:{},bounds:"full",align:r}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Ui))return{signal:`length(data('${this.getName("column_domain")}'))`}}assembleGroupStyle(){}assembleGroup(t){return this.parent&&this.parent instanceof Ui?{...this.channelHasField("column")?{encode:{update:{columns:{field:$(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(t)}:super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof Ui){if(this.child.channelHasField("column")){const r=$(this.child.facet.column);t.push(r),n.push("distinct"),i.push(`distinct_${r}`)}}else for(const r of wt){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(be(o)&&on(a)){const c=$s(this.child,r),l=rc(c);l?(t.push(l),n.push("distinct"),i.push(`distinct_${l}`)):S(ra(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),c=[];for(const u of je){const f=this.facet[u];if(f){c.push($(f));const{bin:d,sort:p}=f;if(ne(d)&&c.push($(f,{binSuffix:"end"})),pt(p)){const{field:g,op:h=ls}=p,m=Po(f,p);i&&r?(s.push(m),o.push("max"),a.push(m)):(s.push(g),o.push(h),a.push(m))}else if(T(p)){const g=hi(f,u);s.push(g),o.push("max"),a.push(g)}}}const l=!!i&&!!r;return{name:t,data:n,groupby:c,...l||s.length>0?{aggregate:{...l?{cross:l}:{},...s.length?{fields:s,ops:o,as:a}:{}}}:{}}}facetSortFields(t){const{facet:n}=this,i=n[t];return i?pt(i.sort)?[Po(i,i.sort,{expr:"datum"})]:T(i.sort)?[hi(i,t,{expr:"datum"})]:[$(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(pt(r)?r.order:!T(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){var r;const{facet:t,config:n}=this;if(t.facet)return To(t.facet,"facet",n);const i={row:["top","bottom"],column:["left","right"]};for(const s of Ka)if(t[s]){const o=mi("labelOrient",(r=t[s])==null?void 0:r.header,n,s);if(i[s].includes(o))return To(t[s],s,n)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=CE(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...s?{title:s}:{},...o?{style:o}:{},from:{facet:this.assembleFacet()},sort:{field:je.map(c=>this.facetSortFields(c)).flat(),order:je.map(c=>this.facetSortOrder(c)).flat()},...i.length>0?{data:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup(Hv(this,[]))}]}getMapping(){return this.facet}}function PE(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(pt(s.sort)){const{field:o,op:a=ls}=s.sort;e=r=new Wn(e,{joinaggregate:[{op:a,field:o,as:Po(s,s.sort,{forAs:!0})}],groupby:[$(s)]})}return r}return null}function Ip(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const c=(n=e.format)==null?void 0:n.mesh,l=(i=a.format)==null?void 0:i.feature;if(c&&l)continue;const u=(r=e.format)==null?void 0:r.feature;if((u||l)&&u!==l)continue;const f=(s=a.format)==null?void 0:s.mesh;if(!((c||f)&&c!==f)){if(qi(e)&&qi(a)){if(ft(e.values,a.values))return o}else if(di(e)&&di(a)){if(e.url===a.url)return o}else if($d(e)&&e.name===o.dataName)return o}}return null}function LE(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Rn({values:[]});return t.push(i),i}const n=Ip(e.data,t);if(n)return Ht(e.data)||(n.data.format=bu({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Rn(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function zE(e,t,n){let i=0;for(const r of t.transforms){let s,o;if(Ov(r))o=e=new gi(e,r),s="derived";else if(Wa(r)){const a=_S(r);o=e=$e.makeWithAncestors(e,{},a,n)??e,e=new $i(e,t,r.filter)}else if(vd(r))o=e=ht.makeFromTransform(e,r,t),s="number";else if(Nv(r))s="date",n.getWithExplicit(r.field).value===void 0&&(e=new $e(e,{[r.field]:s}),n.set(r.field,s,!1)),o=e=gt.makeFromTransform(e,r);else if(_v(r))o=e=Je.makeFromTransform(e,r),s="number",Ya(t)&&(e=new Qt(e));else if(bd(r))o=e=Yi.make(e,t,r,i++),s="derived";else if(Ev(r))o=e=new Ci(e,r),s="number";else if(wv(r))o=e=new Wn(e,r),s="number";else if(Tv(r))o=e=kt.makeFromTransform(e,r),s="derived";else if(Av(r))o=e=new _s(e,r),s="derived";else if(Fv(r))o=e=new Cs(e,r),s="derived";else if($v(r))o=e=new Ns(e,r),s="derived";else if(mv(r))o=e=new ks(e,r),s="derived";else if(Sv(r))e=new Is(e,r);else if(Cv(r))o=e=$n.makeFromTransform(e,r),s="derived";else if(yv(r))o=e=new Os(e,r),s="derived";else if(bv(r))o=e=new As(e,r),s="derived";else if(vv(r))o=e=new Fs(e,r),s="derived";else if(xv(r))o=e=new Ts(e,r),s="derived";else{S(Yh(r));continue}if(o&&s!==void 0)for(const a of o.producedFields()??[])n.set(a,s,!1)}return e}function Rs(e){var h;let t=LE(e,e.component.data.sources);const{outputNodes:n,outputNodeRefCounts:i}=e.component.data,r=e.data,o=!(r&&(Ht(r)||di(r)||qi(r)))&&e.parent?e.parent.component.data.ancestorParse.clone():new Wv;Ht(r)?(Od(r)?t=new fr(t,r.sequence):Ga(r)&&(t=new ur(t,r.graticule)),o.parseNothing=!0):((h=r==null?void 0:r.format)==null?void 0:h.parse)===null&&(o.parseNothing=!0),t=$e.makeExplicit(t,e,o)??t,t=new Qt(t);const a=e.parent&&Ni(e.parent);(ce(e)||Qe(e))&&a&&(t=ht.makeFromEncoding(t,e)??t),e.transforms.length>0&&(t=zE(t,e,o));const c=AS(e),l=TS(e);t=$e.makeWithAncestors(t,{},{...c,...l},o)??t,ce(e)&&(t=ti.parseAll(t,e),t=Vi.parseAll(t,e)),(ce(e)||Qe(e))&&(a||(t=ht.makeFromEncoding(t,e)??t),t=gt.makeFromEncoding(t,e)??t,t=gi.parseAllForSortIndex(t,e));const u=e.getDataName(ee.Raw),f=new Oe(t,u,ee.Raw,i);if(n[u]=f,t=f,ce(e)){const m=Je.makeFromEncoding(t,e);m&&(t=m,Ya(e)&&(t=new Qt(t))),t=$n.makeFromEncoding(t,e)??t,t=kt.makeFromEncoding(t,e)??t}ce(e)&&(t=Xi.make(t,e)??t);const d=e.getDataName(ee.Main),p=new Oe(t,d,ee.Main,i);n[d]=p,t=p,ce(e)&&Ox(e,p);let g=null;if(Qe(e)){const m=e.getName("facet");t=PE(t,e.facet)??t,g=new Oi(t,e,m,p.getSource()),n[m]=g}return{...e.component.data,outputNodes:n,outputNodeRefCounts:i,raw:f,main:p,facetRoot:g,ancestorParse:o}}class DE extends oc{constructor(t,n,i,r){var s,o,a,c;super(t,"concat",n,i,r,t.resolve),(((o=(s=t.resolve)==null?void 0:s.axis)==null?void 0:o.x)==="shared"||((c=(a=t.resolve)==null?void 0:a.axis)==null?void 0:c.y)==="shared")&&S(qh),this.children=this.getChildren(t).map((l,u)=>dc(l,this,this.getName(`concat_${u}`),void 0,r))}parseData(){this.component.data=Rs(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of x(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return ys(t)?t.vconcat:Ua(t)?t.hconcat:t.concat}parseLayoutSize(){kE(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=Qa(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return{type:"group",name:t.getName("group"),...n?{title:n}:{},...i?{style:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){const t=this.layout.columns;return{...t!=null?{columns:t}:{},bounds:"full",align:"each"}}}function ME(e){return e===!1||e===null}const jE={disable:1,gridScale:1,scale:1,...Gf,labelExpr:1,encode:1},Rp=x(jE);class cc extends Ut{constructor(t={},n={},i=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new cc(D(this.explicit),D(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!ME(this.get(t))}hasOrientSignalRef(){return k(this.explicit.orient)}}function UE(e,t,n){const{encoding:i,config:r}=e,s=de(i[t])??de(i[Et(t)]),o=e.axis(t)||{},{format:a,formatType:c}=o;if(Fn(c))return{text:Ke({fieldOrDatumDef:s,field:"datum.value",format:a,formatType:c,config:r}),...n};if(a===void 0&&c===void 0&&r.customFormatTypes){if(li(s)==="quantitative"){if(ui(s)&&s.stack==="normalize"&&r.normalizedNumberFormatType)return{text:Ke({fieldOrDatumDef:s,field:"datum.value",format:r.normalizedNumberFormat,formatType:r.normalizedNumberFormatType,config:r}),...n};if(r.numberFormatType)return{text:Ke({fieldOrDatumDef:s,field:"datum.value",format:r.numberFormat,formatType:r.numberFormatType,config:r}),...n}}if(li(s)==="temporal"&&r.timeFormatType&&E(s)&&!s.timeUnit)return{text:Ke({fieldOrDatumDef:s,field:"datum.value",format:r.timeFormat,formatType:r.timeFormatType,config:r}),...n}}return n}function BE(e){return wt.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[YE(n,e)]),t),{})}const WE={bottom:"top",top:"bottom",left:"right",right:"left"};function GE(e){const{axes:t,resolve:n}=e.component,i={top:0,bottom:0,right:0,left:0};for(const r of e.children){r.parseAxesAndHeaders();for(const s of x(r.component.axes))n.axis[s]=Za(e.component.resolve,s),n.axis[s]==="shared"&&(t[s]=HE(t[s],r.component.axes[s]),t[s]||(n.axis[s]="independent",delete t[s]))}for(const r of wt){for(const s of e.children)if(s.component.axes[r]){if(n.axis[r]==="independent"){t[r]=(t[r]??[]).concat(s.component.axes[r]);for(const o of s.component.axes[r]){const{value:a,explicit:c}=o.getWithExplicit("orient");if(!k(a)){if(i[a]>0&&!c){const l=WE[a];i[a]>i[l]&&o.set("orient",l,!1)}i[a]++}}}delete s.component.axes[r]}if(n.axis[r]==="independent"&&t[r]&&t[r].length>1)for(const[s,o]of(t[r]||[]).entries())s>0&&o.get("grid")&&!o.explicit.grid&&(o.implicit.grid=!1)}}function HE(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!=!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=qE(r,s)}}}else return t.map(n=>n.clone());return e}function qE(e,t){for(const n of Rp){const i=Yt(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return Xu(r,s);case"gridScale":return{explicit:r.explicit,value:fe(r.value,s.value)}}return vs(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function XE(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(k(n.labelAngle)?n.labelAngle:Hi(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===Zd(i,r))return!0}return e===n[t]}const VE=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function YE(e,t){var y,b;let n=t.axis(e);const i=new cc,r=de(t.encoding[e]),{mark:s,config:o}=t,a=(n==null?void 0:n.orient)||((y=o[e==="x"?"axisX":"axisY"])==null?void 0:y.orient)||((b=o.axis)==null?void 0:b.orient)||Px(e),c=t.getScaleComponent(e).get("type"),l=_x(e,c,a,t.config),u=n!==void 0?!n:No("disable",o.style,n==null?void 0:n.style,l).configValue;if(i.set("disable",u,n!==void 0),u)return i;n=n||{};const f=kx(r,n,e,o.style,l),d=_f(n.formatType,r,c),p=Nf(r,r.type,n.format,n.formatType,o,!0),g={fieldOrDatumDef:r,axis:n,channel:e,model:t,scaleType:c,orient:a,labelAngle:f,format:p,formatType:d,mark:s,config:o};for(const C of Rp){const I=C in gl?gl[C](g):Wc(C)?n[C]:void 0,v=I!==void 0,_=XE(I,C,n,t,e);if(v&&_)i.set(C,I,_);else{const{configValue:O=void 0,configFrom:M=void 0}=Wc(C)&&C!=="values"?No(C,o.style,n.style,l):{},V=O!==void 0;v&&!V?i.set(C,I,_):(M!=="vgAxisConfig"||VE.has(C)&&V||cr(O)||k(O))&&i.set(C,O,!1)}}const h=n.encoding??{},m=Wf.reduce((C,I)=>{if(!i.hasAxisPart(I))return C;const v=sp(h[I]??{},t),_=I==="labels"?UE(t,e,v):v;return _!==void 0&&!J(_)&&(C[I]={update:_}),C},{});return J(m)||i.set("encode",m,!!n.encoding||n.labelAngle!==void 0),i}function KE({encoding:e,size:t}){for(const n of wt){const i=Re(n);bt(t[i])&&Gt(e[n])&&(delete t[i],S(Qu(i)))}return t}const JE={vgMark:"arc",encodeEntry:e=>({...Ge(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...Kt(e,"radius"),...Kt(e,"theta")})},QE={vgMark:"area",encodeEntry:e=>({...Ge(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...Mr("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"}),...Mr("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"}),...Va(e)})},ZE={vgMark:"rect",encodeEntry:e=>({...Ge(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Kt(e,"x"),...Kt(e,"y")})},ew={vgMark:"shape",encodeEntry:e=>({...Ge(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[{type:"geoshape",projection:e.projectionName(),...n&&E(n)&&n.type===Ei?{field:$(n,{expr:"datum"})}:{}}]}},tw={vgMark:"image",encodeEntry:e=>({...Ge(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...Kt(e,"x"),...Kt(e,"y"),...qa(e,"url")})},nw={vgMark:"line",encodeEntry:e=>({...Ge(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...ge("size",e,{vgChannel:"strokeWidth"}),...Va(e)})},iw={vgMark:"trail",encodeEntry:e=>({...Ge(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...ge("size",e),...Va(e)})};function lc(e,t){const{config:n}=e;return{...Ge(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...ge("size",e),...ge("angle",e),...rw(e,n,t)}}function rw(e,t,n){return n?{shape:{value:n}}:ge("shape",e)}const sw={vgMark:"symbol",encodeEntry:e=>lc(e)},ow={vgMark:"symbol",encodeEntry:e=>lc(e,"circle")},aw={vgMark:"symbol",encodeEntry:e=>lc(e,"square")},cw={vgMark:"rect",encodeEntry:e=>({...Ge(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Kt(e,"x"),...Kt(e,"y")})},lw={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:{...Ge(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Mr("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"}),...Mr("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"}),...ge("size",e,{vgChannel:"strokeWidth"})}}},uw={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return{...Ge(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...qa(e),...ge("size",e,{vgChannel:"fontSize"}),...ge("angle",e),...ul("align",fw(e.markDef,n,t)),...ul("baseline",dw(e.markDef,n,t)),...we("radius",e,{defaultPos:null}),...we("theta",e,{defaultPos:null})}}};function fw(e,t,n){if(Y("align",e,n)===void 0)return"center"}function dw(e,t,n){if(Y("baseline",e,n)===void 0)return"middle"}const pw={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return{...Ge(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid",vgChannel:"xc"}),...we("y",e,{defaultPos:"mid",vgChannel:"yc"}),...ge("size",e,{defaultValue:gw(e),vgChannel:r}),[s]:re(Y("thickness",n,t))}}};function gw(e){const{config:t,markDef:n}=e,{orient:i}=n,r=i==="horizontal"?"width":"height",s=e.getScaleComponent(i==="horizontal"?"x":"y"),o=Y("size",n,t,{vgChannel:r})??t.tick.bandSize;if(o!==void 0)return o;{const a=s?s.get("range"):void 0;return a&&on(a)&&ue(a.step)?a.step*3/4:zr(t.view,r)*3/4}}const yr={arc:JE,area:QE,bar:ZE,circle:ow,geoshape:ew,image:tw,line:nw,point:sw,rect:cw,rule:lw,square:aw,text:uw,tick:pw,trail:iw};function hw(e){if(G([as,ss,wy],e.mark)){const t=Vf(e.mark,e.encoding);if(t.length>0)return mw(e,t)}else if(e.mark===os){const t=go.some(n=>Y(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return yw(e)}return uc(e)}const Al="faceted_path_";function mw(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:Al+e.requestDataName(ee.Main),data:e.requestDataName(ee.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:uc(e,{fromPrefix:Al})}]}const Fl="stack_group_";function yw(e){var l;const[t]=uc(e,{fromPrefix:Fl}),n=e.scaleName(e.stack.fieldChannel),i=(u={})=>e.vgField(e.stack.fieldChannel,u),r=(u,f)=>{const d=[i({prefix:"min",suffix:"start",expr:f}),i({prefix:"max",suffix:"start",expr:f}),i({prefix:"min",suffix:"end",expr:f}),i({prefix:"max",suffix:"end",expr:f})];return`${u}(${d.map(p=>`scale('${n}',${p})`).join(",")})`};let s,o;e.stack.fieldChannel==="x"?(s={...ii(t.encode.update,["y","yc","y2","height",...go]),x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}},o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update={...Te(t.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(s={...ii(t.encode.update,["x","xc","x2","width"]),y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}},o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update={...Te(t.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const u of go){const f=Rt(u,e.markDef,e.config);t.encode.update[u]?(s[u]=t.encode.update[u],delete t.encode.update[u]):f&&(s[u]=re(f)),f&&(t.encode.update[u]={value:0})}const a=[];if(((l=e.stack.groupbyChannels)==null?void 0:l.length)>0)for(const u of e.stack.groupbyChannels){const f=e.fieldDef(u),d=$(f);d&&a.push(d),(f!=null&&f.bin||f!=null&&f.timeUnit)&&a.push($(f,{binSuffix:"end"}))}return s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((u,f)=>{if(t.encode.update[f])return{...u,[f]:t.encode.update[f]};{const d=Rt(f,e.markDef,e.config);return d!==void 0?{...u,[f]:re(d)}:u}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(ee.Main),name:Fl+e.requestDataName(ee.Main),groupby:a,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function bw(e){var a;const{encoding:t,stack:n,mark:i,markDef:r,config:s}=e,o=t.order;if(!(!T(o)&&Ze(o)&&fo(o.value)||!o&&fo(Y("order",r,s)))){if((T(o)||E(o))&&!n)return Gu(o,{expr:"datum"});if(an(i)){const c=r.orient==="horizontal"?"y":"x",l=t[c];if(E(l)){const u=l.sort;if(T(u))return{field:$(l,{prefix:c,suffix:"sort_index",expr:"datum"})};if(pt(u))return{field:$({aggregate:Fa(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(Af(u)){const f=e.fieldDef(u.encoding);return{field:$(f,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:$(l,{binSuffix:(a=e.stack)!=null&&a.impute?"mid":void 0,expr:"datum"})}}return}}}function uc(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=fe(i.clip,vw(e),xw(e)),a=Bu(i),c=r.key,l=bw(e),u=Sw(e),f=Y("aria",i,s),d=yr[n].postEncodingTransform?yr[n].postEncodingTransform(e):null;return[{name:e.getName("marks"),type:yr[n].vgMark,...o?{clip:!0}:{},...a?{style:a}:{},...c?{key:c.field}:{},...l?{sort:l}:{},...u||{},...f===!1?{aria:f}:{},from:{data:t.fromPrefix+e.requestDataName(ee.Main)},encode:{update:yr[n].encodeEntry(e)},...d?{transform:d}:{}}]}function vw(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t!=null&&t.get("selectionExtent")||n!=null&&n.get("selectionExtent")?!0:void 0}function xw(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function Sw(e){if(!e.component.selection)return null;const t=x(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=x(i.component.selection).length,i=i.parent;return n?{interactive:t>0||e.mark==="geoshape"||!!e.encoding.tooltip}:null}class Pp extends Ap{constructor(t,n,i,r={},s){super(t,"unit",n,i,s,void 0,Hc(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const o=mt(t.mark)?{...t.mark}:{type:t.mark},a=o.type;o.filled===void 0&&(o.filled=sv(o,s,{graticule:t.data&&Ga(t.data)}));const c=this.encoding=lb(t.encoding||{},a,o.filled,s);this.markDef=hd(o,c,s),this.size=KE({encoding:c,size:Hc(t)?{...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}}:r}),this.stack=gd(this.markDef,c),this.specifiedScales=this.initScales(a,c),this.specifiedAxes=this.initAxes(c),this.specifiedLegends=this.initLegends(c),this.specifiedProjection=t.projection,this.selection=(t.params??[]).filter(l=>Ma(l))}get hasProjection(){const{encoding:t}=this,n=this.mark===Ef,i=t&&ah.some(r=>j(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return ts.reduce((i,r)=>{const s=de(n[r]);return s&&(i[r]=this.initScale(s.scale??{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=_e(t);return T(n)&&(r.domain=n.map(Le)),T(i)&&(r.range=i.map(Le)),r}initAxes(t){return wt.reduce((n,i)=>{const r=t[i];if(j(r)||i===oe&&j(t.x2)||i===me&&j(t.y2)){const s=j(r)?r.axis:void 0;n[i]=s&&this.initAxis({...s})}return n},{})}initAxis(t){const n=x(t),i={};for(const r of n){const s=t[r];i[r]=cr(s)?Uu(s):Le(s)}return i}initLegends(t){return mh.reduce((n,i)=>{const r=de(t[i]);if(r&&bh(i)){const s=r.legend;n[i]=s&&_e(s)}return n},{})}parseData(){this.component.data=Rs(this)}parseLayoutSize(){IE(this)}parseSelections(){this.component.selection=$x(this,this.selection)}parseMarkGroup(){this.component.mark=hw(this)}parseAxesAndHeaders(){this.component.axes=BE(this)}assembleSelectionTopLevelSignals(t){return qv(this,t)}assembleSignals(){return[...Kd(this),...Gv(this,[])]}assembleSelectionData(t){return Xv(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return Qa(this)}assembleMarks(){let t=this.component.mark??[];return(!this.parent||!Ni(this.parent))&&(t=_d(this,t)),t.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return En(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return yt(n)}typedFieldDef(t){const n=this.fieldDef(t);return Ce(n)?n:null}}class fc extends oc{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o={...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}};this.children=t.layer.map((a,c)=>{if(bs(a))return new fc(a,this,this.getName(`layer_${c}`),o,s);if(jt(a))return new Pp(a,this,this.getName(`layer_${c}`),o,s);throw new Error(ia(a))})}parseData(){this.component.data=Rs(this);for(const t of this.children)t.parseData()}parseLayoutSize(){FE(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of x(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){GE(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),Kd(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),Qa(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of le(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return Vv(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),pp(this))}}function dc(e,t,n,i,r){if(us(e))return new Ui(e,t,n,r);if(bs(e))return new fc(e,t,n,i,r);if(jt(e))return new Pp(e,t,n,i,r);if(Ib(e))return new DE(e,t,n,r);throw new Error(ia(e))}function Ew(e,t={}){t.logger&&Dm(t.logger),t.fieldTitle&&jf(t.fieldTitle);try{const n=pd(qr(t.config,e.config)),i=Ed(e,n),r=dc(i,null,"",void 0,n);return r.parse(),qS(r.component.data,r),{spec:$w(r,ww(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&Mm(),t.fieldTitle&&eb()}}function ww(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):L(t)&&(t={type:t}),r&&s&&jv(t.type)){if(r==="step"&&s==="step")S(Tc()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";S(Tc(es(o)));const a=o==="width"?"height":"width";t.type=Uv(a)}}return{...x(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t},...il(n,!1),...il(e,!0)}}function $w(e,t,n={},i){const r=e.config?Xb(e.config):void 0,s=[].concat(e.assembleSelectionData([]),NE(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter(p=>(p.name==="width"||p.name==="height")&&p.value!==void 0?(t[p.name]=+p.value,!1):!0);const{params:f,...d}=t;return{$schema:"https://vega.github.io/schema/vega/v5.json",...e.description?{description:e.description}:{},...d,...a?{title:a}:{},...c?{style:c}:{},...l?{encode:{update:l}}:{},data:s,...o.length>0?{projections:o}:{},...e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...ld(f)]),...r?{config:r}:{},...i?{usermeta:i}:{}}}const Ow=Kg.version,Cw=Object.freeze(Object.defineProperty({__proto__:null,accessPathDepth:ri,accessPathWithDatum:Xo,compile:Ew,contains:G,deepEqual:ft,deleteNestedProperty:Nr,duplicate:D,entries:Xt,every:Go,fieldIntersection:qo,flatAccessWithDatum:xu,getFirstDefined:fe,hasIntersection:Ho,hash:W,internalField:wu,isBoolean:Gi,isEmpty:J,isEqual:ih,isInternalField:$u,isNullOrFalse:fo,isNumeric:Vr,keys:x,logicalExpr:Mi,mergeDeep:bu,never:yu,normalize:Ed,normalizeAngle:Hi,omit:Te,pick:ii,prefixGenerator:po,removePathFromField:Vo,replaceAll:Cn,replacePathInField:Ue,resetIdCounter:sh,setEqual:vu,some:On,stringify:te,titleCase:Zi,unique:dt,uniqueId:Eu,vals:Se,varName:se,version:Ow},Symbol.toStringTag,{value:"Module"}));function Lp(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var Nw="vega-themes",_w="2.14.0",Tw="Themes for stylized Vega and Vega-Lite visualizations.",Aw=["vega","vega-lite","themes","style"],Fw="BSD-3-Clause",kw={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},Iw=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],Rw="build/vega-themes.js",Pw="build/vega-themes.module.js",Lw="build/vega-themes.min.js",zw="build/vega-themes.min.js",Dw="build/vega-themes.module.d.ts",Mw={type:"git",url:"https://github.com/vega/vega-themes.git"},jw=["src","build"],Uw={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},Bw={"@babel/core":"^7.22.9","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.9","@babel/preset-env":"^7.22.9","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@typescript-eslint/eslint-plugin":"^6.0.0","@typescript-eslint/parser":"^6.0.0","browser-sync":"^2.29.3",concurrently:"^8.2.0",eslint:"^8.45.0","eslint-config-prettier":"^8.8.0","eslint-plugin-prettier":"^5.0.0","gh-pages":"^5.0.0",prettier:"^3.0.0","release-it":"^16.1.0",rollup:"^3.26.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",typescript:"^5.1.6",vega:"^5.25.0","vega-lite":"^5.9.3"},Ww={vega:"*","vega-lite":"*"},Gw={},Hw={name:Nw,version:_w,description:Tw,keywords:Aw,license:Fw,author:kw,contributors:Iw,main:Rw,module:Pw,unpkg:Lw,jsdelivr:zw,types:Dw,repository:Mw,files:jw,scripts:Uw,devDependencies:Bw,peerDependencies:Ww,dependencies:Gw};const qn="#fff",kl="#888",qw={background:"#333",view:{stroke:kl},title:{color:qn,subtitleColor:qn},style:{"guide-label":{fill:qn},"guide-title":{fill:qn}},axis:{domainColor:qn,gridColor:kl,tickColor:qn}},un="#4572a7",Xw={background:"#fff",arc:{fill:un},area:{fill:un},line:{stroke:un,strokeWidth:2},path:{stroke:un},rect:{fill:un},shape:{stroke:un},symbol:{fill:un,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},fn="#30a2da",Ks="#cbcbcb",Vw="#999",Yw="#333",Il="#f0f0f0",Rl="#333",Kw={arc:{fill:fn},area:{fill:fn},axis:{domainColor:Ks,grid:!0,gridColor:Ks,gridWidth:1,labelColor:Vw,labelFontSize:10,titleColor:Yw,tickColor:Ks,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:Il,group:{fill:Il},legend:{labelColor:Rl,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:Rl,titleFontSize:14,titlePadding:10},line:{stroke:fn,strokeWidth:2},path:{stroke:fn,strokeWidth:.5},rect:{fill:fn},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:fn},bar:{binSpacing:2,fill:fn,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},dn="#000",Jw={group:{fill:"#e5e5e5"},arc:{fill:dn},area:{fill:dn},line:{stroke:dn},path:{stroke:dn},rect:{fill:dn},shape:{stroke:dn},symbol:{fill:dn,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},Qw=22,Zw="normal",Pl="Benton Gothic, sans-serif",Ll=11.5,e$="normal",pn="#82c6df",Js="Benton Gothic Bold, sans-serif",zl="normal",Dl=13,Fi={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},t$={background:"#ffffff",title:{anchor:"start",color:"#000000",font:Js,fontSize:Qw,fontWeight:Zw},arc:{fill:pn},area:{fill:pn},line:{stroke:pn,strokeWidth:2},path:{stroke:pn},rect:{fill:pn},shape:{stroke:pn},symbol:{fill:pn,size:30},axis:{labelFont:Pl,labelFontSize:Ll,labelFontWeight:e$,titleFont:Js,titleFontSize:Dl,titleFontWeight:zl},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:Pl,labelFontSize:Ll,symbolType:"square",titleFont:Js,titleFontSize:Dl,titleFontWeight:zl},range:{category:Fi["category-6"],diverging:Fi["fireandice-6"],heatmap:Fi["fire-7"],ordinal:Fi["fire-7"],ramp:Fi["fire-7"]}},gn="#ab5787",br="#979797",n$={background:"#f9f9f9",arc:{fill:gn},area:{fill:gn},line:{stroke:gn},path:{stroke:gn},rect:{fill:gn},shape:{stroke:gn},symbol:{fill:gn,size:30},axis:{domainColor:br,domainWidth:.5,gridWidth:.2,labelColor:br,tickColor:br,tickWidth:.2,titleColor:br},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},hn="#3e5c69",i$={background:"#fff",arc:{fill:hn},area:{fill:hn},line:{stroke:hn},path:{stroke:hn},rect:{fill:hn},shape:{stroke:hn},symbol:{fill:hn},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Me="#1696d2",Ml="#000000",r$="#FFFFFF",vr="Lato",Qs="Lato",s$="Lato",o$="#DEDDDD",a$=18,ki={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},c$={background:r$,title:{anchor:"start",fontSize:a$,font:vr},axisX:{domain:!0,domainColor:Ml,domainWidth:1,grid:!1,labelFontSize:12,labelFont:Qs,labelAngle:0,tickColor:Ml,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:vr},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:o$,gridWidth:1,labelFontSize:12,labelFont:Qs,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:vr,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:Qs,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:vr,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:ki["six-groups-cat-1"],diverging:ki["diverging-colors"],heatmap:ki["diverging-colors"],ordinal:ki["six-groups-seq"],ramp:ki["shades-blue"]},area:{fill:Me},rect:{fill:Me},line:{color:Me,stroke:Me,strokeWidth:5},trail:{color:Me,stroke:Me,strokeWidth:0,size:1},path:{stroke:Me,strokeWidth:.5},point:{filled:!0},text:{font:s$,color:Me,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Me,stroke:null}},arc:{fill:Me},shape:{stroke:Me},symbol:{fill:Me,size:30}},mn="#3366CC",jl="#ccc",xr="Arial, sans-serif",l$={arc:{fill:mn},area:{fill:mn},path:{stroke:mn},rect:{fill:mn},shape:{stroke:mn},symbol:{stroke:mn},circle:{fill:mn},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:xr,fontSize:12},"guide-title":{font:xr,fontSize:12},"group-title":{font:xr,fontSize:12}},title:{font:xr,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:jl,tickColor:jl,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},pc=e=>e*(1/3+1),Ul=pc(9),Bl=pc(10),Wl=pc(12),Ii="Segoe UI",Gl="wf_standard-font, helvetica, arial, sans-serif",Hl="#252423",Ri="#605E5C",ql="transparent",u$="#C8C6C4",qe="#118DFF",f$="#12239E",d$="#E66C37",p$="#6B007B",g$="#E044A7",h$="#744EC2",m$="#D9B300",y$="#D64550",zp=qe,Dp="#DEEFFF",Xl=[Dp,zp],b$=[Dp,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",zp],v$={view:{stroke:ql},background:ql,font:Ii,header:{titleFont:Gl,titleFontSize:Wl,titleColor:Hl,labelFont:Ii,labelFontSize:Bl,labelColor:Ri},axis:{ticks:!1,grid:!1,domain:!1,labelColor:Ri,labelFontSize:Ul,titleFont:Gl,titleColor:Hl,titleFontSize:Wl,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:u$,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:qe},line:{stroke:qe,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:Ii,fontSize:Ul,fill:Ri},arc:{fill:qe},area:{fill:qe,line:!0,opacity:.6},path:{stroke:qe},rect:{fill:qe},point:{fill:qe,filled:!0,size:75},shape:{stroke:qe},symbol:{fill:qe,strokeWidth:1.5,size:50},legend:{titleFont:Ii,titleFontWeight:"bold",titleColor:Ri,labelFont:Ii,labelFontSize:Bl,labelColor:Ri,symbolType:"circle",symbolSize:75},range:{category:[qe,f$,d$,p$,g$,h$,m$,y$],diverging:Xl,heatmap:Xl,ordinal:b$}},Zs='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',Vl=400,x$=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],S$=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function Ps({type:e,background:t}){const n=e==="dark"?"#161616":"#ffffff",i=e==="dark"?"#f4f4f4":"#161616",r=e==="dark"?x$:S$,s=e==="dark"?"#d4bbff":"#6929c4";return{background:t,arc:{fill:s},area:{fill:s},path:{stroke:s},rect:{fill:s},shape:{stroke:s},symbol:{stroke:s},circle:{fill:s},view:{fill:n,stroke:n},group:{fill:n},title:{color:i,anchor:"start",dy:-15,fontSize:16,font:Zs,fontWeight:600},axis:{labelColor:i,labelFontSize:12,grid:!0,gridColor:"#525252",titleColor:i,labelAngle:0},style:{"guide-label":{font:Zs,fill:i,fontWeight:Vl},"guide-title":{font:Zs,fill:i,fontWeight:Vl}},range:{category:r,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const E$=Ps({type:"light",background:"#ffffff"}),w$=Ps({type:"light",background:"#f4f4f4"}),$$=Ps({type:"dark",background:"#262626"}),O$=Ps({type:"dark",background:"#161616"}),C$=Hw.version,N$=Object.freeze(Object.defineProperty({__proto__:null,carbong10:w$,carbong100:O$,carbong90:$$,carbonwhite:E$,dark:qw,excel:Xw,fivethirtyeight:Kw,ggplot2:Jw,googlecharts:l$,latimes:t$,powerbi:v$,quartz:n$,urbaninstitute:c$,version:C$,vox:i$},Symbol.toStringTag,{value:"Module"}));function Ki(e){"@babel/helpers - typeof";return Ki=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ki(e)}function _$(e,t){if(Ki(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t||"default");if(Ki(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function T$(e){var t=_$(e,"string");return Ki(t)==="symbol"?t:String(t)}function A$(e,t,n){return t=T$(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function F$(e,t){if(e==null)return{};var n={},i=Object.keys(e),r,s;for(s=0;s<i.length;s++)r=i[s],!(t.indexOf(r)>=0)&&(n[r]=e[r]);return n}function k$(e,t){if(e==null)return{};var n=F$(e,t),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)i=s[r],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}const I$=["title","image"];function R$(e,t,n){if(T(e))return`[${e.map(i=>t(L(i)?i:Yl(i,n))).join(", ")}]`;if(q(e)){let i="";const r=e,{title:s,image:o}=r,a=k$(r,I$);s&&(i+=`<h2>${t(s)}</h2>`),o&&(i+=`<img src="${t(o)}">`);const c=Object.keys(a);if(c.length>0){i+="<table>";for(const l of c){let u=a[l];u!==void 0&&(q(u)&&(u=Yl(u,n)),i+=`<tr><td class="key">${t(l)}:</td><td class="value">${t(u)}</td></tr>`)}i+="</table>"}return i||"{}"}return t(e)}function P$(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function Yl(e,t){return JSON.stringify(e,P$(t))}var L$=`#vg-tooltip-element {
  visibility: hidden;
  padding: 8px;
  position: fixed;
  z-index: 1000;
  font-family: sans-serif;
  font-size: 11px;
  border-radius: 3px;
  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  /* The default theme is the light theme. */
  background-color: rgba(255, 255, 255, 0.95);
  border: 1px solid #d9d9d9;
  color: black;
}
#vg-tooltip-element.visible {
  visibility: visible;
}
#vg-tooltip-element h2 {
  margin-top: 0;
  margin-bottom: 10px;
  font-size: 13px;
}
#vg-tooltip-element table {
  border-spacing: 0;
}
#vg-tooltip-element table tr {
  border: none;
}
#vg-tooltip-element table tr td {
  overflow: hidden;
  text-overflow: ellipsis;
  padding-top: 2px;
  padding-bottom: 2px;
}
#vg-tooltip-element table tr td.key {
  color: #808080;
  max-width: 150px;
  text-align: right;
  padding-right: 4px;
}
#vg-tooltip-element table tr td.value {
  display: block;
  max-width: 300px;
  max-height: 7em;
  text-align: left;
}
#vg-tooltip-element.dark-theme {
  background-color: rgba(32, 32, 32, 0.9);
  border: 1px solid #f5f5f5;
  color: white;
}
#vg-tooltip-element.dark-theme td.key {
  color: #bfbfbf;
}
`;const Mp="vg-tooltip-element",z$={offsetX:10,offsetY:10,id:Mp,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:D$,maxDepth:2,formatTooltip:R$};function D$(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function M$(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return L$.toString().replace(Mp,e)}function j$(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let s=e.clientY+i;return s+t.height>window.innerHeight&&(s=+e.clientY-i-t.height),{x:r,y:s}}function Kl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Jl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Kl(Object(n),!0).forEach(function(i){A$(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kl(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class U${constructor(t){this.options=Jl(Jl({},z$),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=M$(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(t,n,i,r){if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),(document.fullscreenElement??document.body).appendChild(this.el)),r==null||r===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:s,y:o}=j$(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.style.top=`${o}px`,this.el.style.left=`${s}px`}}function Ji(e){"@babel/helpers - typeof";return Ji=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ji(e)}function B$(e,t){if(Ji(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t||"default");if(Ji(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function W$(e){var t=B$(e,"string");return Ji(t)==="symbol"?t:String(t)}function G$(e,t,n){return t=W$(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H$(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var eo,Ql;function q$(){return Ql||(Ql=1,eo=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),eo}var X$=X;X.Node=Pn;X.create=X;function X(e){var t=this;if(t instanceof X||(t=new X),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(r){t.push(r)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}X.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t};X.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};X.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};X.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)Y$(this,arguments[e]);return this.length};X.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)K$(this,arguments[e]);return this.length};X.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};X.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};X.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,i=0;n!==null;i++)e.call(t,n.value,i,this),n=n.next};X.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,i=this.length-1;n!==null;i--)e.call(t,n.value,i,this),n=n.prev};X.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value};X.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value};X.prototype.map=function(e,t){t=t||this;for(var n=new X,i=this.head;i!==null;)n.push(e.call(t,i.value,this)),i=i.next;return n};X.prototype.mapReverse=function(e,t){t=t||this;for(var n=new X,i=this.tail;i!==null;)n.push(e.call(t,i.value,this)),i=i.prev;return n};X.prototype.reduce=function(e,t){var n,i=this.head;if(arguments.length>1)n=t;else if(this.head)i=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)n=e(n,i.value,r),i=i.next;return n};X.prototype.reduceReverse=function(e,t){var n,i=this.tail;if(arguments.length>1)n=t;else if(this.tail)i=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)n=e(n,i.value,r),i=i.prev;return n};X.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e};X.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e};X.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new X;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(;r!==null&&i<t;i++,r=r.next)n.push(r.value);return n};X.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new X;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,r=this.tail;r!==null&&i>t;i--)r=r.prev;for(;r!==null&&i>e;i--,r=r.prev)n.push(r.value);return n};X.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(var s=[],i=0;r&&i<t;i++)s.push(r.value),r=this.removeNode(r);r===null&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(var i=0;i<n.length;i++)r=V$(this,r,n[i]);return s};X.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=t,this.tail=e,this};function V$(e,t,n){var i=t===e.head?new Pn(n,null,t,e):new Pn(n,t,t.next,e);return i.next===null&&(e.tail=i),i.prev===null&&(e.head=i),e.length++,i}function Y$(e,t){e.tail=new Pn(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function K$(e,t){e.head=new Pn(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Pn(e,t,n,i){if(!(this instanceof Pn))return new Pn(e,t,n,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{q$()(X)}catch{}const J$=X$,bn=Symbol("max"),Nt=Symbol("length"),Xn=Symbol("lengthCalculator"),Bi=Symbol("allowStale"),vn=Symbol("maxAge"),Ct=Symbol("dispose"),Zl=Symbol("noDisposeOnSet"),pe=Symbol("lruList"),Xe=Symbol("cache"),jp=Symbol("updateAgeOnGet"),to=()=>1;class Q${constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[bn]=t.max||1/0;const n=t.length||to;if(this[Xn]=typeof n!="function"?to:n,this[Bi]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[vn]=t.maxAge||0,this[Ct]=t.dispose,this[Zl]=t.noDisposeOnSet||!1,this[jp]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[bn]=t||1/0,Pi(this)}get max(){return this[bn]}set allowStale(t){this[Bi]=!!t}get allowStale(){return this[Bi]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[vn]=t,Pi(this)}get maxAge(){return this[vn]}set lengthCalculator(t){typeof t!="function"&&(t=to),t!==this[Xn]&&(this[Xn]=t,this[Nt]=0,this[pe].forEach(n=>{n.length=this[Xn](n.value,n.key),this[Nt]+=n.length})),Pi(this)}get lengthCalculator(){return this[Xn]}get length(){return this[Nt]}get itemCount(){return this[pe].length}rforEach(t,n){n=n||this;for(let i=this[pe].tail;i!==null;){const r=i.prev;eu(this,t,i,n),i=r}}forEach(t,n){n=n||this;for(let i=this[pe].head;i!==null;){const r=i.next;eu(this,t,i,n),i=r}}keys(){return this[pe].toArray().map(t=>t.key)}values(){return this[pe].toArray().map(t=>t.value)}reset(){this[Ct]&&this[pe]&&this[pe].length&&this[pe].forEach(t=>this[Ct](t.key,t.value)),this[Xe]=new Map,this[pe]=new J$,this[Nt]=0}dump(){return this[pe].map(t=>Wr(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[pe]}set(t,n,i){if(i=i||this[vn],i&&typeof i!="number")throw new TypeError("maxAge must be a number");const r=i?Date.now():0,s=this[Xn](n,t);if(this[Xe].has(t)){if(s>this[bn])return ni(this,this[Xe].get(t)),!1;const c=this[Xe].get(t).value;return this[Ct]&&(this[Zl]||this[Ct](t,c.value)),c.now=r,c.maxAge=i,c.value=n,this[Nt]+=s-c.length,c.length=s,this.get(t),Pi(this),!0}const o=new Z$(t,n,s,r,i);return o.length>this[bn]?(this[Ct]&&this[Ct](t,n),!1):(this[Nt]+=o.length,this[pe].unshift(o),this[Xe].set(t,this[pe].head),Pi(this),!0)}has(t){if(!this[Xe].has(t))return!1;const n=this[Xe].get(t).value;return!Wr(this,n)}get(t){return no(this,t,!0)}peek(t){return no(this,t,!1)}pop(){const t=this[pe].tail;return t?(ni(this,t),t.value):null}del(t){ni(this,this[Xe].get(t))}load(t){this.reset();const n=Date.now();for(let i=t.length-1;i>=0;i--){const r=t[i],s=r.e||0;if(s===0)this.set(r.k,r.v);else{const o=s-n;o>0&&this.set(r.k,r.v,o)}}}prune(){this[Xe].forEach((t,n)=>no(this,n,!1))}}const no=(e,t,n)=>{const i=e[Xe].get(t);if(i){const r=i.value;if(Wr(e,r)){if(ni(e,i),!e[Bi])return}else n&&(e[jp]&&(i.value.now=Date.now()),e[pe].unshiftNode(i));return r.value}},Wr=(e,t)=>{if(!t||!t.maxAge&&!e[vn])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[vn]&&n>e[vn]},Pi=e=>{if(e[Nt]>e[bn])for(let t=e[pe].tail;e[Nt]>e[bn]&&t!==null;){const n=t.prev;ni(e,t),t=n}},ni=(e,t)=>{if(t){const n=t.value;e[Ct]&&e[Ct](n.key,n.value),e[Nt]-=n.length,e[Xe].delete(n.key),e[pe].removeNode(t)}};class Z${constructor(t,n,i,r,s){this.key=t,this.value=n,this.length=i,this.now=r,this.maxAge=s||0}}const eu=(e,t,n,i)=>{let r=n.value;Wr(e,r)&&(ni(e,n),e[Bi]||(r=void 0)),r&&t.call(i,r.value,r.key,e)};var e1=Q$;const t1=Object.freeze({loose:!0}),n1=Object.freeze({}),i1=e=>e?typeof e!="object"?t1:e:n1;var gc=i1,Lo={exports:{}};const r1="2.0.0",Up=256,s1=Number.MAX_SAFE_INTEGER||9007199254740991,o1=16,a1=Up-6,c1=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var hc={MAX_LENGTH:Up,MAX_SAFE_COMPONENT_LENGTH:o1,MAX_SAFE_BUILD_LENGTH:a1,MAX_SAFE_INTEGER:s1,RELEASE_TYPES:c1,SEMVER_SPEC_VERSION:r1,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const l1=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Ls=l1;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:r}=hc,s=Ls;t=e.exports={};const o=t.re=[],a=t.safeRe=[],c=t.src=[],l=t.t={};let u=0;const f="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",r],[f,i]],p=h=>{for(const[m,y]of d)h=h.split(`${m}*`).join(`${m}{0,${y}}`).split(`${m}+`).join(`${m}{1,${y}}`);return h},g=(h,m,y)=>{const b=p(m),C=u++;s(h,C,m),l[h]=C,c[C]=m,o[C]=new RegExp(m,y?"g":void 0),a[C]=new RegExp(b,y?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),g("MAINVERSION",`(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${c[l.NUMERICIDENTIFIER]}|${c[l.NONNUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${c[l.NUMERICIDENTIFIERLOOSE]}|${c[l.NONNUMERICIDENTIFIER]})`),g("PRERELEASE",`(?:-(${c[l.PRERELEASEIDENTIFIER]}(?:\\.${c[l.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${c[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[l.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${f}+`),g("BUILD",`(?:\\+(${c[l.BUILDIDENTIFIER]}(?:\\.${c[l.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${c[l.MAINVERSION]}${c[l.PRERELEASE]}?${c[l.BUILD]}?`),g("FULL",`^${c[l.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${c[l.MAINVERSIONLOOSE]}${c[l.PRERELEASELOOSE]}?${c[l.BUILD]}?`),g("LOOSE",`^${c[l.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${c[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${c[l.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:${c[l.PRERELEASE]})?${c[l.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:${c[l.PRERELEASELOOSE]})?${c[l.BUILD]}?)?)?`),g("XRANGE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAINLOOSE]}$`),g("COERCE",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?(?:$|[^\\d])`),g("COERCERTL",c[l.COERCE],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${c[l.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",g("TILDE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${c[l.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",g("CARET",`^${c[l.LONECARET]}${c[l.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${c[l.LONECARET]}${c[l.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${c[l.GTLT]}\\s*(${c[l.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]}|${c[l.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${c[l.XRANGEPLAIN]})\\s+-\\s+(${c[l.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${c[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[l.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Lo,Lo.exports);var mc=Lo.exports;const tu=/^[0-9]+$/,Bp=(e,t)=>{const n=tu.test(e),i=tu.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},u1=(e,t)=>Bp(t,e);var f1={compareIdentifiers:Bp,rcompareIdentifiers:u1};const Sr=Ls,{MAX_LENGTH:nu,MAX_SAFE_INTEGER:Er}=hc,{safeRe:iu,t:ru}=mc,d1=gc,{compareIdentifiers:Vn}=f1;let p1=class ct{constructor(t,n){if(n=d1(n),t instanceof ct){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof t}".`);if(t.length>nu)throw new TypeError(`version is longer than ${nu} characters`);Sr("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const i=t.trim().match(n.loose?iu[ru.LOOSE]:iu[ru.FULL]);if(!i)throw new TypeError(`Invalid Version: ${t}`);if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>Er||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Er||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Er||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const s=+r;if(s>=0&&s<Er)return s}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(t){if(Sr("SemVer.compare",this.version,this.options,t),!(t instanceof ct)){if(typeof t=="string"&&t===this.version)return 0;t=new ct(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof ct||(t=new ct(t,this.options)),Vn(this.major,t.major)||Vn(this.minor,t.minor)||Vn(this.patch,t.patch)}comparePre(t){if(t instanceof ct||(t=new ct(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const i=this.prerelease[n],r=t.prerelease[n];if(Sr("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return Vn(i,r)}while(++n)}compareBuild(t){t instanceof ct||(t=new ct(t,this.options));let n=0;do{const i=this.build[n],r=t.build[n];if(Sr("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return Vn(i,r)}while(++n)}inc(t,n,i){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,i),this.inc("pre",n,i);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,i),this.inc("pre",n,i);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const r=Number(i)?1:0;if(!n&&i===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[r];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(n===this.prerelease.join(".")&&i===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(r)}}if(n){let s=[n,r];i===!1&&(s=[n]),Vn(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${t}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var yc=p1;const su=yc,g1=(e,t,n)=>new su(e,n).compare(new su(t,n));var _i=g1;const h1=_i,m1=(e,t,n)=>h1(e,t,n)===0;var y1=m1;const b1=_i,v1=(e,t,n)=>b1(e,t,n)!==0;var x1=v1;const S1=_i,E1=(e,t,n)=>S1(e,t,n)>0;var w1=E1;const $1=_i,O1=(e,t,n)=>$1(e,t,n)>=0;var C1=O1;const N1=_i,_1=(e,t,n)=>N1(e,t,n)<0;var T1=_1;const A1=_i,F1=(e,t,n)=>A1(e,t,n)<=0;var k1=F1;const I1=y1,R1=x1,P1=w1,L1=C1,z1=T1,D1=k1,M1=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return I1(e,n,i);case"!=":return R1(e,n,i);case">":return P1(e,n,i);case">=":return L1(e,n,i);case"<":return z1(e,n,i);case"<=":return D1(e,n,i);default:throw new TypeError(`Invalid operator: ${t}`)}};var j1=M1,io,ou;function U1(){if(ou)return io;ou=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(u,f){if(f=n(f),u instanceof t){if(u.loose===!!f.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),o("comparator",u,f),this.options=f,this.loose=!!f.loose,this.parse(u),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(u){const f=this.options.loose?i[r.COMPARATORLOOSE]:i[r.COMPARATOR],d=u.match(f);if(!d)throw new TypeError(`Invalid comparator: ${u}`);this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new a(d[2],this.options.loose):this.semver=e}toString(){return this.value}test(u){if(o("Comparator.test",u,this.options.loose),this.semver===e||u===e)return!0;if(typeof u=="string")try{u=new a(u,this.options)}catch{return!1}return s(u,this.operator,this.semver,this.options)}intersects(u,f){if(!(u instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(u.value,f).test(this.value):u.operator===""?u.value===""?!0:new c(this.value,f).test(u.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||s(this.semver,"<",u.semver,f)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||s(this.semver,">",u.semver,f)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}io=t;const n=gc,{safeRe:i,t:r}=mc,s=j1,o=Ls,a=yc,c=Wp();return io}var ro,au;function Wp(){if(au)return ro;au=1;class e{constructor(w,P){if(P=i(P),w instanceof e)return w.loose===!!P.loose&&w.includePrerelease===!!P.includePrerelease?w:new e(w.raw,P);if(w instanceof r)return this.raw=w.value,this.set=[[w]],this.format(),this;if(this.options=P,this.loose=!!P.loose,this.includePrerelease=!!P.includePrerelease,this.raw=w.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(F=>this.parseRange(F.trim())).filter(F=>F.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const F=this.set[0];if(this.set=this.set.filter(R=>!g(R[0])),this.set.length===0)this.set=[F];else if(this.set.length>1){for(const R of this.set)if(R.length===1&&h(R[0])){this.set=[R];break}}}this.format()}format(){return this.range=this.set.map(w=>w.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(w){const F=((this.options.includePrerelease&&d)|(this.options.loose&&p))+":"+w,R=n.get(F);if(R)return R;const A=this.options.loose,z=A?a[c.HYPHENRANGELOOSE]:a[c.HYPHENRANGE];w=w.replace(z,ve(this.options.includePrerelease)),s("hyphen replace",w),w=w.replace(a[c.COMPARATORTRIM],l),s("comparator trim",w),w=w.replace(a[c.TILDETRIM],u),s("tilde trim",w),w=w.replace(a[c.CARETTRIM],f),s("caret trim",w);let H=w.split(" ").map(ie=>y(ie,this.options)).join(" ").split(/\s+/).map(ie=>Q(ie,this.options));A&&(H=H.filter(ie=>(s("loose invalid filter",ie,this.options),!!ie.match(a[c.COMPARATORLOOSE])))),s("range list",H);const U=new Map,Z=H.map(ie=>new r(ie,this.options));for(const ie of Z){if(g(ie))return[ie];U.set(ie.value,ie)}U.size>1&&U.has("")&&U.delete("");const Ee=[...U.values()];return n.set(F,Ee),Ee}intersects(w,P){if(!(w instanceof e))throw new TypeError("a Range is required");return this.set.some(F=>m(F,P)&&w.set.some(R=>m(R,P)&&F.every(A=>R.every(z=>A.intersects(z,P)))))}test(w){if(!w)return!1;if(typeof w=="string")try{w=new o(w,this.options)}catch{return!1}for(let P=0;P<this.set.length;P++)if(ot(this.set[P],w,this.options))return!0;return!1}}ro=e;const t=e1,n=new t({max:1e3}),i=gc,r=U1(),s=Ls,o=yc,{safeRe:a,t:c,comparatorTrimReplace:l,tildeTrimReplace:u,caretTrimReplace:f}=mc,{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:p}=hc,g=N=>N.value==="<0.0.0-0",h=N=>N.value==="",m=(N,w)=>{let P=!0;const F=N.slice();let R=F.pop();for(;P&&F.length;)P=F.every(A=>R.intersects(A,w)),R=F.pop();return P},y=(N,w)=>(s("comp",N,w),N=v(N,w),s("caret",N),N=C(N,w),s("tildes",N),N=O(N,w),s("xrange",N),N=V(N,w),s("stars",N),N),b=N=>!N||N.toLowerCase()==="x"||N==="*",C=(N,w)=>N.trim().split(/\s+/).map(P=>I(P,w)).join(" "),I=(N,w)=>{const P=w.loose?a[c.TILDELOOSE]:a[c.TILDE];return N.replace(P,(F,R,A,z,H)=>{s("tilde",N,F,R,A,z,H);let U;return b(R)?U="":b(A)?U=`>=${R}.0.0 <${+R+1}.0.0-0`:b(z)?U=`>=${R}.${A}.0 <${R}.${+A+1}.0-0`:H?(s("replaceTilde pr",H),U=`>=${R}.${A}.${z}-${H} <${R}.${+A+1}.0-0`):U=`>=${R}.${A}.${z} <${R}.${+A+1}.0-0`,s("tilde return",U),U})},v=(N,w)=>N.trim().split(/\s+/).map(P=>_(P,w)).join(" "),_=(N,w)=>{s("caret",N,w);const P=w.loose?a[c.CARETLOOSE]:a[c.CARET],F=w.includePrerelease?"-0":"";return N.replace(P,(R,A,z,H,U)=>{s("caret",N,R,A,z,H,U);let Z;return b(A)?Z="":b(z)?Z=`>=${A}.0.0${F} <${+A+1}.0.0-0`:b(H)?A==="0"?Z=`>=${A}.${z}.0${F} <${A}.${+z+1}.0-0`:Z=`>=${A}.${z}.0${F} <${+A+1}.0.0-0`:U?(s("replaceCaret pr",U),A==="0"?z==="0"?Z=`>=${A}.${z}.${H}-${U} <${A}.${z}.${+H+1}-0`:Z=`>=${A}.${z}.${H}-${U} <${A}.${+z+1}.0-0`:Z=`>=${A}.${z}.${H}-${U} <${+A+1}.0.0-0`):(s("no pr"),A==="0"?z==="0"?Z=`>=${A}.${z}.${H}${F} <${A}.${z}.${+H+1}-0`:Z=`>=${A}.${z}.${H}${F} <${A}.${+z+1}.0-0`:Z=`>=${A}.${z}.${H} <${+A+1}.0.0-0`),s("caret return",Z),Z})},O=(N,w)=>(s("replaceXRanges",N,w),N.split(/\s+/).map(P=>M(P,w)).join(" ")),M=(N,w)=>{N=N.trim();const P=w.loose?a[c.XRANGELOOSE]:a[c.XRANGE];return N.replace(P,(F,R,A,z,H,U)=>{s("xRange",N,F,R,A,z,H,U);const Z=b(A),Ee=Z||b(z),ie=Ee||b(H),cn=ie;return R==="="&&cn&&(R=""),U=w.includePrerelease?"-0":"",Z?R===">"||R==="<"?F="<0.0.0-0":F="*":R&&cn?(Ee&&(z=0),H=0,R===">"?(R=">=",Ee?(A=+A+1,z=0,H=0):(z=+z+1,H=0)):R==="<="&&(R="<",Ee?A=+A+1:z=+z+1),R==="<"&&(U="-0"),F=`${R+A}.${z}.${H}${U}`):Ee?F=`>=${A}.0.0${U} <${+A+1}.0.0-0`:ie&&(F=`>=${A}.${z}.0${U} <${A}.${+z+1}.0-0`),s("xRange return",F),F})},V=(N,w)=>(s("replaceStars",N,w),N.trim().replace(a[c.STAR],"")),Q=(N,w)=>(s("replaceGTE0",N,w),N.trim().replace(a[w.includePrerelease?c.GTE0PRE:c.GTE0],"")),ve=N=>(w,P,F,R,A,z,H,U,Z,Ee,ie,cn,zs)=>(b(F)?P="":b(R)?P=`>=${F}.0.0${N?"-0":""}`:b(A)?P=`>=${F}.${R}.0${N?"-0":""}`:z?P=`>=${P}`:P=`>=${P}${N?"-0":""}`,b(Z)?U="":b(Ee)?U=`<${+Z+1}.0.0-0`:b(ie)?U=`<${Z}.${+Ee+1}.0-0`:cn?U=`<=${Z}.${Ee}.${ie}-${cn}`:N?U=`<${Z}.${Ee}.${+ie+1}-0`:U=`<=${U}`,`${P} ${U}`.trim()),ot=(N,w,P)=>{for(let F=0;F<N.length;F++)if(!N[F].test(w))return!1;if(w.prerelease.length&&!P.includePrerelease){for(let F=0;F<N.length;F++)if(s(N[F].semver),N[F].semver!==r.ANY&&N[F].semver.prerelease.length>0){const R=N[F].semver;if(R.major===w.major&&R.minor===w.minor&&R.patch===w.patch)return!0}return!1}return!0};return ro}const B1=Wp(),W1=(e,t,n)=>{try{t=new B1(t,n)}catch{return!1}return t.test(e)};var G1=W1,Gp=H$(G1);function H1(e,t,n){const i=e.open(t),r=1e4,s=250,{origin:o}=new URL(t);let a=~~(r/s);function c(u){u.source===i&&(a=0,e.removeEventListener("message",c,!1))}e.addEventListener("message",c,!1);function l(){a<=0||(i.postMessage(n,o),setTimeout(l,s),a-=1)}setTimeout(l,s)}var q1=`.vega-embed {
  position: relative;
  display: inline-block;
  box-sizing: border-box;
}
.vega-embed.has-actions {
  padding-right: 38px;
}
.vega-embed details:not([open]) > :not(summary) {
  display: none !important;
}
.vega-embed summary {
  list-style: none;
  position: absolute;
  top: 0;
  right: 0;
  padding: 6px;
  z-index: 1000;
  background: white;
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
  color: #1b1e23;
  border: 1px solid #aaa;
  border-radius: 999px;
  opacity: 0.2;
  transition: opacity 0.4s ease-in;
  cursor: pointer;
  line-height: 0px;
}
.vega-embed summary::-webkit-details-marker {
  display: none;
}
.vega-embed summary:active {
  box-shadow: #aaa 0px 0px 0px 1px inset;
}
.vega-embed summary svg {
  width: 14px;
  height: 14px;
}
.vega-embed details[open] summary {
  opacity: 0.7;
}
.vega-embed:hover summary, .vega-embed:focus-within summary {
  opacity: 1 !important;
  transition: opacity 0.2s ease;
}
.vega-embed .vega-actions {
  position: absolute;
  z-index: 1001;
  top: 35px;
  right: -9px;
  display: flex;
  flex-direction: column;
  padding-bottom: 8px;
  padding-top: 8px;
  border-radius: 4px;
  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);
  border: 1px solid #d9d9d9;
  background: white;
  animation-duration: 0.15s;
  animation-name: scale-in;
  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);
  text-align: left;
}
.vega-embed .vega-actions a {
  padding: 8px 16px;
  font-family: sans-serif;
  font-size: 14px;
  font-weight: 600;
  white-space: nowrap;
  color: #434a56;
  text-decoration: none;
}
.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {
  background-color: #f7f7f9;
  color: black;
}
.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {
  content: "";
  display: inline-block;
  position: absolute;
}
.vega-embed .vega-actions::before {
  left: auto;
  right: 14px;
  top: -16px;
  border: 8px solid rgba(0, 0, 0, 0);
  border-bottom-color: #d9d9d9;
}
.vega-embed .vega-actions::after {
  left: auto;
  right: 15px;
  top: -14px;
  border: 7px solid rgba(0, 0, 0, 0);
  border-bottom-color: #fff;
}
.vega-embed .chart-wrapper.fit-x {
  width: 100%;
}
.vega-embed .chart-wrapper.fit-y {
  height: 100%;
}

.vega-embed-wrapper {
  max-width: 100%;
  overflow: auto;
  padding-right: 14px;
}

@keyframes scale-in {
  from {
    opacity: 0;
    transform: scale(0.6);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
`;function Hp(e,...t){for(const n of t)X1(e,n);return e}function X1(e,t){for(const n of Object.keys(t))zo(e,n,t[n],!0)}var V1="vega-embed",Y1="6.22.2",K1="Publish Vega visualizations as embedded web components.",J1=["vega","data","visualization","component","embed"],Q1={type:"git",url:"http://github.com/vega/vega-embed.git"},Z1={name:"UW Interactive Data Lab",url:"http://idl.cs.washington.edu"},e0=[{name:"Dominik Moritz",url:"https://www.domoritz.de"}],t0={url:"https://github.com/vega/vega-embed/issues"},n0="https://github.com/vega/vega-embed#readme",i0="BSD-3-Clause",r0="build/vega-embed.js",s0="build/vega-embed.module.js",o0="build/vega-embed.min.js",a0="build/vega-embed.min.js",c0="build/vega-embed.module.d.ts",l0=["src","build","patches"],u0={"@babel/core":"^7.22.9","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.9","@babel/preset-env":"^7.22.9","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-commonjs":"25.0.3","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@types/semver":"^7.5.0","@typescript-eslint/eslint-plugin":"^6.2.0","@typescript-eslint/parser":"^6.2.0","browser-sync":"^2.29.3",concurrently:"^8.2.0","del-cli":"^5.0.0",eslint:"^8.46.0","eslint-config-prettier":"^8.9.0","eslint-plugin-jest":"^27.2.3","eslint-plugin-prettier":"^5.0.0",jest:"^29.6.2","jest-canvas-mock":"^2.5.2","jest-environment-jsdom":"^29.6.2","patch-package":"^8.0.0","postinstall-postinstall":"^2.1.0",prettier:"^3.0.0","release-it":"^16.1.3",rollup:"3.27.0","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",sass:"^1.64.1",typescript:"^5.1.6",vega:"^5.22.1","vega-lite":"^5.2.0"},f0={vega:"^5.21.0","vega-lite":"*"},d0={"fast-json-patch":"^3.1.1","json-stringify-pretty-compact":"^3.0.0",semver:"^7.5.4",tslib:"^2.6.1","vega-interpreter":"^1.0.5","vega-schema-url-parser":"^2.2.0","vega-themes":"^2.14.0","vega-tooltip":"^0.32.0"},p0=["yallist"],g0={prebuild:"yarn clean && yarn build:style",build:"rollup -c","build:style":"./build-style.sh",clean:"del-cli build src/style.ts",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint && yarn test",serve:"browser-sync start --directory -s -f build *.html",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",pretest:"yarn build:style",test:"jest","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand",prettierbase:"prettier '*.{css,scss,html}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",release:"release-it"},h0={name:V1,version:Y1,description:K1,keywords:J1,repository:Q1,author:Z1,contributors:e0,bugs:t0,homepage:n0,license:i0,main:r0,module:s0,unpkg:o0,jsdelivr:a0,types:c0,files:l0,devDependencies:u0,peerDependencies:f0,dependencies:d0,bundledDependencies:p0,scripts:g0};function cu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?cu(Object(n),!0).forEach(function(i){G$(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cu(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const dO=h0.version,lt=eg;let Qi=Cw;const wr=typeof window<"u"?window:void 0;var du;Qi===void 0&&((du=wr==null?void 0:wr.vl)!=null&&du.compile)&&(Qi=wr.vl);const m0={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},y0={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Di={vega:"Vega","vega-lite":"Vega-Lite"},Gr={vega:lt.version,"vega-lite":Qi?Qi.version:"not available"},b0={vega:e=>e,"vega-lite":(e,t)=>Qi.compile(e,{config:t}).spec},v0=`
<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
  <circle r="2" cy="8" cx="2"></circle>
  <circle r="2" cy="8" cx="8"></circle>
  <circle r="2" cy="8" cx="14"></circle>
</svg>`,x0="chart-wrapper";function S0(e){return typeof e=="function"}function lu(e,t,n,i){const r=`<html><head>${t}</head><body><pre><code class="json">`,s=`</code></pre>${n}</body></html>`,o=window.open("");o.document.write(r+e+s),o.document.title=`${Di[i]} JSON Source`}function E0(e,t){if(e.$schema){const n=Lp(e.$schema);t&&t!==n.library&&console.warn(`The given visualization spec is written in ${Di[n.library]}, but mode argument sets ${Di[t]??t}.`);const i=n.library;return Gp(Gr[i],`^${n.version.slice(1)}`)||console.warn(`The input spec uses ${Di[i]} ${n.version}, but the current version of ${Di[i]} is v${Gr[i]}.`),i}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t??"vega"}function w0(e){return!!(e&&"load"in e)}function uu(e){return w0(e)?e:lt.loader(e)}function $0(e){var n;const t=((n=e.usermeta)==null?void 0:n.embedOptions)??{};return L(t.defaultStyle)&&(t.defaultStyle=!1),t}async function pO(e,t,n={}){let i,r;L(t)?(r=uu(n.loader),i=JSON.parse(await r.load(t))):i=t;const s=$0(i),o=s.loader;(!r||o)&&(r=uu(n.loader??o));const a=await fu(s,r),c=await fu(n,r),l=qt(qt({},Hp(c,a)),{},{config:qr(c.config??{},a.config??{})});return await C0(e,i,l,r)}async function fu(e,t){const n=L(e.config)?JSON.parse(await t.load(e.config)):e.config??{},i=L(e.patch)?JSON.parse(await t.load(e.patch)):e.patch;return qt(qt(qt({},e),i?{patch:i}:{}),n?{config:n}:{})}function O0(e){const t=e.getRootNode?e.getRootNode():document;return t instanceof ShadowRoot?{root:t,rootContainer:t}:{root:document,rootContainer:document.head??document.body}}async function C0(e,t,n={},i){const r=n.theme?qr(N$[n.theme],n.config??{}):n.config,s=bi(n.actions)?n.actions:Hp({},m0,n.actions??{}),o=qt(qt({},y0),n.i18n),a=n.renderer??"canvas",c=n.logLevel??lt.Warn,l=n.downloadFileName??"visualization",u=typeof e=="string"?document.querySelector(e):e;if(!u)throw new Error(`${e} does not exist`);if(n.defaultStyle!==!1){const v="vega-embed-style",{root:_,rootContainer:O}=O0(u);if(!_.getElementById(v)){const M=document.createElement("style");M.id=v,M.innerHTML=n.defaultStyle===void 0||n.defaultStyle===!0?q1.toString():n.defaultStyle,O.appendChild(M)}}const f=E0(t,n.mode);let d=b0[f](t,r);if(f==="vega-lite"&&d.$schema){const v=Lp(d.$schema);Gp(Gr.vega,`^${v.version.slice(1)}`)||console.warn(`The compiled spec uses Vega ${v.version}, but current version is v${Gr.vega}.`)}u.classList.add("vega-embed"),s&&u.classList.add("has-actions"),u.innerHTML="";let p=u;if(s){const v=document.createElement("div");v.classList.add(x0),u.appendChild(v),p=v}const g=n.patch;if(g&&(d=g instanceof Function?g(d):Xr(d,g,!0,!1).newDocument),n.formatLocale&&lt.formatLocale(n.formatLocale),n.timeFormatLocale&&lt.timeFormatLocale(n.timeFormatLocale),n.expressionFunctions)for(const v in n.expressionFunctions){const _=n.expressionFunctions[v];"fn"in _?lt.expressionFunction(v,_.fn,_.visitor):_ instanceof Function&&lt.expressionFunction(v,_)}const{ast:h}=n,m=lt.parse(d,f==="vega-lite"?{}:r,{ast:h}),y=new(n.viewClass||lt.View)(m,qt({loader:i,logLevel:c,renderer:a},h?{expr:lt.expressionInterpreter??n.expr??Ng}:{}));if(y.addSignalListener("autosize",(v,_)=>{const{type:O}=_;O=="fit-x"?(p.classList.add("fit-x"),p.classList.remove("fit-y")):O=="fit-y"?(p.classList.remove("fit-x"),p.classList.add("fit-y")):O=="fit"?p.classList.add("fit-x","fit-y"):p.classList.remove("fit-x","fit-y")}),n.tooltip!==!1){const v=S0(n.tooltip)?n.tooltip:new U$(n.tooltip===!0?{}:n.tooltip).call;y.tooltip(v)}let{hover:b}=n;if(b===void 0&&(b=f==="vega"),b){const{hoverSet:v,updateSet:_}=typeof b=="boolean"?{}:b;y.hover(v,_)}n&&(n.width!=null&&y.width(n.width),n.height!=null&&y.height(n.height),n.padding!=null&&y.padding(n.padding)),await y.initialize(p,n.bind).runAsync();let C;if(s!==!1){let v=u;if(n.defaultStyle!==!1){const O=document.createElement("details");O.title=o.CLICK_TO_VIEW_ACTIONS,u.append(O),v=O;const M=document.createElement("summary");M.innerHTML=v0,O.append(M),C=V=>{O.contains(V.target)||O.removeAttribute("open")},document.addEventListener("click",C)}const _=document.createElement("div");if(v.append(_),_.classList.add("vega-actions"),s===!0||s.export!==!1){for(const O of["svg","png"])if(s===!0||s.export===!0||s.export[O]){const M=o[`${O.toUpperCase()}_ACTION`],V=document.createElement("a"),Q=q(n.scaleFactor)?n.scaleFactor[O]:n.scaleFactor;V.text=M,V.href="#",V.target="_blank",V.download=`${l}.${O}`,V.addEventListener("mousedown",async function(ve){ve.preventDefault();const ot=await y.toImageURL(O,Q);this.href=ot}),_.append(V)}}if(s===!0||s.source!==!1){const O=document.createElement("a");O.text=o.SOURCE_ACTION,O.href="#",O.addEventListener("click",function(M){lu(Ds(t),n.sourceHeader??"",n.sourceFooter??"",f),M.preventDefault()}),_.append(O)}if(f==="vega-lite"&&(s===!0||s.compiled!==!1)){const O=document.createElement("a");O.text=o.COMPILED_ACTION,O.href="#",O.addEventListener("click",function(M){lu(Ds(d),n.sourceHeader??"",n.sourceFooter??"","vega"),M.preventDefault()}),_.append(O)}if(s===!0||s.editor!==!1){const O=n.editorUrl??"https://vega.github.io/editor/",M=document.createElement("a");M.text=o.EDITOR_ACTION,M.href="#",M.addEventListener("click",function(V){H1(window,O,{config:r,mode:f,renderer:a,spec:Ds(t)}),V.preventDefault()}),_.append(M)}}function I(){C&&document.removeEventListener("click",C),y.finalize()}return{view:y,spec:t,vgSpec:d,finalize:I,embedOptions:n}}export{m0 as DEFAULT_ACTIONS,pO as default,E0 as guessMode,lt as vega,Qi as vegaLite,dO as version};
